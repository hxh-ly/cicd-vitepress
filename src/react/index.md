# React

æ¬¢è¿æ¥åˆ° React æ–‡æ¡£ï¼

## å‘å±•å†å²

| å¹´ä»½ | ç‰ˆæœ¬        | å…³é”®ç‰¹æ€§                                       |
| ---- | ----------- | ---------------------------------------------- |
| 2013 | v0.3        | å¼€æº                                           |
| 2015 | v0.14       | æ‹†åˆ†ä¸º `react` å’Œ `react-dom`                  |
| 2016 | v15         | é¦–ä¸ªç¨³å®šç‰ˆ                                     |
| 2017 | v16 (Fiber) | æ–°æ ¸å¿ƒæ¶æ„ã€Fragmentã€Portalã€Error Boundaries |
| 2018 | v16.6       | `React.memo`ã€`lazy`ã€`Suspense`               |
| 2019 | v16.8       | **Hooks**                                      |
| 2020 | v17         | è¿‡æ¸¡ç‰ˆæœ¬ã€æ–°çš„ JSX è½¬æ¢                        |
| 2022 | v18         | **å¹¶å‘æ¸²æŸ“**ã€è‡ªåŠ¨æ‰¹å¤„ç†ã€Suspense æ”¹è¿›        |
| 2024 | v19 (Beta)  | React Compilerã€Actionsã€Web Components æ”¯æŒ   |

## React çš„æ ¸å¿ƒç†å¿µ

å£°æ˜å¼ã€ç»„ä»¶åŒ–ã€å’Œå•å‘æ•°æ®æµ

## ä¸‰å¤§æ ¸å¿ƒç‰¹æ€§

è™šæ‹Ÿ DOMã€ ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ hooks

## React çš„ class ç±»æœ‰ä»€ä¹ˆç”Ÿå‘½å‘¨æœŸï¼Ÿ

æ„å»ºï¼ˆconstructorï¼‰ï¼š æ´¾(getDerivedStateFromProps) -> ç»˜(render) -> æŒ‚(componentDidMount)
| æ–¹æ³• | è°ƒç”¨æ—¶æœº | ç”¨é€” | æ˜¯å¦å¯è°ƒç”¨ setState |
| ---- | ---- | ---- | ---- |
| constructor | ç»„ä»¶åˆå§‹åŒ– | åˆå§‹åŒ– stateï¼Œç»‘å®šæ–¹æ³• | âŒ |
| getDerivedStateFromProps | æ¯æ¬¡æ¸²æŸ“å‰ | æ ¹æ® props æ›´æ–° state | âŒ |
| render | å¿…é¡»å®ç°çš„æ–¹æ³• | è¿”å› jsx | âŒ |
| componententDidMount | ç»„ä»¶æŒ‚è½½å | DOM æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€è®¢é˜… | âœ… |

å˜æ›´ ï¼š æ´¾(getDerivedStateFromProps) -> åˆ¤(shouldComponentUpdate) -> ç»˜(render) -> æ•(getSnapShotBeforeUpdate) -> æ›´(componentDidUpdate)
| æ–¹æ³• | è°ƒç”¨æ—¶æœº | ç”¨é€” | æ˜¯å¦å¯è°ƒç”¨ setState |
| ---- | ---- | ---- | ---- |
| getDerivedStateFromProps | æ¯æ¬¡æ¸²æŸ“å‰ | æ ¹æ® props æ›´æ–° state | âŒ |
| shouldComponentUpdate | æ›´æ–°å‰ | æ€§èƒ½ä¼˜åŒ–ï¼Œæ§åˆ¶æ˜¯å¦æ¸²æŸ“ | âŒ |
| render | å¿…é¡»å®ç°çš„æ–¹æ³• | è¿”å› jsx | âŒ |
| getSnapShotBeforeUpdate | Dom æ›´æ–°å‰ | è·å– DOM çš„å¿«ç…§ä¿¡æ¯ | âŒ |
| componentDidUpdate | æ›´æ–°å®Œæˆå | DOM æ“ä½œï¼Œç½‘ç»œè¯·æ±‚ | âœ… |

å¸è½½ï¼š æ¸…(componentWillUnmount)
| æ–¹æ³• | è°ƒç”¨æ—¶æœº | ç”¨é€” | æ˜¯å¦å¯è°ƒç”¨ setState |
| ---- | ---- | ---- | ---- |
| componentWillUnmount | ç»„ä»¶å¸è½½å‰ | æ¸…ç†æ“ä½œï¼ˆè®¡æ—¶å™¨ï¼Œè®¢é˜…ï¼‰ | âŒ |

é”™è¯¯å¤„ç†ï¼š æ´¾(getDerivedStateFromError) -> è®°(componentDidCatch)

| æ–¹æ³•                     | è°ƒç”¨æ—¶æœº           | ç”¨é€”         | æ˜¯å¦å¯è°ƒç”¨ setState |
| ------------------------ | ------------------ | ------------ | ------------------- |
| getDerivedStateFromError | åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯å | æ¸²æŸ“å¤‡ç”¨ UI  |                     |
| componententDidCatch     | åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯å | è®°å½•é”™è¯¯å½¢è±¡ |                     |

é™„åŠ ï¼šclass çš„ç”Ÿå‘½å‘¨æœŸæ€ä¹ˆä½¿ç”¨ hook çš„å¯¹æ¯”

| æ–¹æ³•                     | hook                     | xx  | xx  |
| ------------------------ | ------------------------ | --- | --- |
| constructor              | useState åˆå§‹åŒ–          | xx  | xx  |
| getDerivedStateFromProps | useState+useEffect       | xx  | xx  |
| render                   | å‡½æ•°ç»„ä»¶æœ¬èº«             | xx  | xx  |
| componententDidMount     | useEffect                | xx  | xx  |
| shouldComponentUpdate    | useMemo                  | xx  | xx  |
| componententDidUpdate    | useEffect                | xx  | xx  |
| componententDidUnmount   | useEffect è¿”å›çš„æ¸…ç†å‡½æ•° | xx  | xx  |

## useEffect å’Œ useLayoutEffect

| å¯¹æ¯”     | useEffect                      | useLayoutEffect               |
| -------- | ------------------------------ | ----------------------------- |
| æ—¶æœº     | æµè§ˆå™¨æ¸²æŸ“å                   | DOM æ›´æ–°å‰ï¼Œæ¸²æŸ“å‰ï¼ˆåŒæ­¥ï¼‰    |
| å½¢å¼     | å¼‚æ­¥                           | åŒæ­¥                          |
| æ¸²æŸ“é˜»å¡ | å¦                             | æ˜¯                            |
| é€‚ç”¨åœºæ™¯ | å¤§å¤šæ•°å‰¯ä½œç”¨ï¼ˆæ•°æ®è¯·æ±‚ã€è®¢é˜…ï¼‰ | è¯»å– DOM å¹¶åŒæ­¥ä¿®æ”¹ï¼ˆä¸é—ªçƒï¼‰ |
| æ€§èƒ½å½±å“ | æ— æ˜æ˜¾å½±å“                     | å¯èƒ½é˜»å¡æ¸²æŸ“                  |

## react ä¸ºä»€ä¹ˆ hooks ä¸èƒ½æ”¾åœ¨æ¡ä»¶åˆ¤æ–­æˆ–è€…åµŒå¥—é‡Œã€‚

æ ¸å¿ƒåŸå› ï¼šReact ä¾èµ– Hooks çš„è°ƒç”¨é¡ºåºæ¥æ­£ç¡®å…³è”çŠ¶æ€å’Œå‰¯ä½œç”¨ï¼Œç ´åé¡ºåºä¼šå¯¼è‡´çŠ¶æ€ç®¡ç†æ··ä¹±ã€‚
å…·ä½“åŸå› ï¼šHooks ä¾èµ–â€œç¨³å®šçš„è°ƒç”¨é¡ºåºâ€ã€‚react å†…éƒ¨é€šè¿‡ä¸€ä¸ª`hooké“¾è¡¨`æ¥ç®¡ç†ç»„ä»¶çš„ hooksï¼ˆuseStateã€useEffectï¼‰ã€‚æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œreact ä¼šæŒ‰é¡ºåºéå†è¿™ä¸ªé“¾è¡¨ï¼Œå°†æ¯ä¸ª hook ä¸å¯¹åº”çš„çŠ¶æ€/å‰¯ä½œç”¨å…³è”ã€‚è¿™ä¸ªæœºåˆ¶çš„å‰ææ˜¯ï¼š**æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒHooks çš„è°ƒç”¨é¡ºåºå¿…é¡»å®Œå…¨ä¸€è‡´ã€‚**

å®é™…åæœï¼šæŠ¥é”™æˆ–è€…çŠ¶æ€å¼‚å¸¸ï¼Œå¼€å‘ç¯å¢ƒç›‘æµ‹åˆ° hook è°ƒç”¨é¡ºåºä¸ä¸€è‡´ï¼Œå¹¶æŠ›å‡ºæ˜ç¡®é”™è¯¯ï¼š`Error:Rendered more hooks than during the previous render`.

### æ€»ç»“

1. Hook é“¾è¡¨ä¸çŠ¶æ€çš„å…³è”ã€‚å®Œå…¨ä¾èµ–è°ƒç”¨é¡ºåºï¼Œæ¯ä¸€ä¸ª hook æŒ‰è°ƒç”¨é¡ºåºå¯¹åº”é“¾è¡¨çš„ä¸€ä¸ªæœºç‚¹ï¼ŒèŠ‚ç‚¹å­˜å‚¨è¯¥ Hook çš„çŠ¶æ€/å‰¯ä½œç”¨ä¿¡æ¯ã€‚
2. é¡ºåºä¸ä¸€è‡´å±å®³ï¼šå¦‚æ¡ä»¶ã€å¾ªç¯å¯¼è‡´ä¸¤æ¬¡æ¸²æŸ“çš„ hooks è°ƒç”¨é¡ºåº/æ•°é‡ä¸ä¸€æ ·ï¼Œé“¾è¡¨éå†ä¸å®é™…è°ƒç”¨æ— æ³•åŒ¹é…ï¼Œæœ€ç»ˆçŠ¶æ€é”™ä¹±ï¼ˆè¯»é”™ã€ä¸¢å¤±ï¼‰
3. è®¾è®¡æœ¬è´¨ï¼šReact é€šè¿‡â€é¡ºåºåŒ¹é…â€œè€Œéâ€å‘½åæ ‡è¯†â€ç®¡ç† Hooksï¼Œæ˜¯ä¸ºäº†ç®€åŒ– APIï¼ˆæ— éœ€æ‰‹åŠ¨å‘½åçŠ¶æ€ï¼‰å¹¶ä¿è¯ æ€§èƒ½ï¼ˆé“¾è¡¨éå†æ•ˆç‡é«˜ï¼‰ã€‚è¿™ä¸€è®¾è®¡å†³å®š Hooks å¿…é¡»åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨ï¼Œä¸èƒ½è¢«æ¡ä»¶é€»è¾‘åŒ…è£¹ã€‚

## react å¸¸è§çš„ hooks

- çŠ¶æ€ç®¡ç†ï¼š`useState` `useReducer`
- å‰¯ä½œç”¨ï¼š`useEffect` `useLayoutEffect`
- æ€§èƒ½ä¼˜åŒ–ï¼š`useCallback` `useMemo`
- è·¨ç»„ä»¶é€šä¿¡ï¼š `useContext`
- DOM/å˜é‡ï¼š `useRef` `useImperativeHandle`
- è°ƒè¯•ï¼š`useDebugValue`

## immutable.js ä¸ºä»€ä¹ˆèƒ½ä¼˜åŒ–æ€§èƒ½

æ ¸å¿ƒæ˜¯ â€œä¸å¯å˜æ•°æ® + ç»“æ„å…±äº«â€ã€‚å½“æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œè¦ä¿è¯æ—§æ•°æ®åŒæ—¶å¯ç”¨ä¸”ä¸å˜ï¼ŒåŒæ—¶ä¸ºäº†é¿å… deepCopy æŠŠæ‰€æœ‰èŠ‚ç‚¹éƒ½å¤åˆ¶ä¸€éå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼ŒImmutable ä½¿ç”¨[ç»“æ„å…±äº«]().å³å¦‚æœå¯¹è±¡æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåªä¿®æ”¹è¿™ä¸ªèŠ‚ç‚¹å’Œå—å®ƒå½±å“çš„çˆ¶èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹åˆ™è¿›è¡Œå…±äº«ã€‚è¯·çœ‹ä¸‹é¢åŠ¨ç”»ï¼š
![immutable](./readmeImg/immutable.awebp)
å‡½æ•°ç»„ä»¶

```js
import { useState } from "react";
import { Map } from "immutable";

function UserProfile() {
  // åˆå§‹åŒ–ImmutableçŠ¶æ€
  const [user, setUser] = useState(Map({ name: "Bob", age: 25 }));

  // ä¿®æ”¹çŠ¶æ€ï¼ˆè¿”å›æ–°Mapï¼‰
  const handleIncrementAge = () => {
    // ç”¨updateæ›´æ–°ageï¼ˆåŸçŠ¶æ€ä¸å˜ï¼Œè¿”å›æ–°çŠ¶æ€ï¼‰
    const newUser = user.update("age", (age) => age + 1);
    setUser(newUser); // è§¦å‘é‡æ¸²æŸ“
  };

  return (
    <div>
      <p>Name: {user.get("name")}</p>
      <p>Age: {user.get("age")}</p>
      <button onClick={handleIncrementAge}>+1 Age</button>
    </div>
  );
}
```

æ€§èƒ½ä¼˜åŒ–- å€¼ä¸å˜ï¼Œå¼•ç”¨ä¸å˜ï¼›

```jsx
import { memo } from "react";
import { Map } from "immutable";
// å­ç»„ä»¶ï¼šæ¥æ”¶Immutableçš„userä½œä¸ºprops
const UserInfo = memo(({ user }) => {
  console.log("UserInfo æ¸²æŸ“"); // ä»…åœ¨userå¼•ç”¨å˜åŒ–æ—¶è§¦å‘
  return <p>Name: {user.get("name")}</p>;
});
// çˆ¶ç»„ä»¶
function Parent() {
  const [user, setUser] = useState(Map({ name: "Dave" }));
  return (
    <div>
      <UserInfo user={user} />
      <button onClick={() => setUser(user.set("name", "Dave"))}>
        ç‚¹å‡»ï¼ˆnameæœªå®é™…å˜åŒ–ï¼ŒUserInfoä¸é‡æ¸²æŸ“ï¼‰
      </button>
    </div>
  );
}
```

æ³¨æ„äº‹é¡¹ï¼š

- é¿å…é¢é¢‘ç¹ä½¿ç”¨`toJS()` å¤§å‹æ•°æ®å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚
- åµŒå¥—ç»“æ„ä¿®æ”¹`setIn`ï¼šå¯¹äºå¤šå±‚åµŒå¥—çš„`Map`å’Œ`List`ï¼Œä¼˜å…ˆä½¿ç”¨`setIn/updateIn`è€Œéå¤šæ¬¡`get`+`set`
- ä¸ Redux é…åˆï¼Œ`state`é€šå¸¸è®¾è®¡ä¸ºä¸å¯å˜ï¼Œå¯ç”¨ Immutable çš„`Map/List`ä½œä¸º state å®¹å™¨ï¼Œreducer ä¸­é€šè¿‡`set/update`ç­‰æ–¹æ³•è¿”å›æ–°çš„ stateï¼Œé…åˆ`reselect`åº“è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ã€‚

## useCallback å’Œ useMemo

useCallback å’Œ useMemo éƒ½æ˜¯ç”¨äºæ€§èƒ½ä¼˜åŒ–çš„ Hookï¼Œå®ƒä»¬é€šè¿‡ç¼“å­˜è®¡ç®—ç»“æœæ¥é¿å…ä¸å¿…è¦çš„é‡å¤è®¡ç®—æˆ–æ¸²æŸ“
| ç‰¹æ€§ | useMemo | useCallback |
| ------------------------ | ------------------------ | --- |
| è¿”å›å€¼ | ç¼“å­˜è®¡ç®—ç»“æœï¼ˆå€¼/å¯¹è±¡/æ•°ç»„) | ç¼“å­˜çš„å‡½æ•°æœ¬èº« |
| ç­‰æ•ˆå†™æ³• | useMemo(()=>fn,deps) | useCallBack(fn,deps)|  
|ä¼˜åŒ–ç›®æ ‡| é¿å…é‡å¤è®¡ç®—ã€å¼•ç”¨å˜åŒ– | é¿å…å‡½æ•°é‡å»ºã€å¼•ç”¨å˜åŒ–|
| å…¸å‹ä½¿ç”¨åœºæ™¯ | å¤æ‚è®¡ç®—ã€ç¨³å®šå¯¹è±¡å¼•ç”¨ | äº‹ä»¶å¤„ç†å‡½æ•°ã€å‡½æ•°ä¾èµ–ç¨³å®šæ€§ |
|ä½•æ—¶ä½¿ç”¨| è®¡ç®—æˆæœ¬é«˜çš„å€¼ï¼ŒuseEffect ä¾èµ–ï¼Œä¼ é€’ç»™å­ç»„ä»¶çš„ propsï¼ˆé˜»æ­¢å­ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼‰ | props ä¼ é€’ç»™å­ç»„ä»¶ï¼Œè¢« useEffect ä¾èµ–ï¼Œéœ€è¦ç¨³å®šå‡½æ•°å¼•ç”¨(debounce/throttle ç­‰)|

## React å¸¸è§çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ

- ç»„ä»¶æ¸²æŸ“ä¼˜åŒ–
  React.memo
  shouldComponentUpdate

- hook ä¼˜åŒ–

  - useMemo
  - useCallback

- åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–
  key ä¼˜åŒ–ï¼›è™šæ‹Ÿåˆ—è¡¨ä¼˜åŒ–`react-virtualized` `react-window`
- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
  ç»„ä»¶çº§åˆ«

```js
import LazyComponent = React.Lazy(()=>import('./HeavyComponent)')
function MyComponent(){

    return <>
    <Suspense fallback={}>
        <LazyComponent/>
    </Suspense>
     </>
}
```

è·¯ç”±çº§åˆ«

```js
  const router = CreateBrowserRouter([
      {
          path:'/lazy',
          component:React.lazy(() => import('./HeavyComponent'))
    },
    {
        path:'/',
        element:<Layout>,
        children:[
            {
                path:'dashboard',
                lazy:()=> import('./dashboard'),
            },
        ]
    }
  ])
```

- çŠ¶æ€ç®¡ç†ä¼˜åŒ–

  - æ‹†åˆ†å¤šä¸ª context
  - ç²¾ç»†åŒ–ã€åŸå­åŒ–çš„çŠ¶æ€ç®¡ç†(zustand/jotai)

- æ¸²æŸ“è¿‡ç¨‹ä¼˜åŒ–

  - å»¶è¿Ÿæ›´æ–°éå…³é”® UI(useDeferredValueã€useTransition)

- å†…å­˜ä¼˜åŒ–
  - æ¸…æ¥šå®šæ—¶å™¨ï¼Œç›‘å¬ç­‰èµ„æº
- æ„å»ºä¼˜åŒ–
  - treeShaking,bundle ä¼˜åŒ–ï¼Œå‹ç¼©ç­‰
  - èµ„æºä¼˜åŒ– ServiceWorkerï¼ŒHTTP ç¼“å­˜, CDN åŠ é€Ÿï¼Œé¢„åŠ è½½ï¼Œé¢„æ‰§è¡Œï¼ŒæŒ‰éœ€åŠ è½½ï¼Œç¼“å­˜åå•†ç­‰
  - SSR ä¼˜åŒ–ï¼ŒæŒ‰éœ€åŠ è½½

## ä¼˜åŒ–ç­–ç•¥ä¼˜å…ˆçº§

1. å…ˆæµ‹é‡ï¼šä½¿ç”¨ Profiler å®šä½ç“¶é¢ˆ(80/20 æ³•åˆ™)
2. å…³é”®è·¯å¾„ä¼˜å…ˆ:ä¼˜åŒ– ğŸ‘‹ å±å’Œæ ¸å¿ƒäº¤äº’
3. æ¸è¿›ä¼˜åŒ–ï¼šé¿å…è¿‡æ—©ä¼˜åŒ–
4. æƒè¡¡è€ƒè™‘ï¼šä¼˜åŒ–å¯èƒ½å¢åŠ ä»£ç å¤æ‚åº¦

### æŒ‡æ ‡ï¼š

- FP First Paint, FP
- FCP First Contentful Paintï¼ŒFCP
- LCP Largest Contentful Paint,LCP
- TTI Time To Interactiveï¼ŒTTI
- FMP First Meaningful Paint, FMP
- FID First Input Delayï¼Œ FID
- TBT Total Blocking Time, TBT

## React è™šæ‹Ÿ dom çš„å¥½å¤„

1. æ€§èƒ½ä¼˜åŒ–ï¼šæœ€å°åŒ–æ˜‚è´µ DOM æ“ä½œï¼Œæ™ºèƒ½æ‰¹é‡æ›´æ–°

- çœŸå® dom é—®é¢˜ï¼š
- - æ¯æ¬¡ dom æ“ä½œé€ æˆæµè§ˆå™¨é‡æ’å’Œé‡ç»˜
- - Dom å¯¹è±¡åŒ…å«æ•°ç™¾ä¸ªå±æ€§ï¼Œæ“ä½œæˆæœ¬æé«˜
- é«˜æ•ˆå·®å¼‚æ›´æ–°
- - æœ€å°åŒ–æ›´æ–°ã€åŒçº§æ¯”è¾ƒã€‘ã€key ä¼˜åŒ–åˆ—è¡¨æ›´æ–°ã€‘ã€ç»„ä»¶ç±»å‹å¯¹æ¯”ã€‘
- æ‰¹å¤„ç†æ›´æ–°ä¸äº‹åŠ¡æœºåˆ¶
- - ã€è™šæ‹Ÿ dom ä½œä¸ºä¸­é—´ç¼“å­˜å±‚ï¼Œæ”¶é›†å¤šæ¬¡çŠ¶æ€å˜æ›´ã€‘ã€äº‹ä»¶å¾ªç¯ç»“æŸç»Ÿä¸€æäº¤æ›´æ–°ã€‘ã€é¿å…ä¸­é—´çŠ¶æ€å¯¼è‡´çš„é—ªçƒæˆ–ä¸ä¸€è‡´ã€‘

2. æŠ½è±¡å±‚ä»·å€¼ï¼šè¿æ¥å£°æ˜å¼ç»„ä»¶ä¸å‘½ä»¤å¼ DOM æ“ä½œ
3. è·¨å¹³å°èƒ½åŠ›ï¼šç»Ÿä¸€æ¸²æŸ“æŠ½è±¡æ¥å£

- åŒä¸€å¥—ç»„ä»¶å¯æ¸²æŸ“åˆ°ä¸åŒç¯å¢ƒï¼šWebã€ç§»åŠ¨ç«¯ã€VRã€å‘½ä»¤è¡Œç•Œé¢

4. å¼€å‘ä½“éªŒï¼šä½¿å£°æ˜å¼ç¼–ç¨‹æ¨¡å¼æˆä¸ºå¯èƒ½

- å£°æ˜å¼ç¼–ç¨‹èŒƒå¼çš„æ”¯æ’‘

5. å¤æ‚åº”ç”¨ï¼šåœ¨åŠ¨æ€æ•°æ®é©±åŠ¨ UI åœºæ™¯ä¸‹è¡¨ç°å“è¶Š
   `è™šæ‹ŸDOMæ›´åƒæ˜¯reactå®ç°çš„å¿…è¦ç»†èŠ‚ï¼Œè€Œä¸æ˜¯å…¶æ ¸å¿ƒä»·å€¼ï¼ŒçœŸæ­£çš„ä»·å€¼åœ¨äºï¼šè®©å¼€å‘è€…èƒ½ä»¥å£°æ˜å¼çš„æ–¹å¼æè¿°UIï¼ŒåŒæ—¶ä¿æŒé«˜æ€§èƒ½æ›´æ–°`

## 1.React çš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ä»€ä¹ˆï¼Ÿåˆ—ä¸¾å…¶ä¸‰å¤§æ ¸å¿ƒç‰¹æ€§ï¼Ÿ

æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯å£°æ˜å¼ã€ç»„ä»¶åŒ–ã€å’Œå•å‘æ•°æ®æµå±•å¼€ï¼Œè¿™ä½¿å¾— React åœ¨æ„å»ºå¤æ‚çš„ç”¨æˆ·ç•Œé¢æ—¶æ›´åŠ é«˜æ•ˆã€å¯ç»´æŠ¤ã€‚å…¶ä¸‰å¤§æ ¸å¿ƒç‰¹æ€§ - è™šæ‹Ÿ DOMã€ ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ hooks

- è™šæ‹Ÿ DOM æä¾›æ€§èƒ½ä¼˜åŒ–ï¼Œå‡å°‘ä¸å¿…è¦çš„ DOM æ“ä½œã€‚
- ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç† è®©å¼€å‘è€…å¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹æ‰§è¡Œæ“ä½œã€‚
- hooks ä½¿å¾—å‡½æ•°å¼ç»„ä»¶èƒ½å¤Ÿç®¡ç†çŠ¶æ€å’Œå‰¯ä½œç”¨ï¼Œç®€åŒ–å¼€å‘æµç¨‹ã€‚

## é™„åŠ ï¼šSuspense æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

```tsx
// ä½¿ç”¨
function Comp() {
  return <>delay</>;
}
const Lazy = React.lazy(() => delay(5000).then((x) => ({ default: Comp })));
function App() {
  return (
    <>
      <Suspense fallback={"loading"}>
        <Lazy></Lazy>
      </Suspense>
    </>
  );
}
```

Suspense åªæ˜¯æä¾›äº†ç”¨äºåŠ è½½æ•°æ®çš„æ ‡å‡†ï¼Œ`åŠ è½½`->`è¿‡æ¸¡`->`å®Œæˆåˆ‡æ¢`
æ­¥éª¤ï¼š 1.éå†åˆ° primiay ç»„ä»¶ï¼ŒæŠ›å‡ºå¼‚å¸¸ 2.æ•è·ï¼Œæ·»åŠ å›è°ƒ 3.å±•ç¤º fallback 4.åŠ è½½å®Œæˆï¼Œæ‰§è¡Œå›è°ƒ 5.å±•ç¤ºåŠ è½½å®Œæˆåçš„ç»„ä»¶

## é™„åŠ ï¼šReact æ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³å®è·µ

React.memo

```tsx
// React.memoçš„ä½¿ç”¨

// 1.çº¯å±•ç¤ºç»„ä»¶
function Test1({data}:props){}
return default React.memo(Test1)
// 2.æ¸²æŸ“å¼€é”€å¾ˆå¤§çš„ç»„ä»¶
function Chat = React.memo(({data})=>{
    const chartData = processData(data) // æ˜‚è´µçš„æ¸²æŸ“è®¡ç®—
    return  <svg width="600" height="400">
      {/* å¤æ‚SVGæ¸²æŸ“ */}
    </svg>
})
// 3.é¢‘ç¹é‡æ–°æ¸²æŸ“çš„åˆ—è¡¨é¡¹
const ListItem = React.memo(({ item, onSelect }) => (
  <li onClick={() => onSelect(item.id)}>
    {item.name} - {item.price}
  </li>
));
// 4.ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
const ComplexComponent = React.memo(({config})=>{},(prevProps,nextProps)=>{
    return _.isEqual(prevProps.config, nextProps.config);
})
// 5.ç»„åˆ useMemoå’ŒuseCallback
const Test5 = ({data,callback})=>{
    return <></>
}
function App(){
  const items = [{},{}]
// ä½¿ç”¨useCallbackç¨³å®šå‡½æ•°å¼•ç”¨
  const handleClick = useCallback(() => {
    console.log('ç‚¹å‡»');
  }, []);
  // ä½¿ç”¨useMemoç¨³å®šå¯¹è±¡å¼•ç”¨
  const userData = useMemo(() => ({
    name: 'John',
    age: 30
  }), []);

    return <>

    <Test1 data='é™æ€æ•°æ®'></Test1>
    <Chat></Chat>
    {
        items.map(v=>(<ListItem/>))
    }
    <ComplexComponent></ComplexComponent>
    <Test5 data={userData} callback={handleClick}></Test5>
    </>
}
```

## 3.jsx çš„æœ¬è´¨ä¸Šä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæµè§ˆå™¨æ— æ³•ç›´æ¥è§£æ jsxï¼Ÿ

æœ¬è´¨æ˜¯ï¼š
1.js çš„è¯­æ³•æ‰©å±• 2.æ˜¯ React.createElement()çš„è°ƒç”¨ç®€å†™ 3.ä¸€ä¸ªå£°æ˜å¼çš„ UI æè¿°è¯­æ³•
ä¸ºä»€ä¹ˆæ— æ³•ç›´æ¥è§£æ jsxï¼Ÿå› ä¸ºæ˜¯ js æ‰©å±•è¯­æ³•ï¼Œæµè§ˆå™¨åªç†è§£çº¯ javascript

## 4.React ä¸ Angular/Vue çš„æ ¸å¿ƒåŒºåˆ«ï¼ˆå¦‚æ•°æ®ç»‘å®šï¼ŒDOM æ“ä½œã€æ¶æ„è®¾è®¡ï¼‰

| åŒºåˆ«     | React                                         | Angular          | Vue                                              |
| -------- | --------------------------------------------- | ---------------- | ------------------------------------------------ |
| æ•°æ®ç»‘å®š | å•å‘æ•°æ®æµ                                    | é»˜è®¤åŒå‘æ•°æ®ç»‘å®š | åŒå‘ç»‘å®š+å•å‘æ”¯æŒ                                |
| DOM æ“ä½œ | åŸºäº vdom                                     | çœŸå® Dom         | åŸºäº vdom                                        |
| æ¶æ„è®¾è®¡ | ä»…å…³æ³¨ viewï¼Œå…¶ä»–ä¾èµ–ç¤¾åŒºç”Ÿæ€                 | å…¨å®¶æ¡¶           | æä¾›æ¸è¿›å¼æ¡†æ¶                                   |
| æ¨¡ç‰ˆè¯­æ³• | JSX                                           | æ¨¡ç‰ˆè¯­æ³•+è£…é¥°å™¨  | æ¨¡ç‰ˆè¯­æ³•+å¯é€‰ JSX                                |
| é€‰å‹     | å¤§å‹å¤æ‚åº”ç”¨,å›¢é˜Ÿç†Ÿæ‚‰å‡½æ•°å¼ç¼–ç¨‹ã€éœ€è¦è·¨ç«¯èƒ½åŠ› | xx               | ä¸­å°å‹/å¿«é€Ÿè¿­ä»£ éœ€è¦æ¸è¿›å¼å¼€å‘ï¼Œå¯¹â€œçº¦å®šå¤§äºé…ç½®â€ |

é€‰å‹ï¼š

## 5.è§£é‡Š React çš„â€œå•å‘æ•°æ®æµâ€ç‰¹æ€§ä»¥å…¶å®è·µæ„ä¹‰

ç‰¹æ€§ï¼šæ•°æ®æµæ˜¯å•å‘ï¼Œä»çˆ¶ç»„ä»¶ä¼ é€’åˆ°å­ç»„ä»¶ï¼Œå­ç»„ä»¶æ— æ³•ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶çš„çŠ¶æ€ï¼Œè€Œæ˜¯é€šè¿‡å›è°ƒå‡½æ•°å‘ä¸Šä¼ é€’æ„å›¾ã€‚
æ„ä¹‰ï¼šå¯é¢„æµ‹æ€§æ›´å¼ºï¼šçŠ¶æ€çš„æ¥æºæ˜ç¡®ï¼Œç»„ä»¶è¡Œä¸ºè·Ÿå®¹æ˜“è¿½è¸ªå’Œæµ‹è¯•ã€‚è°ƒè¯•æ›´æ–¹ä¾¿ï¼šå¯ç”¨ React DevTools ç­‰å·¥å…·æŸ¥çœ‹æ•°æ®æµå‘ã€‚æ›´å®¹æ˜“æ„å»ºå¤§å‹åº”ç”¨ï¼šçŠ¶æ€æå‡ã€çŠ¶æ€ç®¡ç†ï¼ˆReduxã€Zustand ï¼‰

## 6.ä»€ä¹ˆæ˜¯åˆæˆäº‹ä»¶ï¼Ÿä¸åŸç”Ÿäº‹ä»¶æœ‰ä½•åŒºåˆ«ï¼Ÿ

åˆæˆæ˜¯äº‹ä»¶æ˜¯ React å°è£…çš„ä¸€ç§äº‹ä»¶ï¼Œå®ƒæ¨¡æ‹Ÿäº†æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶å¯¹è±¡ï¼Œä½†åˆæä¾›äº†ä¸€äº›é¢å¤–çš„ä¼˜åŠ¿ã€‚React ä½¿ç”¨åˆæˆäº‹ä»¶ç³»ç»Ÿæ¥å¤„ç†æ‰€æœ‰äº‹ä»¶ï¼ˆç‚¹å‡»ã€é¼ æ ‡äº‹ä»¶ã€é”®ç›˜äº‹ä»¶ï¼‰ï¼Œç›®çš„æ˜¯åœ¨ä¸åŒæµè§ˆå™¨ä¸­ç»Ÿä¸€å¤„ç†äº‹ä»¶ï¼Œä¼˜åŒ–æ€§èƒ½å¹¶é¿å…å†…å­˜æ³„æ¼ã€‚
ç‰¹ç‚¹ï¼š

- è·¨æµè§ˆå™¨ä¸€è‡´æ€§ï¼šä¸åŒæµè§ˆå™¨å¯¹äº‹ä»¶çš„å®ç°å’Œå¤„ç†æ–¹å¼å„ä¸ç›¸åŒï¼ŒReact å°è£…äº†è¿™äº›å·®å¼‚ï¼Œä½¿å¾—åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­äº‹ä»¶çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚é€šè¿‡åˆæˆäº‹ä»¶ï¼ŒReact é¿å…äº†æµè§ˆå™¨å·®å¼‚å¼•èµ·çš„é—®é¢˜ã€‚
  ä¸¾ä¾‹å„ä¸ªæµè§ˆå™¨äº‹ä»¶çš„å·®å¼‚
  | åŠŸèƒ½ç‚¹ | IE/edge | Chrome | Safari |
  | ---- | ---- | ---- | ---- |
  | äº‹ä»¶å¯¹è±¡è·å– | window.event | å›è°ƒå‚æ•° e | å›è°ƒå‚æ•° e |
  | é˜»æ­¢é»˜è®¤äº‹ä»¶ | e.returnValue = false | e.preventDefault() | e.preventDefault() |
  | é˜»æ­¢å†’æ³¡ | e.cancelBubble = true | e.stopProppagation() | e.stopProppagation() |
  | é¼ æ ‡æ»šè½®äº‹ä»¶ | onmousewheel | onwheel | onmousewheel |
  | é”®ç›˜äº‹ä»¶ç¼–ç  | e.keyCode | e.key | e.keyCode |
- äº‹ä»¶æ± åŒ–ï¼šReact åœ¨åˆæˆäº‹ä»¶å¯¹è±¡çš„å®ç°ä¸­é‡‡ç”¨äº†äº‹ä»¶æ± åŒ–çš„ç­–ç•¥ã€‚è¿™æ„å‘³å½“äº‹ä»¶å¤„ç†å®Œæˆåï¼ŒReact ä¼šå°†äº‹ä»¶å¯¹è±¡é‡æ–°æ”¾å…¥æ± ä¸­ï¼Œè€Œä¸æ˜¯ä¿ç•™æ¯ä¸ªäº‹ä»¶çš„å®ä¾‹ï¼Œä»è€Œå‡å°‘å†…å­˜çš„å¼€é”€ã€‚äº‹ä»¶æ± åŒ–çš„å®ç°æ„å‘³ç€äº‹ä»¶å¯¹è±¡çš„å±æ€§å€¼åªèƒ½åœ¨äº‹ä»¶å›è°ƒå‡½æ•°ä¸­è®¿é—®ï¼Œè€Œåœ¨å›è°ƒæ‰§è¡Œåï¼Œå±æ€§ä¼šè¢«æ¸…ç©ºã€‚ 1.å†…å­˜ä¼˜åŒ–
  | äº‹ä»¶ç±»å‹ | æ— æ± åŒ–ï¼ˆå¯¹è±¡æ•°ï¼‰ | æœ‰æ± åŒ–ï¼ˆå¯¹è±¡æ•°ï¼‰ | å†…å­˜èŠ‚çœ |
  | ---- | ---- | ---- | ---- |
  | ç‚¹å‡»äº‹ä»¶ | 1000 | 10 | 99% |
  | é¼ æ ‡ç§»åŠ¨ | 10000| 20 | 99.8% |
  | æ»šåŠ¨äº‹ä»¶ | 5000 | 15 | 98.7% | 2.åƒåœ¾å›æ”¶ä¼˜åŒ–
  åˆ›å»ºå¤§é‡çŸ­æœŸå¯¹è±¡ä¼šå¢åŠ åƒåœ¾å›æ”¶é¢‘ç‡ï¼›åƒåœ¾å›æ”¶ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œé€ æˆé¡µé¢å¡é¡¿ï¼ˆç§° GC å¡é¡¿ï¼‰ 3.é«˜é¢‘äº‹ä»¶æ€§èƒ½ä¼˜åŒ–

- ç»Ÿä¸€çš„æ¥å£ï¼šåˆæˆäº‹ä»¶å°è£…äº†æ ‡å‡†çš„åŸç”Ÿäº‹ä»¶æ¥å£ï¼Œå¹¶æä¾›ä¸€è‡´çš„ API æ¥è®¿é—®äº‹ä»¶çš„å±æ€§ï¼Œå¦‚`event.target` `event.preventDefault` `event.stopPropagation`
- äº‹ä»¶ä»£ç†ï¼šåŸç”Ÿäº‹ä»¶ä¼šåœ¨æ¯ä¸ª dom æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ã€‚åˆæˆäº‹ä»¶ï¼ŒReact ä¼šåœ¨`document`æ·»åŠ ä¸€ä¸ªå…¨å±€äº‹ä»¶ç›‘å¬å™¨ï¼Œå½“ä»»ä½•å­å…ƒç´ è§¦å‘çš„æ—¶å€™ï¼Œè¿™ä¸ªå…¨å±€ç›‘å¬å™¨ä¼šæ•è·åˆ°äº‹ä»¶å¹¶å°†å…¶åˆ†å‘ç»™ç›®æ ‡å…ƒç´ ï¼Œè¿™ç§æ–¹æ³•å‡å°‘äº†äº‹ä»¶ç›‘å¬å™¨çš„æ•°é‡ï¼Œé¿å…äº†æ¯ä¸ª DOM å…ƒç´ éƒ½ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½ã€‚

## 7.React ç»„ä»¶åŒ–çš„æ€æƒ³å¦‚ä½•æå‡ä»£ç å¤ç”¨ç‡ï¼Ÿ

- æ¨¡å—åŒ–ï¼Œé¡µé¢æ‹†åˆ†ä¸ºå„ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œç»„ä»¶ä½œä¸ºç‹¬ç«‹çš„å•å…ƒå¯ä»¥åœ¨ä¸åŒåœ°æ–¹å¤ç”¨ï¼Œé¿å…é‡å¤ä»£ç ã€‚
- å¯é…ç½®åŒ–ã€‚ä¼ å…¥ä¸åŒ props åœ¨ä¸åŒåœºæ™¯ä¸‹ä½¿ç”¨
- ç»„åˆåŒ–ã€‚é€šè¿‡ç»„ä»¶åµŒå¥—å’Œç»„åˆï¼Œæ„å»ºå¤æ‚ UI
- é€»è¾‘å¤ç”¨ã€‚è‡ªå®šä¹‰ hooks å’Œ hoc å’Œ render propsï¼Œå¯ä»¥å¤ç”¨é€»è¾‘è€Œä¸å½±å“ç»„ä»¶åŠŸèƒ½ã€‚
- æå‡çŠ¶æ€ã€‚é€šè¿‡å°†å…±äº«çŠ¶æ€æå‡åˆ°å…±åŒçš„ç»„ä»¶ï¼Œé¿å…äº†çŠ¶æ€é‡å¤ç®¡ç†å’ŒåŒæ­¥é—®é¢˜ã€‚
  è¿™äº›è®¾è®¡ç†å¿µå’Œæ¨¡å¼è®© React çš„ç»„ä»¶åŒ–ä¸ä»…ä»…æ˜¯ä»£ç çš„å¤ç”¨ï¼Œæ›´æ˜¯é€šè¿‡ç»“æ„åŒ–çš„æ–¹å¼ä½¿å¾— UI å’Œå’Œé€»è¾‘çš„ç®¡ç†å˜å¾—æ›´åŠ é«˜æ•ˆå’Œå¯ç»´æŠ¤ã€‚

## 8.è§£é‡Š React çš„â€œç»„ä»¶å³å‡½æ•°â€ç†å¿µï¼ˆå‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶çš„æœ¬è´¨åŒºåˆ«ï¼‰

ç†å¿µï¼š

1. React ç»„ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ¥å—è¾“å…¥ï¼ˆpropsï¼‰å¹¶è¿”å›è¾“å‡ºï¼ˆUI æè¿°ï¼‰çš„å‡½æ•°ã€‚
2. ç»„ä»¶çš„æ ¸å¿ƒèŒè´£æ˜¯ï¼šprops -> UI
3. ç»„ä»¶åº”è¯¥æ˜¯çº¯å‡€çš„ï¼šç›¸åŒè¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒè¾“å‡º
4. ç»„ä»¶åº”è¯¥æ˜¯å¯ç»„åˆçš„ï¼šåƒå‡½æ•°ä¸€æ ·å¯ä»¥åµŒå¥—ç»„åˆ

æœ¬è´¨åŒºåˆ«ï¼š

- 1.è¯­æ³•å’Œç»“æ„
- - å‡½æ•°ç»„ä»¶ï¼šä¸€ä¸ªæ™®é€šçš„ javascript å‡½æ•°ï¼Œæ¥å— props ä½œä¸ºå‚æ•°å¹¶è¿”å› jsxã€‚æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€this
- - ç±»ç»„ä»¶ï¼šåŸºäº ES6 ç±»å®šä¹‰ï¼Œç»§æ‰¿è‡ª React.Component,éœ€è¦æ‰‹åŠ¨å®ç° render æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ this.state å’Œ this.setState ç®¡ç†çŠ¶æ€ã€‚
- 2.ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š
- - ç±»ç»„ä»¶ï¼šç±»ç»„ä»¶æœ‰å†…å»ºçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™äº›æ–¹æ³•ä¸­æ‰§è¡Œå¼‚æ­¥æ“ä½œã€æ›´æ–°çŠ¶æ€ç­‰ã€‚ä¾‹å¦‚ `componentDidMount` `componentWillUnmount`
- - å‡½æ•°ç»„ä»¶ï¼šå‡½æ•°ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä½†é€šè¿‡ React Hooksï¼ˆå¦‚ useEffectï¼‰å¼•å…¥å‡½æ•°ç»„ä»¶çš„å‰¯ä½œç”¨å¤„ç†ï¼Œä½¿å‡½æ•°ç»„ä»¶å…·å¤‡ç±»ä¼¼ç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ã€‚useEffect å…è®¸æˆ‘ä»¬åœ¨ç»„ä»¶æŒ‚è½½ã€æ›´æ–°å’Œå¸è½½æ—¶æ‰§è¡Œå‰¯ä½œç”¨ã€‚
- 3.çŠ¶æ€ç®¡ç†
- - ç±»ç»„ä»¶ï¼šä½¿ç”¨ this.state æ¥ç®¡ç†çŠ¶æ€ï¼Œä½¿ç”¨ this.setState æ¥æ›´æ–°çŠ¶æ€ã€‚setState æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚
- - å‡½æ•°ç»„ä»¶ï¼šå‡½æ•°ç»„ä»¶åŸæœ¬æ˜¯æ— çŠ¶æ€çš„ï¼Œä½†éšç€ React Hooks çš„å¼•å…¥ï¼ŒuseState ä½¿å¾—å‡½æ•°ç»„ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨çŠ¶æ€ç®¡ç†ã€‚
    æ€»ç»“ï¼šReact çš„â€œç»„ä»¶å³å‡½æ•°â€ç†å¿µï¼Œæ„å‘³ç€ React ç»„ä»¶å¯ä»¥ç®€å•åœ°ç”¨å‡½æ•°å®ç°ï¼Œè€Œæ— éœ€ä¾èµ–å¤æ‚çš„ç±»ç»§æ‰¿ç»“æ„ã€‚å‡½æ•°ç»„ä»¶é€šè¿‡å…¶ç®€æ´çš„ç»“æ„ã€æ˜“äºç†è§£çš„ API å’Œæ€§èƒ½ä¼˜åŠ¿å—ï¼Œæˆä¸ºç°ä»£ React å¼€å‘çš„é¦–é€‰æ–¹å¼ã€‚

### ä¸ºä»€ä¹ˆè¦æœ‰ React Hooks

- ç±»ç»„ä»¶å¤ç”¨é—®é¢˜ã€‚éœ€è¦é€šè¿‡ï¼ˆHOCã€Render Propsï¼‰ã€‚ç¼ºç‚¹æ˜¯å¯èƒ½å½¢æˆåµŒå¥—åœ°åŸŸã€‚
- ç±»ç»„ä»¶é€»è¾‘åˆ†æ•£ã€‚ï¼ˆæ•°æ®è·å–ã€åŠ è½½çŠ¶æ€ã€é”™è¯¯å¤„ç†ï¼‰åˆ†æ•£åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸ`ComponentDidMount componentDidUpdate ComponentWillUnMount`
- this æŒ‡å‘é™·é˜±ã€‚éœ€è¦æ˜¾ç¤º`bind`æˆ–è€…ä½¿ç”¨ç®­å¤´å‡½æ•°ä¿è¯æ­£ç¡®ã€‚
- å‡½æ•°å¼ç»„ä»¶çš„ç¼ºé™·ã€‚åªèƒ½æ¸²æŸ“çº¯ UI å±•ç¤ºç»„ä»¶ã€‚

## 9.React çš„ä¸¥æ ¼æ¨¡å¼ï¼ˆStrict Modeï¼‰è§£å†³äº†å“ªäº›æ½œåœ¨é—®é¢˜ï¼Ÿ

1. è¿‡æ—¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š16.3 å`ComponentWillMount` `ComponentWillReceiveProps` `ComponentWillUpdate`ä¸åœ¨æ¨èä½¿ç”¨
2. æ„å¤–çš„å‰¯ä½œç”¨ï¼šä¸¥æ ¼æ¨¡å¼ä¼šå¼€å¯åŒé‡æ¸²æŸ“ï¼Œè¿™æ„å‘³ç€ç»„ä»¶çš„æ¸²æŸ“å’Œå‰¯ä½œç”¨å‡½æ•°ä¼šè¢«æ‰§è¡Œ 2 æ¬¡ï¼ŒReact ä¼šä¸»åŠ¨è§¦å‘ä¸¤æ¬¡æ¸²æŸ“æ¥ç¡®ä¿å‰¯ä½œç”¨å‡½æ•°æ˜¯çº¯ç²¹çš„ï¼Œä¸ä¼šå½±å“åç»­çš„æ¸²æŸ“è¿‡ç¨‹ã€‚
3. ä¸å®‰å…¨çš„ findDOMNodeã€‚è¿™ä¸ªæ–¹æ³•å·²ç»è¿‡æ—¶ï¼Œæ¨èä½¿ç”¨ Ref æ¥è®¿é—®å…ƒç´ ã€‚
4. ä¸æ¨èå­—ç¬¦ä¸² refs
5. ä¸ç¨³å®šçš„å‰¯ä½œç”¨ï¼ˆsetStateï¼‰ åœ¨ componenWillUnmount ä¸èƒ½ä½¿ç”¨ setState
6. å¼‚æ­¥æ¸²æŸ“çš„ç›¸å…³é—®é¢˜ï¼šreact16 ä¹‹åå¼•å…¥å¼‚æ­¥æ¸²æŸ“ï¼ˆconcurent renderingï¼‰ä¸¥æ ¼æ¨¡å¼å¯ä»¥å¸®åŠ©å¼€å‘è€…æå‰å‘ç°ä¸€äº›ä¸å¼‚æ­¥æ¸²æŸ“ç›¸å…³çš„ bug
7. ä¸ç¨³å®šçš„ä¸Šä¸‹æ–‡
   æ€»ç»“ï¼š
   React çš„ä¸¥æ ¼æ¨¡å¼æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…æ£€æµ‹å¹¶è§£å†³æ½œåœ¨çš„é”™è¯¯å’Œæ€§èƒ½é—®é¢˜ã€‚ä¸¥æ ¼æ¨¡å¼é€šè¿‡å¯¹ç»„ä»¶çš„åŒé‡æ¸²æŸ“ã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„æ£€æŸ¥ã€ä¸æ¨èçš„ API ä½¿ç”¨è­¦å‘Šç­‰æ–¹å¼ï¼Œç¡®ä¿å¼€å‘è€…ç¼–å†™çš„ä»£ç ç¬¦åˆ React çš„æœ€ä½³å®è·µã€‚

## 10.React çš„æœ€æ–°ç‰ˆæœ¬ç‰¹æ€§ï¼ˆReact18ï¼‰

å¹¶å‘æ¨¡å¼

- æ¸²æŸ“è¿‡ç¨‹å¯ä¸­æ–­ï¼ŒReact å¯åœ¨åˆé€‚æ—¶æœºè°ƒåº¦ä»»åŠ¡ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
- æ¯”å¦‚ï¼šè¾“å…¥æ¡†ä¸ä¼šå› å¤§å‹æ¸²æŸ“ä»»åŠ¡è€Œå¡é¡¿
  è‡ªåŠ¨æ‰¹å¤„ç†

```tsx
setCount(a + 1);
setName("aa");
```

useTransition
æ ‡è®°éç´§æ€¥æ›´æ–°
æ–° Root Api å’Œ SSR æ”¹è¿›
æ”¯æŒ createRoot æ›¿ä»£æ—§ç‰ˆ ReactDOM.render
SSR æ”¯æŒå»¶è¿ŸåŠ è½½ç‰‡æ®µã€æµå¼ä¼ è¾“ï¼ˆStreamingï¼‰

## 11.è°ƒç”¨ setState åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè§£é‡Šå…¶å¼‚æ­¥æ‰¹å¤„ç†æœºåˆ¶

åŸºæœ¬æµç¨‹ï¼š

1. å…¥é˜Ÿ-> å°†æ›´æ–°åŠ å…¥é˜Ÿåˆ—
2. æ‰¹å¤„ç†-> åˆå¹¶å¤šä¸ªæ›´æ–°è¯·æ±‚
3. åˆå¹¶-> è®¡ç®—æœ€ç»ˆçŠ¶æ€å€¼
4. åè°ƒ-> Fiber æ ‘ Diff è®¡ç®—
5. æäº¤-> åŸå­åŒ– DOM æ›´æ–°
   `Reactçš„æ‰¹å¤„ç†ä¸æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œè€Œæ˜¯ä¿è¯UIä¸€è‡´æ€§çš„å¿…è¦æœºåˆ¶ã€‚å®ƒç¡®ä¿æ— è®ºä½ è°ƒç”¨å¤šå°‘æ¬¡setStateï¼Œæœ€ç»ˆç”¨æˆ·åªä¼šçœ‹åˆ°ä¸€æ¬¡å®Œæ•´çš„UIæ›´æ–°`

æºç å¯¼è¯»ï¼š

1.æ›´æ–°å…¥é˜Ÿé˜¶æ®µ

```js
// setState å…¥å£
enqueueSetState(inst, payload, callback) {
  const fiber = getInstance(inst);
  const eventTime = requestEventTime();
  const lane = requestUpdateLane(fiber); // è·å–æ›´æ–°ä¼˜å…ˆçº§

  // åˆ›å»ºæ›´æ–°å¯¹è±¡
  const update = createUpdate(eventTime, lane);
  update.payload = payload;

  // åŠ å…¥æ›´æ–°é˜Ÿåˆ—
  enqueueUpdate(fiber, update);

  // è°ƒåº¦æ›´æ–°
  scheduleUpdateOnFiber(fiber, lane, eventTime);
}
```

æ ¸å¿ƒæ“ä½œ:

- åˆ›å»º update å¯¹è±¡ï¼ˆåŒ…å« payload å’Œå›è°ƒï¼‰

- å°† update åŠ å…¥ fiber èŠ‚ç‚¹çš„æ›´æ–°é˜Ÿåˆ—

- æ ‡è®° fiber ä¸ºéœ€è¦æ›´æ–° (fiber.lanes |= lane)

  2.æ‰¹å¤„ç†å†³ç­–é˜¶æ®µ

```js
function scheduleUpdateOnFiber(fiber, lane, eventTime) {
  // æ£€æŸ¥æ˜¯å¦åœ¨æ‰¹å¤„ç†ä¸Šä¸‹æ–‡ä¸­
  if (isInsideEventHandler) {
    // ğŸ…°ï¸ æ‰¹å¤„ç†æ¨¡å¼ï¼šæ ‡è®°ä¸ºå¾…å¤„ç†
    markRootUpdated(root, lane, eventTime);
  } else {
    // ğŸ…±ï¸ éæ‰¹å¤„ç†ï¼šç«‹å³è°ƒåº¦
    ensureRootIsScheduled(root, eventTime);
  }
}
```

3.çŠ¶æ€åˆå¹¶é˜¶æ®µ

```js
function processUpdateQueue(workInProgress, props, instance, renderLanes) {
  const queue = workInProgress.updateQueue;
  let baseState = queue.baseState;

  // éå†æ›´æ–°é˜Ÿåˆ—
  let update = queue.first;
  while (update !== null) {
    // åˆå¹¶çŠ¶æ€æ›´æ–°
    if (typeof update.payload === "function") {
      // å‡½æ•°å¼æ›´æ–°
      baseState = update.payload(baseState);
    } else {
      // å¯¹è±¡åˆå¹¶
      baseState = Object.assign({}, baseState, update.payload);
    }
    update = update.next;
  }

  // ä¿å­˜æœ€ç»ˆçŠ¶æ€
  workInProgress.memoizedState = baseState;
}
```

4.åè°ƒæ¸²æŸ“é˜¶æ®µ

```js
function performConcurrentWorkOnRoot(root) {
  // æ„å»º workInProgress æ ‘
  renderRootSync(root, lanes);

  // æ‰§è¡Œåè°ƒç®—æ³•
  workLoopSync();

  // æäº¤å‡†å¤‡
  prepareFreshStack(root, lanes);
}
```

Fiber åè°ƒæµç¨‹:

è°ƒç”¨ beginWork å¤„ç†ç»„ä»¶æ›´æ–°

æ‰§è¡Œ completeWork åˆ›å»º DOM èŠ‚ç‚¹

ç”Ÿæˆ effectListï¼ˆå˜æ›´é“¾è¡¨ï¼‰

5.æäº¤æ›´æ–°é˜¶æ®µ

```js
// é˜¶æ®µ1: Before mutation
commitBeforeMutationEffects();

// é˜¶æ®µ2: Mutation
commitMutationEffects(root, renderPriorityLevel);

// é˜¶æ®µ3: Layout
commitLayoutEffects(root, lanes);
```

æäº¤ä¸‰é˜¶æ®µ:

Before mutation:

è°ƒç”¨ getSnapshotBeforeUpdate

æš‚åœ useLayoutEffect æ¸…ç†å‡½æ•°

Mutation:

æ‰§è¡Œ DOM æ“ä½œï¼ˆå¢åˆ æ”¹ï¼‰

è°ƒç”¨ useEffect æ¸…ç†å‡½æ•°

Layout:

è°ƒç”¨ componentDidMount/Update

æ‰§è¡Œ useLayoutEffect å›è°ƒ

æ›´æ–° refs

```mermaid
sequenceDiagram
    participant UserCode
    participant ReactCore
    participant Scheduler
    participant Renderer

    UserCode->>ReactCore: setState() è°ƒç”¨
    ReactCore->>ReactCore: åˆ›å»ºæ›´æ–°å¯¹è±¡
    ReactCore->>ReactCore: åŠ å…¥æ›´æ–°é˜Ÿåˆ—
    ReactCore->>ReactCore: æ ‡è®°fiberè„çŠ¶æ€

    alt åœ¨æ‰¹å¤„ç†ä¸Šä¸‹æ–‡ä¸­
        ReactCore-->>Scheduler: å»¶è¿Ÿè°ƒåº¦(å¾®ä»»åŠ¡å»¶è¿Ÿ)
    else éæ‰¹å¤„ç†ä¸Šä¸‹æ–‡
        ReactCore->>Scheduler: ç«‹å³è°ƒåº¦(äº‹ä»¶å¾ªç¯å•æ¬¡è§¦å‘)
    end

    Scheduler->>Scheduler: åˆå¹¶ä»»åŠ¡é˜Ÿåˆ—
    Scheduler->>ReactCore: æ‰§è¡Œæ¸²æŸ“ä»»åŠ¡
    ReactCore->>ReactCore: åè°ƒé˜¶æ®µï¼ˆå¯ä¸­æ–­ï¼‰
    ReactCore->>Renderer: æäº¤DOMå˜æ›´
    Renderer->>Browser: æ›´æ–°çœŸå®DOM
```

å¼‚æ­¥æ‰¹å¤„ç†æœºåˆ¶ï¼š

- ç›®çš„ï¼šå‡å°‘ä¸å¿…è¦çš„ DOM æ›´æ–°
- å¤šä¸ª setState åˆå¹¶ï¼Œåªæ¸²æŸ“ä¸€æ¬¡ç»„ä»¶
- ç‰¹åˆ«åœ¨äº‹ä»¶å›è°ƒã€ç”Ÿå‘½å‘¨æœŸè¡¨ç°æ˜æ˜¾
- æ³¨æ„ï¼š`setState((prev)=>prev+1)`ä¼šæ­£ç¡®å åŠ 

## 13.å£°æ˜å‘¨æœŸçš„åˆ’åˆ†

é™„åŠ ï¼šReact çš„ class ç±»æœ‰ä»€ä¹ˆç”Ÿå‘½å‘¨æœŸï¼Ÿ

æ„å»ºï¼ˆconstructor)ï¼š æ´¾(getDerivedStateFromProps) -> ç»˜(render) -> æŒ‚(componentDidMount)
| æ–¹æ³• | è°ƒç”¨æ—¶æœº | ç”¨é€” | æ˜¯å¦å¯è°ƒç”¨ setState |
| ---- | ---- | ---- | ---- |
| constructor | ç»„ä»¶åˆå§‹åŒ– | åˆå§‹åŒ– stateï¼Œç»‘å®šæ–¹æ³• | âŒ |
| getDerivedStateFromProps | æ¯æ¬¡æ¸²æŸ“å‰ | æ ¹æ® props æ›´æ–° state | âŒ |
| render | å¿…é¡»å®ç°çš„æ–¹æ³• | è¿”å› jsx | âŒ |
| componententDidMount | ç»„ä»¶æŒ‚è½½å | DOM æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€è®¢é˜… | âœ… |

å˜æ›´ ï¼š æ´¾(getDerivedStateFromProps) -> åˆ¤(shouldComponentUpdate) -> ç»˜(render) -> æ•(getSnapShotBeforeUpdate) -> æ›´(componentDidUpdate)
| æ–¹æ³• | è°ƒç”¨æ—¶æœº | ç”¨é€” | æ˜¯å¦å¯è°ƒç”¨ setState |
| ---- | ---- | ---- | ---- |
| getDerivedStateFromProps | æ¯æ¬¡æ¸²æŸ“å‰ | æ ¹æ® props æ›´æ–° state | âŒ |
| shouldComponentUpdate | æ›´æ–°å‰ | æ€§èƒ½ä¼˜åŒ–ï¼Œæ§åˆ¶æ˜¯å¦æ¸²æŸ“ | âŒ |
| render | å¿…é¡»å®ç°çš„æ–¹æ³• | è¿”å› jsx | âŒ |
| getSnapShotBeforeUpdate | Dom æ›´æ–°å‰ | è·å– DOM çš„å¿«ç…§ä¿¡æ¯ | âŒ |
| componentDidUpdate | æ›´æ–°å®Œæˆå | DOM æ“ä½œï¼Œç½‘ç»œè¯·æ±‚ | âœ… |

å¸è½½ï¼š æ¸…(componentWillUnmount)
| æ–¹æ³• | è°ƒç”¨æ—¶æœº | ç”¨é€” | æ˜¯å¦å¯è°ƒç”¨ setState |
| ---- | ---- | ---- | ---- |
| componentWillUnmount | ç»„ä»¶å¸è½½å‰ | æ¸…ç†æ“ä½œï¼ˆè®¡æ—¶å™¨ï¼Œè®¢é˜…ï¼‰ | âŒ |

é”™è¯¯å¤„ç†ï¼š æ´¾(getDerivedStateFromError) -> è®°(componentDidCatch)

| æ–¹æ³•                     | è°ƒç”¨æ—¶æœº           | ç”¨é€”         | æ˜¯å¦å¯è°ƒç”¨ setState |
| ------------------------ | ------------------ | ------------ | ------------------- |
| getDerivedStateFromError | åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯å | æ¸²æŸ“å¤‡ç”¨ UI  |                     |
| componententDidCatch     | åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯å | è®°å½•é”™è¯¯å½¢è±¡ |                     |

## 14.ä¸ºä»€ä¹ˆ AJAX è¯·æ±‚æ”¾åœ¨`componentDidMount`?

- dom å·²ç»åŠ è½½å®Œæˆï¼šè¯¥æ–¹æ³•åœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæˆä¹‹åè°ƒç”¨ï¼Œé¿å…è®¿é—®æœªæ¸²æŸ“ DOM çš„é—®é¢˜
- é¿å…é‡å¤è¯·æ±‚ï¼šç›¸æ¯”æ”¾åœ¨ renderï¼ŒcomponentDidMount åªæ‰§è¡Œä¸€æ¬¡ï¼Œé¿å…è¯·æ±‚é‡å¤å‘å™¨ã€‚
- ç¬¦åˆå‰¯ä½œç”¨å¤„ç†è§„èŒƒï¼šReact æ¨èå°†å‰¯ä½œç”¨ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰å†™åœ¨é’©å­ä¸­ï¼Œä¸å‡½æ•°ç»„ä»¶ä¸­çš„`useEffect`ç”¨æ³•ä¸€è‡´ã€‚

## 15.shouldComponentUpdate çš„ä½œç”¨ä»¥åŠå¦‚ä½•é€šè¿‡å®ƒä¼˜åŒ–æ€§èƒ½ï¼Ÿ

`shouldComponentUpdate(nextProps,nextState)`æ–¹æ³•æ˜¯ç”¨æ¥æ‹¦æˆªæ›´æ–°ç”¨çš„ã€‚è¿”å› booleanã€‚
ä¼˜åŒ–æ–¹å¼ï¼š

- é¿å…ä¸å¿…è¦æ¸²æŸ“
- ç»“åˆä¸å¯å˜æ•°æ®(immutable)å’Œ(PureComponent)è¿›è¡Œä¼˜åŒ–ã€‚

## 16.React çš„ key å€¼åœ¨åˆ—è¡¨æ¸²æŸ“ä¸­çš„ä½œç”¨ä»¥åŠæœ€ä½³å®è·µ

åœ¨åŠ¨æ€æ¸²æŸ“åˆ—è¡¨ï¼Œkey å¸®åŠ© React é«˜æ•ˆè¯†åˆ«å“ªäº›åˆ—è¡¨é¡¹æ”¹å˜ã€æ·»åŠ æˆ–è€…åˆ é™¤ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œå¹¶ä¼˜åŒ–æ€§èƒ½ã€‚

key çš„ä½œç”¨ï¼š

- å”¯ä¸€æ ‡è¯†åˆ—è¡¨é¡¹
- æå‡æ€§èƒ½å’Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“
- ç¡®ä¿ç»„ä»¶æ­£ç¡®å¤ç”¨

key çš„å·¥ä½œåŸç†ï¼š

react åœ¨åˆ—è¡¨æ¸²æŸ“æ—¶çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š

- å¯¹æ¯”ä¸¤é¢—è™šæ‹Ÿ dom æ ‘ï¼šå½“ç»„ä»¶çŠ¶æ€æˆ–è€… props å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒReact ä¼šåˆ›å»ºæ–°çš„è™šæ‹Ÿ DOM æ ‘ï¼Œå¹¶å°†å…¶ä¸ä¹‹å‰çš„è™šæ‹Ÿ DOM æ ‘è¿›è¡Œå¯¹æ¯”ï¼ŒæŸ¥æ‰¾å·®å¼‚ã€‚
- åŒ¹é…å…ƒç´ ã€‚åªæœ‰ key ç›¸åŒæ‰èƒ½è¢«è®¤ä¸ºç›¸åŒçš„ã€‚
- æ›´æ–°å˜åŒ–çš„å…ƒç´ ã€‚æ ¹æ® key çš„æ¯”è¾ƒç»“æœï¼Œåªæ›´æ–°é‚£äº›éœ€è¦å˜åŒ–çš„ DOM å…ƒç´ ï¼Œè€Œä¸æ˜¯é‡æ–°æ¸²æŸ“åˆ—è¡¨ã€‚

æœ€ä½³å®è·µï¼š

- ç¡®ä¿å…ƒç´ å”¯ä¸€ keyã€‚
- æ•°ç»„é¿å…ä½¿ç”¨ç´¢å¼•åš keyã€‚
- ä½¿ç”¨ç¨³å®šçš„ keyã€‚
- ç¡®ä¿ key åœ¨åŒä¸€å±‚çº§å†…å”¯ä¸€ã€‚å½“å¤šå±‚åµŒå¥—åˆ—è¡¨æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸€å±‚ä½¿ç”¨ä¸åŒçš„ key è§„åˆ™

## 17.è§£é‡Š`forceUpdate`çš„ä½¿ç”¨åœºæ™¯å’Œæ½œåœ¨é£é™©

å¼ºåˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå³ä½¿ state æˆ–è€… props æœªå‘ç”Ÿæ”¹å˜ã€‚è°ƒç”¨è¯¥æ–¹æ³•ä¼šè·³è¿‡ shouldComponentUpdateï¼Œç›´æ¥è¿›å…¥ render

ä½¿ç”¨åœºæ™¯ï¼š

- æŸäº›å¤–éƒ¨å˜é‡ï¼ˆé stateï¼‰å˜æ›´ä½†ä¸è§¦å‘æ›´æ–°çš„æƒ…å†µã€‚
- é›†æˆç¬¬ä¸‰æ–¹é React åº“ï¼ˆå¦‚ canvasã€åœ°å›¾ï¼‰ç›´æ¥æ“ä½œ domï¼Œéœ€è¦æ‰‹åŠ¨åˆ·æ–°è§†å›¾ã€‚
- æ€§èƒ½ç›‘æ§ä»ªè¡¨ç›˜ï¼Œé«˜é¢‘ï¼ˆæ¯ s ä¸€æ¬¡ï¼‰ä¸é€‚åˆä½¿ç”¨ setState

æ½œåœ¨é£é™©ï¼š

- ç ´å React çš„æ•°æ®é©±åŠ¨åŸåˆ™ï¼šè¿èƒŒäº†"state æ”¹å˜é©±åŠ¨ UI æ›´æ–°"çš„æ€æƒ³
- æ€§èƒ½å¼€é”€å¤§ï¼šå®¹æ˜“å¼•èµ·æ— æ„ä¹‰çš„é‡æ¸²æŸ“
- è°ƒè¯•å›°éš¾ï¼Œä½¿ç”¨`forceUpdate`å®¹æ˜“éšè—çŠ¶æ€å˜åŒ–é€»è¾‘ï¼Œä¸æ˜“æ’æŸ¥é—®é¢˜ã€‚

å‡½æ•°å¼ç»„ä»¶çš„æ›¿ä»£æ–¹æ¡ˆ

```js
function Comp() {
  const [updateCount, setUpdateCount] = useState(0);
  const externalData = React.useRef(null);
  const forUpdate = () => {
    setUpdateCount((pre) => pre + 1);
  };
  useEffect(() => {
    sub.subscribe((data) => {
      externalData.cur;
      forUpdate();
    });
    return () => {
      sub.unsubscribe();
    };
  }, []);
}
```

## 18.ç±»ç»„ä»¶ä¸­`super(props)`çš„ä½œç”¨å’Œå¿…è¦æ€§

ä½œç”¨

- æ­£ç¡®åˆå§‹åŒ–çˆ¶ç±»æ„é€ å‡½æ•°,ç¡®ä¿ç»„ä»¶çš„`props`èƒ½æ­£ç¡®ä¼ é€’
- è®¿é—® this.props

## 19.å‡½æ•°ç»„ä»¶ä¸ç±»ç»„ä»¶ä¸­`this`ç»‘å®šçš„åŒºåˆ«ä»¥åŠè§£å†³æ–¹æ¡ˆ

ç±»ç»„ä»¶ï¼š

- æ„é€ å‡½æ•°ä¸­ä½¿ç”¨`this.handleClick.bind(this)`
- ç®­å¤´å‡½æ•°è‡ªåŠ¨ç»‘å®š thisï¼Œä½¿ this å§‹ç»ˆæŒ‡å‘å½“å‰ç»„ä»¶å®ä¾‹

å‡½æ•°ç»„ä»¶

- ä¸è¦ç»‘å®š this

## 20.äº‹ä»¶å¤„ç†ä¸­å¦‚ä½•è§£å†³ this æŒ‡å‘é—®é¢˜ã€‚

- æ„é€ å‡½æ•°ä¸­ä½¿ç”¨`this.handleClick.bind(this)`
- ç®­å¤´å‡½æ•°è‡ªåŠ¨ç»‘å®š thisï¼Œä½¿ this å§‹ç»ˆæŒ‡å‘å½“å‰ç»„ä»¶å®ä¾‹

## 21.å—æ§ç»„ä»¶ ä¸ éå—æ§ç»„ä»¶ åŒºåˆ«ä»¥åŠä½¿ç”¨åœºæ™¯

| ç‰¹æ€§     | å—æ§ç»„ä»¶                               | éå—æ§ç»„ä»¶                         |
| -------- | -------------------------------------- | ---------------------------------- |
| æ•°æ®ç®¡ç† | ç”± React ç»„ä»¶çš„çŠ¶æ€ç®¡ç†                | æ•°æ®ç”± DOM è‡ªèº«ç®¡ç†ï¼Œé€šè¿‡ ref è®¿é—® |
| ä½¿ç”¨æ–¹å¼ | æ¯æ¬¡è¾“å…¥å˜æ›´éƒ½ä¼šé€šè¿‡ onchange æ›´æ–°çŠ¶æ€ | ä½¿ç”¨ ref è·å–è¾“å…¥æ¡†å½“å‰å€¼          |
| æ€§èƒ½     | æ¯æ¬¡è¾“å…¥éƒ½å‘è§¦å‘é‡æ–°æ¸²æŸ“               | ä¸ä¼šé¢‘ç¹è§¦å‘                       |
| çµæ´»æ€§   | é«˜ã€èƒ½åšæ•°æ®éªŒè¯ã€è”åŠ¨æ“ä½œ             | ä½ï¼Œéš¾ä»¥å®ç°å¤æ‚åŠŸèƒ½               |
| ä½¿ç”¨åœºæ™¯ | å¤æ‚è¡¨å•ã€éœ€è¦éªŒè¯æˆ–è€…è”åŠ¨çš„åœºæ™¯       | ç®€å•è¡¨å•ã€ä¸éœ€è¦å¤æ‚äº¤äº’çš„åœºæ™¯     |

## 22.é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰çš„å®ç°åŸç†ä»¥åŠå…¸å‹åº”ç”¨åœºæ™¯

åŸç†ï¼šå—ç»„ä»¶å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œå¢å¼ºåŸæœ‰ç»„ä»¶çš„åŠŸèƒ½ã€‚å…è®¸å¤ç”¨ç»„ä»¶é€»è¾‘ã€‚
å®ä¾‹ï¼š

```js
function WithLoading(Component) {
  function WithLoading(props) {
    const {isLoading} = props;
    return <>{ isLoading? <div>loading</div> :<Component {...props}></Component>}</>; }</>
  }
  return WithLoading;
}

const MyComp = ({data})=> <div>{data}</div>
const EnhanceComp = WithLoading(MyComp)
```

å…¸å‹åœºæ™¯ï¼š

1. æƒé™æ§åˆ¶ï¼šæ ¹æ®ç”¨æˆ·æƒé™æ¥å†³å®šæ˜¯å¦æ¸²æŸ“æŸä¸ªç»„ä»¶
2. ä»£ç æ‹†åˆ†ï¼šæ ¹æ®éœ€è¦åŠ¨æ€åŠ è½½ç»„ä»¶
3. å¢å¼ºåŠŸèƒ½ï¼šä¾‹å¦‚ç»™ç»„ä»¶å†…å¢åŠ ç¼“å­˜ã€è¯·æ±‚æ•°æ®çš„åŠŸèƒ½ç­‰ã€‚

## 23.å¦‚æœé€šè¿‡ React.memo ä¼˜åŒ–å‡½æ•°ç»„ä»¶ç­‰æ€§èƒ½ï¼Ÿ

ä½¿ç”¨ï¼šç”¨æ¥åŒ…è£…ç»„ä»¶ã€åªè¦ props æ²¡å˜ï¼Œå°±è·³è¿‡æ¸²æŸ“ã€‚
æ¯”è¾ƒåŸç†ï¼šæµ…æ¯”è¾ƒ å¦‚æœæ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ç±»å‹å‘ç”Ÿæ”¹å˜ï¼Œä¼šé‡æ–°æ¸²æŸ“ã€‚
è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼š

```js
const MyComponent = React.memo(
  (props) => {
    //code
  },
  (preProps, nowProps) => {
    //custom logic
    if (preProps.value !== nowProps.value) {
      return false; //ä¸è·³è¿‡æ¸²æŸ“
    } else {
      return true; //è·³è¿‡æ¸²æŸ“ã€‚
    }
  }
);
```

## 24.è§£é‡Š React çš„â€é”™è¯¯è¾¹ç•Œâ€æœºåˆ¶

React çš„é”™è¯¯è¾¹ç•Œæœºåˆ¶å…è®¸ä½ åœ¨åº”ç”¨ä¸­æ•è· js ç²—æ¬§æ–‡ï¼Œå¹¶å±•ç¤ºå¤‡ç”¨ UIï¼Œä¸ä¼šå¯¼è‡´æ•´ä¸ªç»„ä»¶æ ‘å¥”æºƒã€‚é”™è¯¯è¾¹ç•Œä¸Š react ç»„ä»¶ï¼Œä¼šæ•è·å­ç»„ä»¶æ ‘çš„é”™è¯¯ã€‚

```js
class ErrorBoundary extends React.Componnet {
  construcotr(props) {
    super(props);
    this.state = { hasError: false };
  }
  getDerivedStateFromError(error) {
    // æ›´æ–°çŠ¶æ€å·²æ¸²æŸ“å¤‡ä»½ui
    return {
      hasError: true,
    };
  }
  componentDidCatch(error, info) {
    console.log(error, info);
  }
  render() {
    if (this.state.hasError) {
      return <div>404 Not Find</div>; //å¤‡ç”¨UI
    } else {
      return <div>{this.props.children}</div>;
    }
  }
}
```

## setState çš„æ ¸å¿ƒå®ç°

### ç”¨æ³•

1. å¯¹è±¡å½¢å¼:`this.setState({ key: newValue })`
2. å‡½æ•°å½¢å¼:`this.setState((prevState, props) => ({ key: prevState.key + 1 }))`
   ç¬¬äºŒä¸ªå¯é€‰å‚æ•°æ˜¯å›è°ƒå‡½æ•°ï¼š`this.setState(updater, callback)`åœ¨çŠ¶æ€æ›´æ–°å®Œæˆä¸”ç»„ä»¶é‡æ–°æ¸²æŸ“åæ‰§è¡Œï¼ˆç”¨äºè·å–æœ€æ–°çŠ¶æ€ï¼‰ã€‚

### æ ¸å¿ƒåŸç†

å¹¶éç›´æ¥ä¿®æ”¹`this.state`å¹¶ç«‹å³æ›´æ–° DOMï¼Œè€Œæ˜¯é€šè¿‡ä¸€å¥—**çŠ¶æ€æ›´æ–°æœºåˆ¶+æ‰¹å¤„ç†**çš„æœºåˆ¶å®ç°ã€‚
æ ¸å¿ƒæµç¨‹ï¼š

1. çŠ¶æ€æ›´æ–°å…¥é˜Ÿï¼ˆä¸ç›´æ¥ä¿®æ”¹ this.state)ã€‚ä¸æ˜¯ç›´æ¥æ›´æ–°ï¼Œè€Œæ˜¯å°†ä¼ å…¥çš„â€œçŠ¶æ€æ›´æ–°æè¿°â€å…¥é˜Ÿã€‚ç›®çš„æ˜¯

- é¿å…é¢‘ç¹ä¿®æ”¹çŠ¶æ€å¯¼è‡´é¢‘ç¹æ¸²æŸ“
- `this.state`æœ¬èº«æ˜¯ä¸€ä¸ªåªè¯»å¿«ç…§ï¼Œ`this.state={}`ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“

2. æ‰¹å¤„ç†æ›´æ–°ç­–ç•¥ï¼ˆå¼‚æ­¥æ€§çš„æ ¸å¿ƒï¼‰
   å°†å¤šä¸ª`setState`è°ƒç”¨çš„æ›´æ–°è¯·æ±‚**æ‰¹å¤„ç†åˆå¹¶** ç„¶åä¸€æ¬¡æ€§å¤„ç†ï¼Œæœ€ç»ˆåªè§¦å‘ä¸€æ¬¡æ¸²æŸ“ã€‚

- ä½•æ—¶æ‰¹é‡æ›´æ–°ï¼Ÿ
- - React æ§åˆ¶åœºæ™¯ä¸‹ï¼ˆåˆæˆäº‹ä»¶å›è°ƒã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼‰`setState`æ˜¯å¼‚æ­¥çš„ã€‚
- - é React æ§åˆ¶åœºæ™¯ä¸‹ `setTimeout åŸç”Ÿäº‹ä»¶å›è°ƒ` `setState`æ˜¯åŒæ­¥çš„ã€‚
- æ‰¹å¤„ç†æ›´æ–°çš„å®ç°ï¼Ÿ é€šè¿‡**äº‹åŠ¡æœºåˆ¶æ ‡è®°å½“å‰æ˜¯å¦å¤„äºâ€œæ‰¹é‡æ›´æ–°æ¨¡å¼â€**ï¼Œæ˜¯ï¼Œæ›´æ–°è¯·æ±‚è¢«æš‚å­˜ï¼›ç¦»å¼€æ¨¡å¼ï¼Œä¸€æ¬¡æ€§å¤„ç†æš‚å­˜çš„æ›´æ–°ã€‚

3. çŠ¶æ€åˆå¹¶ä¸è®¡ç®—

- å¯¹è±¡æµ…åˆå¹¶
- å‡½æ•°ï¼Œè¿”å›å€¼ä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥å€¼

4. è§¦å‘æ›´æ–°

- è®¡ç®—å®Œæˆåï¼ŒReact ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“æµç¨‹ã€‚`shouldComponentUpdate` `render` `reconcile` `commit`

## 26.å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶çš„åŒºåˆ«ä»¥åŠé€‰å‹å»ºè®®

| åŒºåˆ«     | å‡½æ•°ç»„ä»¶   | ç±»ç»„ä»¶                       |
| -------- | ---------- | ---------------------------- |
| è¯­æ³•     | class      | function                     |
| çŠ¶æ€ç®¡ç† | this.state | useState                     |
| æ€§èƒ½     |            | æ²¡æœ‰å®ä¾‹ï¼Œç›¸å¯¹ç®€æ´ä¸”æ€§èƒ½æ›´å¥½ |

React å®˜æ–¹æ¨èå‡½æ•°ç»„ä»¶ï¼Œç‰¹åˆ«æ˜¯è‡ªä» hooks æ¨å‡ºåï¼Œå‡½æ•°ç»„ä»¶æ›´çµæ´»ï¼Œç®€æ´

## 27.å¦‚ä½•å®ç°çˆ¶å­é€šä¿¡ï¼Ÿå…„å¼Ÿé€šä¿¡ï¼Ÿ

- å­->çˆ¶ï¼šå›è°ƒå‡½æ•°(å‚æ•°)
- çˆ¶->å­ï¼šprops
- å…„å¼Ÿ -> å…„å¼Ÿ : å€ŸåŠ©çˆ¶ç»„ä»¶çš„çŠ¶æ€ æˆ–è€… ä½¿ç”¨å…¨å±€çŠ¶æ€ç®¡ç†ã€Context æˆ–è€…ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“ Redux ç­‰ã€‘

## 28.è§£é‡Š Context API çš„ä½œç”¨åŠä¸ Redux çš„å¯¹æ¯”

ContextAPI æ˜¯ React æä¾›ç”¨äºå¤¸ç»„ä»¶å…±äº«æ•°æ®çš„æœºåˆ¶ã€‚é¿å…å¤šä¸ªå±‚çº§ä¸­å±‚å±‚ä¼ é€’ props

- åˆ›å»º Context `React.createContext`
- æä¾›æ•°æ® `Provider`
- æ¶ˆè´¹æ•°æ® `Consumer` `useContext`
  |å¯¹æ¯”|ContextAPI|Redux|
  |---|---|---|
  |ç”¨é€”| ä¼ é€’å…¨å±€æ•°æ®ã€ä¸»é¢˜ã€è¯­è¨€è®¾ç½®ã€è®¤è¯ä¿¡æ¯ç­‰ã€‚é€‚ç”¨äºå°å‹çŠ¶æ€ç®¡ç†æˆ–è€…è¾ƒå°‘æ›´æ–°çŠ¶æ€|å¤æ‚çŠ¶æ€ç®¡ç†ï¼Œç‰¹åˆ«æ˜¯éœ€è¦åœ¨å¤šä¸ªç»„ä»¶é—´ä¼ é€’å¹¶æ“ä½œå¤§é‡æ•°æ®ã€‚é€‚åˆå¤æ‚åº”ç”¨å’Œä¸­å¤§å‹é¡¹ç›®|
  |åŠŸèƒ½|æä¾›æ•°æ®ä¼ é€’åŠŸèƒ½,æ²¡æœ‰å†…å»ºæœºåˆ¶æ¥å¤„ç†å¤æ‚çŠ¶æ€é€»è¾‘|æä¾›å¼ºå¤§çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼ŒStoreã€Actionã€Reducerã€Middleware|
  |ä½¿ç”¨åœºæ™¯|ç”¨æˆ·è®¤è¯ã€ä¸»é¢˜åˆ‡æ¢|å¤šå±‚çº§çŠ¶æ€ç®¡ç†ã€å¤§é‡ç»„ä»¶äº¤äº’ã€å¤æ‚å¼‚æ­¥æ“ä½œ|

## 29.å¦‚ä½•é€šè¿‡ useState å’Œ useEffect å®ç°ç±»ç»„ä»¶çš„çŠ¶æ€ä¸å£°æ˜å‘¨æœŸ

class çš„ç”Ÿå‘½å‘¨æœŸæ€ä¹ˆä½¿ç”¨ hook çš„å¯¹æ¯”

| æ–¹æ³•                     | hook                     | xx  | xx  |
| ------------------------ | ------------------------ | --- | --- |
| constructor              | useState åˆå§‹åŒ–          | xx  | xx  |
| getDerivedStateFromProps | useState+useEffect       | xx  | xx  |
| render                   | å‡½æ•°ç»„ä»¶æœ¬èº«             | xx  | xx  |
| componententDidMount     | useEffect                | xx  | xx  |
| shouldComponentUpdate    | useMemo                  | xx  | xx  |
| componententDidUpdate    | useEffect                | xx  | xx  |
| componententDidUnmount   | useEffect è¿”å›çš„æ¸…ç†å‡½æ•° | xx  | xx  |

## è‡ªå®šä¹‰ Hook çš„å®ç°åŸç†ä»¥åŠå…¸å‹åº”ç”¨åœºæ™¯

åŸç†ï¼šå…è®¸å‡½æ•°ç»„ä»¶å¤ç”¨çŠ¶æ€é€»è¾‘ï¼Œåˆ©ç”¨ React Hooks å®ç°å…±äº«çš„åŠŸèƒ½é€»è¾‘ã€‚
åœºæ™¯ï¼š

- æŠ½è±¡é‡å¤é€»è¾‘
- å°è£…å¤æ‚é€»è¾‘
- å¯ç»„åˆå‹ï¼šé€šè¿‡ç»„åˆè‡ªå®šä¹‰ hookï¼Œæé«˜ä»£ç å¯è¯»æ€§ï¼Œå¯å¤ç”¨æ€§

## 31.Redux çš„æ ¸å¿ƒæ¦‚å¿µï¼ˆStoreã€Actionã€Reducer)ä»¥åŠå·¥ä½œæµç¨‹

1. Storeï¼šå­˜å‚¨åº”ç”¨çŠ¶æ€çš„å¯¹è±¡ã€‚ä¸€ä¸ªåº”ç”¨åªèƒ½æœ‰ä¸€ä¸ª storeï¼Œå®ƒæ˜¯æ•°æ®çš„å”¯ä¸€æ¥æº `createStore`åˆ›å»º
2. Action:æè¿°å‘ç”Ÿçš„äº‹ä»¶å’Œæ“ä½œå¯¹è±¡ã€‚æ¯ä¸ª`action`å¿…é¡»åŒ…å«ä¸€ä¸ª`type`å­—æ®µã€‚è¡¨ç¤ºæ“ä½œç±»å‹ã€‚action è¿˜å¯ä»¥åŒ…å«`payload`
   å®ä¾‹ï¼š`{type:'ADD_ITEM',playload:{id:1}}`
3. Reducer:æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ¥å—å½“å‰çŠ¶æ€å’Œä¸€ä¸ª actionï¼Œè¿”å›æ–°çš„çŠ¶æ€ã€‚`reducer`æ ¹æ®`action`ç±»å‹æ¥å†³å®šå¦‚ä½•æ›´æ–°`state`

```js
function itemsReducer(state = [], action) {
  switch (action.type) {
    case "ADD_ITEM": {
      return [...state, action.payload.item];
    }
    default: {
      return state;
    }
  }
}
```

Redux çš„å·¥ä½œæµç¨‹

1. å‘èµ· Action,`dispatch(action)`
2. ä¼ é€’åˆ° Reducer `action`è¢«å‘é€åˆ° reducer ä¸­ï¼Œæ ¹æ® acton ç±»å‹æ›´æ–° state
3. æ›´æ–° Store:æ–°çš„ state è¢«è¿”å›å¹¶ä¿å­˜åœ¨ store ä¸­ã€‚
4. è§¦å‘ UI æ›´æ–°ï¼šstore çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–åï¼ŒReact ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ä»¥åæ˜ æ–°çš„çŠ¶æ€ã€‚

![alt text](./readmeImg/redux_toolkit.png)
redux-toolkit çš„ä½¿ç”¨

```jsx
// src/app/store.js
import { configureStore } from "@reduxjs/toolkit";
import counterReducer from "../features/counter/counterSlice";
export const store = configureStore({
  reducer: {
    counter: counterReducer,
  },
});

// å°† Redux Store æä¾›ç»™ React
ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById("root")
);

// features/counter/counterSlice.js
export interface CounterState {
  value: number;
}
const initialState: CounterState = {
  value: 0,
};
export const counterSlice = createSlice({
  name: "counter",
  initialState,
  reducers: {
    increment: (state) => {
      state.value += 1;
    },
    decrement: (state) => {
      state.value -= 1;
    },
    incrementByAmount: (state, action: PayloadAction<number>) => {
      state.value += action.payload;
    },
  },
});
export const { increment, decrement, incrementByAmount } = counterSlice.actions;
export default counterSlice.reducer;

// ä½¿ç”¨
export function Counter() {
  const count = useSelector((state: RootState) => state.counter.value);
  const dispatch = useDispatch();

  return (
    <div>
      <div>
        <button
          aria-label="Increment value"
          onClick={() => dispatch(increment())}
        >
          Increment
        </button>
        <span>{count}</span>
        <button
          aria-label="Decrement value"
          onClick={() => dispatch(decrement())}
        >
          Decrement
        </button>
      </div>
    </div>
  );
}
```

## 32.è§£é‡Š Redux ä¸­é—´ä»¶(Redux-Thunkã€Redux-Saga)çš„ä½œç”¨

**Redux ä¸­é—´ä»¶ï¼š**

æ˜¯åœ¨`dispatch`å’Œ`reducer`ä¹‹é—´çš„ä¸€å±‚ï¼Œå¢å¼º Redux åŠŸèƒ½ï¼Œæ¯”å¦‚å¤„ç†å¼‚æ­¥æ“ä½œã€æ—¥å¿—è®°å½•ã€å¼‚å¸¸å¤„ç†

**Redux-Thunk:**
å…è®¸`action creater`è¿”å›ä¸€ä¸ªå‡½æ•°è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°æ¥å—`dispatch`å’Œ`getState`ï¼Œå¯ä»¥ç”¨æ¥å¼‚æ­¥æ“ä½œã€‚ ä½¿å¾—åœ¨`action creator`ä¸­è¿›è¡Œå¼‚æ­¥è¯·æ±‚å˜å¾—å®¹æ˜“

```js
const fetchData = () => {
  return function (dispatch) {
    fetch("/data")
      .then((res) => res.json())
      .then((data) => {
        dispatch({ type: "UPDATE_DATA", payload: data });
      });
  };
};
```

**Redux-saga**
`redux-saga`æ˜¯åŸºäº Generator å‡½æ•°çš„ä¸­é—´ä»¶ï¼Œç”¨äºå¤„ç†å¤æ‚çš„å¼‚æ­¥æ“ä½œã€æ§åˆ¶æµç¨‹å’Œå‰¯ä½œç”¨ã€‚é€šè¿‡`yield`è¡¨è¾¾å¼æ¥æš‚åœå’Œæ¢å¤æ‰§è¡Œã€‚
`redux-saga`å…è®¸æ›´åŠ å¤æ‚çš„æ§åˆ¶æµç¨‹
redux-saga ä½¿ç”¨å®ä¾‹

```js
// 1. å®‰è£…ä¾èµ–  npm install redux-saga
// 2. å®šä¹‰ Redux Action Types
// actionTypes.js
export const FETCH_LIST = 'FETCH_LIST'; // è§¦å‘è¯·æ±‚çš„ action
export const FETCH_LIST_SUCCESS = 'FETCH_LIST_SUCCESS'; // è¯·æ±‚æˆåŠŸ
export const FETCH_LIST_FAILURE = 'FETCH_LIST_FAILURE'; // è¯·æ±‚å¤±è´¥

// 3. å®šä¹‰ Redux Reducer
// reducer.js
import { FETCH_LIST_SUCCESS, FETCH_LIST_FAILURE } from './actionTypes';

const initialState = {
  list: [],
  loading: false,
  error: null,
};

export default function listReducer(state = initialState, action) {
  switch (action.type) {
    case FETCH_LIST:
      return { ...state, loading: true, error: null };
    case FETCH_LIST_SUCCESS:
      return { ...state, loading: false, list: action.data };
    case FETCH_LIST_FAILURE:
      return { ...state, loading: false, error: action.error };
    default:
      return state;
  }
}

// 4. ç¼–å†™ Sagaï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
// Worker sagaï¼šå¤„ç†å®é™…è¯·æ±‚é€»è¾‘
function* fetchListSaga(action) {
  try {
    // è°ƒç”¨ APIï¼ˆé˜»å¡ç­‰å¾…ç»“æœï¼‰
    const params = action.payload;
    const data = yield call(api.getList, params); // ç­‰ä»·äº api.getList(params)
    // åˆ†å‘æˆåŠŸ action
    yield put({ type: FETCH_LIST_SUCCESS, data });
  } catch (error) {
    // åˆ†å‘å¤±è´¥ action
    yield put({ type: FETCH_LIST_FAILURE, error: error.message });
  }
}

// Watcher sagaï¼šç›‘å¬ FETCH_LIST actionï¼Œè§¦å‘ worker
function* watchFetchList() {
  // æ¯æ¬¡ FETCH_LIST è§¦å‘éƒ½æ‰§è¡Œ fetchListSagaï¼Œä¸”è‡ªåŠ¨å–æ¶ˆå‰ä¸€æ¬¡æœªå®Œæˆçš„ä»»åŠ¡ï¼ˆè§£å†³ç«æ€ï¼‰
  yield takeLatest(FETCH_LIST, fetchListSaga);
}

// å¯¼å‡ºæ ¹ sagaï¼ˆåˆå¹¶æ‰€æœ‰ watcherï¼‰
export default function* rootSaga() {
  yield all([watchFetchList()]); // all ç”¨äºå¹¶è¡Œå¯åŠ¨å¤šä¸ª saga
}

// 5.é…ç½®Redux Storeï¼Œé›†æˆsagaä¸­é—´ä»¶
// åˆ›å»º saga ä¸­é—´ä»¶
const sagaMiddleware = createSagaMiddleware();
// åˆå¹¶ reducers
const rootReducer = combineReducers({ list: listReducer });
// åˆ›å»º storeï¼Œåº”ç”¨ saga ä¸­é—´ä»¶
const store = createStore(rootReducer, applyMiddleware(sagaMiddleware));
// è¿è¡Œæ ¹ sagaï¼ˆå¯åŠ¨æ‰€æœ‰ watcherï¼‰
sagaMiddleware.run(rootSaga);
export default store;
```

## 33.React-Redux ä¸­`connect`å‡½æ•°ä¸`useSelector/useDispatch`çš„å¯¹æ¯”

```jsx
// connectçš„ç”¨æ³•
import { connect } from "react-redux";
import { increment } from "./action";
class Counter extends Component {
  render() {
    return (
      <div>
        <div>{this.props.count}</div>
        <button onClick={this.increment}>ç‚¹å‡»</button>
      </div>
    );
  }
}
const mapStateToProps = (state) => {
  return { count: state.count };
};
const mapDispatchToProps = (dispatch) => {
  return { increment: () => dispatch(increment()) };
};
export default connect(mapStateToProps, mapDispatchToProps)(Counter);
```

```jsx
// useSelector / useDispatch
import { useSelector, useDispatch } from "react-redux";
import { increment } from "./actions";

// å‡½æ•°ç»„ä»¶
const Counter = () => {
  // æå–çŠ¶æ€ï¼ˆç±»ä¼¼ mapStateToPropsï¼‰
  const count = useSelector((state) => state.counter.count);
  // è·å– dispatch æ–¹æ³•
  const dispatch = useDispatch();

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => dispatch(increment())}>+1</button>
    </div>
  );
};

export default Counter;
```

| å¯¹æ¯”     | connect                             | useSelector/useDispatch                 |
| -------- | ----------------------------------- | --------------------------------------- |
| åŠŸèƒ½     | è¿æ¥ç»„ä»¶å’Œ Redux                    | è®¢é˜… state å’Œ dispatch                  |
| æ€§èƒ½ä¼˜åŒ– | ä½¿ç”¨ shouldComponentUpdate ä¼˜åŒ–æ€§èƒ½ | æ¯æ¬¡éƒ½ä¼šè®¢é˜… Redux store å¹¶é‡æ–°æ¸²æŸ“ç»„ä»¶ |
| ä½¿ç”¨åœºæ™¯ | ä½¿ç”¨ class ç»„ä»¶                     | Hooks å‡½æ•°ç»„ä»¶                          |
| çµæ´»æ€§   | æä¾›æ›´å¤šæ§åˆ¶æƒ                      | ç®€æ´ï¼Œè¾ƒå°‘æ§åˆ¶                          |

## 34.å¦‚ä½•é€šè¿‡`useReducer`ç®¡ç†å¤æ‚ç»„ä»¶çŠ¶æ€

`useReducer`æ˜¯ React æä¾›çš„ä¸€ä¸ª Hookï¼Œç”¨äºå‡½æ•°ç»„ä»¶ä¸­ç®¡ç†å¤æ‚çš„çŠ¶æ€ã€‚ä½¿ç”¨çŠ¶æ€é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæ¶‰åŠå¤šä¸ªå­å€¼æˆ–éœ€è¦æ ¹æ®ä¸åŒ`action`æ›´æ–°çŠ¶æ€çš„åœºæ™¯ã€‚
ä½¿ç”¨åœºæ™¯ï¼š

- çŠ¶æ€æ˜¯å¤æ‚å¯¹è±¡ / æ•°ç»„ï¼Œéœ€è¦é¢‘ç¹éƒ¨åˆ†æ›´æ–°ï¼›
- æ›´æ–°é€»è¾‘åŒ…å«å¤šæ¡ä»¶åˆ†æ”¯æˆ–å¤æ‚è®¡ç®—ï¼›
- å¤šä¸ªçŠ¶æ€ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼›
- éœ€è¦å¤ç”¨çŠ¶æ€æ›´æ–°é€»è¾‘æˆ–è·¨ç»„ä»¶å…±äº«ï¼›
- å¸Œæœ›çŠ¶æ€å˜åŒ–å¯é¢„æµ‹ã€ä¾¿äºè°ƒè¯•ã€‚
- ä¾‹å¦‚ï¼Œè¡¨å•å¤„ç†ï¼ŒåŠ¨æ€æ•°æ®æ›´æ–°ï¼Œæ¯”å¦‚è´­ç‰©è½¦æ·»åŠ å•†å“`{items:newItem,totalCount,totalPrice}`

åä¹‹ï¼Œå¯¹äºç®€å•çš„ç‹¬ç«‹çŠ¶æ€ï¼ˆå¦‚å¼€å…³ã€è®¡æ•°å™¨ã€å•ä¸ªè¾“å…¥æ¡†å€¼ï¼‰ï¼ŒuseState æ›´ç®€æ´é«˜æ•ˆ

```jsx
const initialState = { count: 0 };
function reducer(state, action) {
  switch (action.type) {
    case "increment":
      return { count: state.count + 1 };
    case "decrement":
      return { count: state.count - 1 };
    case "incrementByAmount":
      return { count: state.count + action.payload.amount };
    default:
      return state;
  }
}
function Counter() {
  const [state, dispatch] = useReducer(reducer, initialState);
  return (
    <div>
      <div>{state.count}</div>{" "}
      <button onClick={dispatch("increment")}>ç‚¹å‡»</button>
    </div>
  );
}
```

## 35.çŠ¶æ€ç®¡ç†åº“å¦‚(Mobxï¼ŒRecoil)ä¸ Redux åˆ°ä¼˜åŠ£å¯¹æ¯”

| åŒºåˆ«       | Mobx                                           | Recoil                                                 | Redux                                      |
| ---------- | ---------------------------------------------- | ------------------------------------------------------ | ------------------------------------------ |
| ç¼ºç‚¹       | å¯èƒ½å¯¼è‡´æ›´éš¾è·Ÿè¸ªçš„çŠ¶æ€æµåŠ¨                     | å¤„äºè¾ƒæ–°é˜¶æ®µ                                           | æ ·æ¿ä»£ç å¤šï¼Œè¾ƒå°åº”ç”¨æ˜¾å¾—å¤æ‚               |
| ä¼˜ç‚¹       | api ç›´è§‚ï¼Œè‡ªåŠ¨è¿½è¸ªä¾èµ–å…³ç³»ï¼Œä¸éœ€è¦å¤§é‡æ ·æ¿ä»£ç  | æ”¯æŒç»†ç²’åº¦çŠ¶æ€ç®¡ç†ï¼Œé¿å…æ•´ä¸ªåº”ç”¨é‡æ–°æ¸²æŸ“ï¼Œå†…ç½®å¼‚æ­¥æ”¯æŒ | é€‚ç”¨å¤§å‹åº”ç”¨ï¼Œå®Œå–„ä¸­é—´ä»¶æ”¯æŒï¼Œç¤¾åŒºæ´»è·ƒåº¦é«˜ |
| ç¤¾åŒºæ´»è·ƒåº¦ | æ´»è·ƒåº¦é«˜                                       | æ´»è·ƒåº¦ä¸­ç­‰ï¼Œç›®å‰åªæ”¯æŒ Reactor                         | æ´»è·ƒåº¦é«˜                                   |

é™„ï¼š Redux å’Œ Mobx çš„åŒºåˆ«
|ç»´åº¦|Redux|Mobx|
|æ ¸å¿ƒæ€æƒ³|åŸºäºâ€œå‡½æ•°å¼ç¼–ç¨‹â€ï¼Œå¼ºè°ƒå¯é¢„æµ‹æ€§å’Œä¸¥æ ¼çŠ¶æ€æµè½¬|åŸºäºâ€œå“åº”å¼ç¼–ç¨‹â€ï¼Œå¼ºè°ƒé—´æ¥æ€§å’Œå¼€å‘æ•ˆç‡|
|çŠ¶æ€å¯å˜æ€§|çŠ¶æ€å¼**ä¸å¯å˜çš„**ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œéœ€è¦é€šè¿‡çº¯å‡½æ•°æ›´æ–°|çŠ¶æ€å¼**å¯å˜çš„**ï¼Œå¯ç›´æ¥ä¿®æ”¹ï¼Œç”± MobX è‡ªåŠ¨è·Ÿè¸ªå˜åŒ– |
|çŠ¶æ€æ›´æ–°æ–¹å¼|å¿…éœ€é€šè¿‡ actionï¼ˆæè¿°åšä»€ä¹ˆï¼‰-> reducer(çº¯å‡½æ•°ï¼Œè®¡ç®—æ›´æ–°çŠ¶æ€)çš„æµç¨‹æ›´æ–° | ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼ˆé€šå¸¸ç”¨`action`è£…é¥°å™¨æ ‡è®°ä¿®æ”¹é€»è¾‘ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨å®šä¹‰ reducer |
|ä¾èµ–è¿½è¸ª|æ‰‹åŠ¨è¿½è¸ªï¼ˆé€šè¿‡`useSelector` `mapStateToProps` ï¼‰| è‡ªåŠ¨è¿½è¸ªï¼ˆç»„ä»¶ä½¿ç”¨çŠ¶æ€æ—¶ï¼ŒMobx è‡ªåŠ¨è®°å½•ä¾èµ–ï¼ŒçŠ¶æ€å˜åŒ–æ—¶åªæ›´æ–°ä¾èµ–ç»„ä»¶ï¼‰ |
|å­¦ä¹ æ›²çº¿|è¾ƒé™¡ï¼ˆactionã€reducerã€middlewareã€ä¸å¯å˜æ€§ï¼‰|å¹³ç¼“ï¼ˆæ¥è¿‘ JS åŸç”Ÿæ€ç»´ã€åªéœ€ç†è§£ observableã€actionã€observerï¼‰|
|é€‚ç”¨åœºæ™¯|å¤§å‹åº”ç”¨ã€éœ€è¦ä¸¥æ ¼çŠ¶æ€ç®¡æ§ï¼ˆåä½œå¼€å‘ã€çŠ¶æ€å›æº¯ï¼‰|ä¸­å°å‹åº”ç”¨ã€è¿½æ±‚å¼€å‘æ•ˆç‡ã€å¿«é€Ÿè¿­ä»£|

```jsx
// redux è¿½æ±‚ä¸¥æ ¼éµå¾ª`action -> reducer -> store`çš„æµç¨‹ï¼ŒçŠ¶æ€ä¸å¯å˜
// 1.å®šä¹‰åŠ¨ä½œ
export const INCREMENT = "INCREMENT";
export const DECREMENT = "DECREMENT";
// action åˆ›å»ºå‡½æ•°ï¼ˆè¿”å› action å¯¹è±¡ï¼‰
export const increment = (payload) => ({
  type: INCREMENT,
  payload, // å¯é€‰å‚æ•°ï¼Œå¦‚æ­¥é•¿
});

export const decrement = () => ({
  type: DECREMENT,
});

// 2. reducerçº¯å‡½æ•°
const initState = {
  count:0
}
function counterReducer = (state = initState,action) = {
  switch(action.type) {
    case INCREMENT:
      // å¿…é¡»è¿”å›æ–°å¯¹è±¡ï¼ˆä¸å¯å˜ï¼‰ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹ state.count
      return { ...state, count: state.count + (action.payload || 1) };
    case DECREMENT:
      return { ...state, count: state.count - 1 };
    default:
      return state;
  }
}

// 3. åˆ›å»ºstore
// åˆ›å»º storeï¼ˆå”¯ä¸€æ•°æ®æºï¼‰
const store = createStore(counterReducer);

export default store;

// 4.åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const Counter = ()=>{
  // æ‰‹åŠ¨æœ€ç»ˆä¾èµ–
  const count = useSelector((state)=>state.count)
  const dispatch = useDispatch();
  return <>
    <p>Count: {count}</p>
      {/* è§¦å‘ action æ›´æ–°çŠ¶æ€ */}
      <button onClick={() => dispatch(increment(1))}>+1</button>
      <button onClick={() => dispatch(decrement())}>-1</button>
  </>
}

import { Provider } from 'react-redux';
// 5.åœ¨æ ¹ç»„ä»¶æ³¨å…¥store
function App(){
  return <Provider store={store}>
    <Counter></Counter>
  </Provider>
}
```

mobx çš„ä½¿ç”¨

```jsx
// åŸºäºå“åº”å¼ï¼ŒçŠ¶æ€å¯å˜ï¼Œè‡ªåŠ¨è¿½è¸ªä¾èµ–ï¼Œä»£ç æ›´ç®€æ´

class CounteStore {
  count = 0;
  constructor() {
    makeAutoObservable(this);
  }
  increment = (step = 1) => {
    this.count += step;
  };
  decrement = () => {
    this.count -= 1;
  };
}

// å®ä¾‹åŒ–
export const countStore = new CounterStore();

// 2.åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨observeråŒ…è£¹ç»„ä»¶ï¼Œä½¿å…¶å“åº”çŠ¶æ€å˜åŒ–
import { counterStore } from "./store";
const Counter = observer(() => {
  return (
    <div>
      <p>Count: {counterStore.count}</p>
      {/* ç›´æ¥è°ƒç”¨æ–¹æ³•ä¿®æ”¹çŠ¶æ€ */}
      <button onClick={() => counterStore.increment(1)}>+1</button>
      <button onClick={() => counterStore.decrement()}>-1</button>
    </div>
  );
});

// 3.æ ¹ç»„ä»¶ç›´æ¥ä½¿ç”¨ï¼ˆæ— éœ€Provideræ³¨å…¥ï¼‰
```

### æ€»ç»“

- Reduxï¼š é€šè¿‡â€œä¸å¯å˜çŠ¶æ€+çº¯å‡½æ•°â€ä¿è¯çŠ¶æ€å˜åŒ–å¯é¢„æµ‹ï¼Œé€‚åˆå¤§å‹é¡¹ç›®ä½†ä»£ç è¾ƒç¹çï¼›
- Mobxï¼š é€šè¿‡"å¯å˜çŠ¶æ€+è‡ªåŠ¨å“åº”"ç®€åŒ–å¼€å‘ï¼Œä»£ç ç®€æ´ä½†éœ€è¦ä¿¡ä»»å¼€å‘è€…å¯¹çŠ¶æ€çš„ä¿®æ”¹ï¼ˆå¯èƒ½å¯¼è‡´ä¸å¯é¢„æœŸæ€§ï¼‰

## 36.å¦‚ä½•è®¾è®¡å¯å¤ç”¨çš„è¡¨å•ç»„ä»¶ï¼Ÿéœ€è¦è€ƒè™‘å“ªäº›æ ¡éªŒä¸æäº¤é€»è¾‘ï¼Ÿ

1. è¡¨å•ç»“æ„ï¼šè¡¨å•ç»„ä»¶åº”æ¥å—å¿…è¦çš„ propsï¼Œå¦‚ initialValuesï¼ˆåˆå§‹å€¼ï¼‰ã€onSubmit(æäº¤å›è°ƒ)
2. çŠ¶æ€ç®¡ç†ï¼šä½¿ç”¨ useState æˆ–è€… useReducer ç®¡ç†è¡¨å•å­—æ®µçš„çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`useForm`æˆ–è€…ç¬¬ä¸‰æ–¹åº“`Formik`ç®¡ç†
3. æ ¡éªŒï¼šå­—æ®µæ ¡éªŒå¯ä»¥åœ¨æäº¤æ—¶è¿›è¡Œï¼Œæˆ–è€…ä½¿ç”¨å³æ—¶æ ¡éªŒï¼ˆonChange/onBlur)
4. å¯å¤ç”¨æ€§ï¼šè¡¨å•ç»„ä»¶åº”å½“æ˜¯é«˜åº¦å¯å¤ç”¨çš„ï¼Œå°½é‡é¿å…ç¡¬ç¼–ç ï¼Œå­—æ®µå’Œæ ¡éªŒé€»è¾‘åº”ç”± props ä¼ å…¥ã€‚

## 37.åŠ¨æ€ç»„ä»¶çš„å®ç°æ–¹å¼ï¼ˆå¦‚ React.lazy ä¸ Suspenseï¼‰

```jsx
const OtherComponent = React.lazy(() => import("./OtherComponent.jsx"));
function Count() {
  return (
    <>
      <Suspense fallback={<h1>Loading</h1>}>
        <OtherComponent />
      </Suspense>
    </>
  );
}
```

## 38.å¦‚ä½•å®ç°ç»„ä»¶çš„æ¡ä»¶æ¸²æŸ“å’Œå¾ªç¯æ¸²æŸ“ï¼Ÿ

```jsx
function Count(){
  const [isShow,setIsShow] = useState(true);
  const [list,setList]= useState([1,2,3]);
  reutrn  <div>
  {isShow ? <span>æ˜¾ç¤º</span> : null}
  {list.map(i=> {
    return (<div>{i}</div>)
  })}
  </div>
}
```

## 39.è§£é‡Šâ€œæ¸²æŸ“å±æ€§â€ï¼ˆRender Propsï¼‰æ¨¡å¼ä»¥åŠå…¶åº”ç”¨åœºæ™¯

React Props æ˜¯ react ä¸­ä¸€ç§çµæ´»çš„é€»è¾‘å¤ç”¨æ¨¡å¼ï¼Œæ ¸å¿ƒæ˜¯"é€šè¿‡å‚æ•°å‡½æ•° props ä¼ é€’æ¸²æŸ“é€»è¾‘"ï¼Œè®©ç»„ä»¶ä¸“æ³¨äºé€»è¾‘å°è£…ï¼ŒåŒæ—¶å…è®¸ä½¿ç”¨è€…å®Œå…¨æ§åˆ¶ UI å‘ˆç°ã€‚å®ƒç‰¹åˆ«é€‚ç”¨è§£å†³â€œé€»è¾‘ç›¸åŒä½† UI ä¸åŒâ€çš„å¤ç”¨é—®é¢˜ï¼Œç›¸æ¯”é«˜é˜¶ç»„ä»¶ï¼Œæ›´åŠ ç›´è§‚ï¼Œæ›´å°‘å‰¯ä½œç”¨ã€‚
æ¯”å¦‚å®ç°ä¸€ä¸ªé¼ æ ‡ç§»åŠ¨ç»„ä»¶

```jsx
function MouseMovePosition() {
  const [xy, setXY] = useState({ x: 0, y: 0 });
  const handler = useCallback((ev) => {
    setXY({ x: ev.pageX, y: ev.pageY });
  }, []);
  useEffect(() => {
    window.addEventListener("mousemove", handler);
    return window.removeEventListener("mousemove", handler);
  }, []);
  return <div>{children}</div>;
}

function Component() {
  return (
    <div>
      <MouseMovePosition>
        {" "}
        {({ x, y }) => (
          <div>
            {x}
            {y}
          </div>
        )}
      </MouseMovePosition>
    </div>
  );
}
```

## 40.å¦‚ä½•é€šè¿‡`forWardRef`è®¿é—®å­ç»„ä»¶çš„ Dom æˆ–è€…æ–¹æ³•

forWardRef æ˜¯ä¸€é¡¹å°†`ref`è‡ªåŠ¨åœ°é€šè¿‡ç»„ä»¶ä¼ é€’åˆ°å…¶å­ç»„ä»¶çš„æŠ€å·§ã€‚
ref åªèƒ½æŒ‚è½½åˆ°`æŸä¸ªclassç»„ä»¶æˆ–è€…HTMLå…ƒç´ ä¸Š`

```jsx
import React, { forwardRef, useRef, useEffect } from "react";

// 1. å®šä¹‰ HOCï¼šæ·»åŠ æ—¥å¿—åŠŸèƒ½ï¼Œå¹¶é€šè¿‡ forwardRef è½¬å‘ ref
const withLog = (WrappedComponent) => {
  // ç”¨ forwardRef åŒ…è£…è¿”å›çš„ç»„ä»¶ï¼Œä½¿å…¶èƒ½æ¥æ”¶ ref
  const EnhancedComponent = forwardRef((props, ref) => {
    // HOC å¢å¼ºé€»è¾‘ï¼šæ‰“å°æ¸²æŸ“æ—¥å¿—
    useEffect(() => {
      console.log(`[${WrappedComponent.name}] ç»„ä»¶æ¸²æŸ“/æ›´æ–°äº†`);
    });

    // å°† ref è½¬å‘ç»™è¢«åŒ…è£…ç»„ä»¶ï¼ŒåŒæ—¶ä¼ é€’æ‰€æœ‰ props
    return <WrappedComponent {...props} ref={ref} />;
  });

  // ä¸ºå¢å¼ºç»„ä»¶è®¾ç½® displayNameï¼ˆä¾¿äºè°ƒè¯•ï¼‰
  EnhancedComponent.displayName = `withLog(${
    WrappedComponent.name || "Component"
  })`;

  return EnhancedComponent;
};

// 2. å®šä¹‰è¢«åŒ…è£…çš„åŸºç¡€ç»„ä»¶ï¼ˆè¾“å…¥æ¡†ï¼‰
const Input = forwardRef((props, ref) => {
  return (
    <input
      ref={ref} // æ¥æ”¶è½¬å‘çš„ refï¼Œç»‘å®šåˆ° input DOM å…ƒç´ 
      {...props}
      style={{ padding: "8px", margin: "10px" }}
    />
  );
});

// 3. ç”¨ HOC å¢å¼º Input ç»„ä»¶
const LoggedInput = withLog(Input);

// 4. çˆ¶ç»„ä»¶ï¼šä½¿ç”¨å¢å¼ºç»„ä»¶ï¼Œå¹¶é€šè¿‡ ref è®¿é—® input DOM
const ParentComponent = () => {
  const inputRef = useRef(null);

  // ç‚¹å‡»æŒ‰é’®è®©è¾“å…¥æ¡†èšç„¦ï¼ˆéœ€è¦è®¿é—® input DOMï¼‰
  const handleFocus = () => {
    inputRef.current?.focus(); // æ­£ç¡®è·å– Input ç»„ä»¶çš„ DOM å…ƒç´ 
  };

  return (
    <div>
      <LoggedInput
        ref={inputRef} // ref ä¼šè¢«è½¬å‘åˆ° Input ç»„ä»¶çš„ input å…ƒç´ 
        placeholder="è¯·è¾“å…¥å†…å®¹"
      />
      <button onClick={handleFocus}>èšç„¦è¾“å…¥æ¡†</button>
    </div>
  );
};

export default ParentComponent;
```

- ref åˆ°è½¬å‘é“¾è·¯ï¼šçˆ¶ç»„ä»¶çš„`inputRef` -> `LoggedInput`-> `Input` -> æœ€ç»ˆç»‘å®šåˆ°`input DOM`
- Input ç»„ä»¶æœ¬èº«ä¹Ÿéœ€è¦é€šè¿‡`forwardRef`æ¥å—`ref`,å¦åˆ™æ— æ³•å°† ref ç»‘å®šåˆ°å†…éƒ¨ dom ä¸Š

## 41.å¦‚ä½•é€šè¿‡`React.PureComponent`ä¼˜åŒ–ç±»ç»„ä»¶æ€§èƒ½ã€‚

ä¼˜åŒ–åŸç†ï¼šè‡ªåŠ¨å®ç°`componentDidUpdate`æ¯”è¾ƒæ–°æ—§å±æ€§å’Œæ–¹æ³•ï¼Œé˜²æ­¢ä¸å¿…è¦çš„æ›´æ–°.
åœºæ™¯ï¼š

- å±•ç¤ºç±»ç»„ä»¶ï¼ˆåˆ—è¡¨ã€å¡ç‰‡ã€æŒ‰é’®ï¼‰
- props å’Œ state ä»¥åŸºç¡€ç±»ä¸ºä¸»ï¼Œæˆ–è€…å¼•ç”¨ç±»å‹ä½†ç»“æ„ç®€å•
- éœ€è¦å‡å°‘çˆ¶ç»„ä»¶é¢‘ç¹æ¸²æŸ“å¯¼è‡´çš„å†—ä½™æ›´æ–°

- é¿å…åœ¨ render é‡æ–°åˆ›å»ºå¼•ç”¨ç±»å‹

```jsx
render() {
  return <UserItem user={this.state.user[0]} onClick={function () {}} />;</UserItem>
}
```

- å¯¹äºåµŒå¥—å¯¹è±¡å¦‚`{a:{a1:{a2:112}}}`æ·±å¤„ a2 ç›‘å¬ä¸åˆ°å˜åŒ–ï¼Œéœ€è¦è‡ªå·±å®ç°è‡ªå®šä¹‰æ¯”è¾ƒ

## 42.ä»£ç åˆ†å‰²ï¼ˆCode Splitingï¼‰çš„å®ç°æ–¹å¼ä»¥åŠ Webpack é…ç½®è¦ç‚¹

1. React.lazy+Supsense æ‡’åŠ è½½
   ç»„ä»¶çº§åˆ«

```jsx
const OtherComponent = React.lazy(()=>import('./xx.jsx'))
<Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
    <OtherComponent />
</Suspense>
```

è·¯ç”±çº§åˆ«

```js
const router = CreateBrowserRouter(
  [
    {
      path:'/',
      Component:<Index/>
    },
    {
      path:'/about',
      Component:<About/>,
      lazy:async()=>{
        await sleep(2000);
        const lazyComponent= await import('lazyComponent');
        return <lazyComponent/>
      }
    },
  ]
  ]
)
```

2. webpack çš„é…ç½®è¦ç‚¹

```js
// 1.ä»£ç ä½¿ç”¨import('xxx')æ—¶ï¼Œå¯ç”¨è¯¥æ’ä»¶ï¼Œå°†åŠ¨æ€å¼•å…¥ä»£ç æ‹†åˆ†ä¸ºå¼‚æ­¥åŠ è½½çš„chunk

// 2.æ ¸å¿ƒé…ç½®ä»£ç åˆ†å‰²optimization
module.exports = {
  optimization: {
    splitChunks: {
      chunks: "all",
      //minSize:30000,//è¶…è¿‡å¤šå°‘è¿›è¡Œåˆ†å‰²
      //minSize:15000,//è¶…è¿‡å¤šå°‘è¿›è¡Œåˆ†å‰²
      maxSize: 50000, //æœ€å¤§åˆ†ç‰‡
      maxAsyncRequests: 5, //å¯¹å¼‚æ­¥æ–‡ä»¶åŒæ—¶åŠ è½½çš„æœ€å¤§æ•°é‡
      maxInitialRequests: 3, //å¯¹åˆå§‹åŠ è½½æ–‡ä»¶åŒæ—¶åŠ è½½çš„æœ€å¤§æ•°é‡
      cacheGroups: {
        default: {
          minChunks: 2,
          priority: -20,
        },
        vendors: {
          test: /[\\/]node_modules[\\/]/,
          priority: -10,
          reuseExistingChunk: true,
        },
      },
    },
  },
};
```

## 43.å¦‚ä½•é€šè¿‡`useMemo`å’Œ`useCallback`è¿›è¡Œæ€§èƒ½ä¼˜åŒ–

useCallback å’Œ useMemo éƒ½æ˜¯ç”¨äºæ€§èƒ½ä¼˜åŒ–çš„ Hookï¼Œå®ƒä»¬é€šè¿‡ç¼“å­˜è®¡ç®—ç»“æœæ¥é¿å…ä¸å¿…è¦çš„é‡å¤è®¡ç®—æˆ–æ¸²æŸ“
| ç‰¹æ€§ | useMemo | useCallback |
| ------------------------ | ------------------------ | --- |
| è¿”å›å€¼ | ç¼“å­˜è®¡ç®—ç»“æœï¼ˆå€¼/å¯¹è±¡/æ•°ç»„) | ç¼“å­˜çš„å‡½æ•°æœ¬èº« |
|ä¼˜åŒ–ç›®æ ‡| é¿å…é‡å¤è®¡ç®—ã€å¼•ç”¨å˜åŒ– | é¿å…å‡½æ•°é‡å»ºã€å¼•ç”¨å˜åŒ–|
|ä½¿ç”¨åœºæ™¯| è®¡ç®—æˆæœ¬é«˜çš„å€¼ï¼ŒuseEffect ä¾èµ–ï¼Œä¼ é€’ç»™å­ç»„ä»¶çš„ propsï¼ˆé˜»æ­¢å­ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼‰ | props ä¼ é€’ç»™å­ç»„ä»¶ï¼Œè¢« useEffect ä¾èµ–ï¼Œéœ€è¦ç¨³å®šå‡½æ•°å¼•ç”¨(debounce/throttle ç­‰)|

## 44.React åº”ç”¨çš„é¦–å±åŠ è½½ä¼˜åŒ–çš„ç­–ç•¥ï¼ˆå¦‚ SSRã€é¢„æ¸²æŸ“ï¼‰

### ä¸€. å…³é”®å‡å°‘åŒ…çš„ä½“ç§¯

1. ä»£ç åˆ†å‰²
   æŒ‰â€œé¦–å±å¿…éœ€â€å’Œâ€œéå¿…éœ€â€æ‹†åˆ†ä»£ç ï¼Œä»…åŠ è½½é¦–å±æ‰€éœ€éƒ¨åˆ†ã€‚

- è·¯ç”±çº§åˆ«åˆ†å‰²
- ç»„ä»¶çº§åˆ«åˆ†å‰²

1. å‡å°‘ä¸‰æ–¹åº“æåŠ

- æŒ‰éœ€å¼•å…¥ï¼šé¿å…å…¨é‡å¯¼å…¥ç¬¬ä¸‰æ–¹åº“ï¼ˆLodashã€Antdï¼‰
- æ›¿æ¢è½»é‡åº“ï¼šç”¨ä½“ç§¯æ›´å°çš„åº“æ›¿ä»£é‡é‡åº“ï¼ˆå¦‚ date-fns æ›¿ä»£ moment.jsï¼‰
- æŠ½ç¦»ç¬¬ä¸‰æ–¹åº“ï¼šé€šè¿‡ webpack çš„ splitChunks å°† node_modules çš„ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…ï¼ˆåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ã€å› ä¸ºç¬¬ä¸‰æ–¹åº“æ›´æ–°é¢‘ç‡ä½ï¼‰

3. Tree Shaking ç§»é™¤æ­»ä»£ç 

- é…ç½® Webpack
- é¿å…ä½¿ç”¨ cjs

4. èµ„æºå‹ç¼©ä¸ä¼˜åŒ–

- js/css å‹ç¼© `terser-webpack-plugin` `css-minimizer-webpack-plugin`
- å›¾ç‰‡ä¼˜åŒ–
- - ä½¿ç”¨ç°ä»£æ ¹å¼(Webp/AVIF)
- - é¦–å±ä¼˜å…ˆä½¿ç”¨`srcset`é€‚é…ä¸åŒè®¾å¤‡åˆ†è¾¨ç‡ï¼Œéé¦–å±å›¾ç‰‡ç”¨ loading=â€˜lazyâ€™
- - å°å›¾æ ‡ç”¨ svg æˆ–è€…å­—ä½“å›¾æ ‡

### äºŒ. ä¼˜åŒ–èµ„æºåŠ è½½é¡ºåºä¸ä¼˜å…ˆçº§

ç¡®ä¿é¦–å±å…³é”®èµ„æºï¼ˆHTMLã€CSSã€JSï¼‰ä¼˜å…ˆåŠ è½½ï¼Œéå…³é”®èµ„æºå»¶è¿ŸåŠ è½½

- 1. å†…è”å…³é”® CSS
- - éé¦–å± CSSï¼ˆå¦‚æŠ˜å é¢æ¿ã€å¼¹çª—æ ·å¼ï¼‰å¯å¼‚æ­¥åŠ è½½ï¼š`<link rel='preload' href='non-critical.css' as='style' onload="this.rel='stylesheet'"/>`
- 2. é¢„åŠ è½½ï¼ˆpreloadï¼‰ä¸é¢„è¿æ¥ï¼ˆpreconnectï¼‰
- - preload `<link rel='preload' href='main.chunk.js' as='script'> </link>`
- - preconnect æå‰ä¸ç¬¬ä¸‰æ–¹åŸŸåï¼ˆå¦‚ cdnã€Api æœåŠ¡å™¨ï¼‰å»ºç«‹è¿æ¥ï¼ˆå‡å°‘ DNS è§£æ/æ¡æ‰‹å»ºç«‹è¿æ¥æ—¶é—´ï¼‰ `<link rel='preconnect' href='//cdn.example.com' crossorigin></link>`
- 3. å»¶è¿ŸåŠ è½½éå…³é”® JS
- - `async`æˆ–è€…`defer`åŠ è½½éé¦–å± jsï¼ˆå¦‚ç»Ÿè®¡è„šæœ¬ã€å¹¿å‘Š SDKï¼‰
- - async ä¸‹è½½åç«‹å³æ‰§è¡Œï¼ˆé¡ºåºä¸ç¡®å®šï¼‰
- - defer ä¸‹è½½åç­‰ hmtl è§£æå®Œåœ¨æ‰§è¡Œï¼ˆæŒ‰é¡ºåºï¼‰
- - å¯¹å®Œå…¨éå¿…éœ€çš„ JSï¼ˆå¦‚èŠå¤©æ’ä»¶ï¼‰ï¼Œå¯åœ¨é¦–å±åŠ è½½å®Œæˆåé€šè¿‡åŠ¨æ€`import()`åŠ è½½ã€‚

### ä¸‰. ä¼˜åŒ–æ¸²æŸ“ä¸äº¤äº’æ•ˆç‡

å³æ—¶èµ„æºåŠ è½½å®Œæˆï¼Œè‹¥æ¸²æŸ“è¿‡ç¨‹è€—æ—¶è¿‡é•¿ï¼Œé¦–å±ä½“éªŒä»ä¼šå—å½±å“ã€‚

1. å‡å°‘é¦–å±ä¸å¿…è¦çš„æ¸²æŸ“

- é¿å…é¦–å±å¹•åŠ è½½æ—¶æ¸²æŸ“ä¸å¯è§å†…å®¹ï¼Œå¯ä»¥é€šè¿‡æ¡ä»¶æ¸²æŸ“å»¶è¿ŸåŠ è½½ã€‚
- ç”¨` React.memo``useMemo``useCallback `å‡å°‘å†—ä½™æ¸²æŸ“

2. æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰æˆ–é™æ€ç«™ç‚¹ç”Ÿæˆï¼ˆSSGï¼‰

- SSR(å¦‚ next.js çš„`getServerSideProps`):æœåŠ¡ç«¯æå‰æ¸²æŸ“ html å¹¶è¿”å›ï¼Œæ— éœ€ç­‰å¾… js åŠ è½½å®Œæˆåå†æ¸²æŸ“
- SSGï¼ˆå¦‚ next.js çš„`getStaticProps`):æ„å»ºæ—¶æ¸²æŸ“ç”Ÿæˆé™æ€ htmlï¼Œé€‚ç”¨äºå†…å®¹å˜åŒ–ä¸é¢‘ç¹çš„åœºæ™¯ï¼ˆå®˜ç½‘ã€æ–‡æ¡£ï¼‰
- ä¼˜åŠ¿:é¦–å± HTML ç«‹åˆ»æ˜¾ç¤ºï¼Œå‡å°‘ç™½å±ï¼Œåˆ©äº SEO

3. éª¨æ¶å±

- `react-loading-skeleton`,ç»“åˆ`suspense`å±•ç¤º

### å››.åˆ©ç”¨ç¼“å­˜å’Œç½‘ç»œä¼˜åŒ–

é€šè¿‡ç¼“å­˜å‡å°‘é‡å¤è¯·æ±‚ã€åˆ©ç”¨ç½‘ç»œç‰¹æ€§åŠ é€Ÿèµ„æºä¼ è¾“

1. æµè§ˆå™¨ç¼“å­˜ç­–ç•¥

- é™æ€èµ„æº(JS/CSS/å›¾ç‰‡)è®¾ç½®é•¿æœŸç¼“å­˜(Cache-Controlï¼šmax-age=31536000),é…åˆå†…å®¹å“ˆå¸Œï¼ˆå¦‚ main[contenthash].jsï¼‰,å†…å®¹ä¸å˜åˆ™å“ˆå¸Œä¸å˜ã€‚
- API æ•°æ®ç¼“å­˜ï¼šç”¨`SWR`æˆ–`React Query`ç¼“å­˜æ¥å£æ•°æ®ï¼Œé¿å…é‡å¤è¯·æ±‚ã€‚

2. ä½¿ç”¨ cdn åˆ†å‘é™æ€èµ„æº
3. å¯ç”¨ http/2 æˆ–è€… http/3 (éœ€è¦æœåŠ¡å™¨æ”¯æŒ)

### äº”ã€æ€§èƒ½æ£€æµ‹ä¸æŒç»­ä¼˜åŒ–

- å·¥å…·åˆ†æ ï¼ˆLightHouseï¼‰
- æ ¸å¿ƒæŒ‡æ ‡ï¼šLCPã€FCPã€TTI
- æ¸è¿›å¼ä¼˜åŒ–ï¼šä¼˜å…ˆä¼˜åŒ–å½±å“æ ¸å¿ƒæŒ‡æ ‡çš„é—®é¢˜ï¼ˆå¦‚ LCP å…ƒç´ åŠ è½½è¿‡æ…¢ï¼‰ï¼Œå†å¤„ç†æ¬¡è¦é—®é¢˜ã€‚

### æ€»ç»“

æ ¸å¿ƒæ€è·¯æ˜¯â€œå‡å°‘ä½“ç§¯ã€ä¼˜åŒ–åŠ è½½ã€åŠ é€Ÿæ¸²æŸ“ã€åˆ©ç”¨ç¼“å­˜â€

## 45.é•¿åˆ—è¡¨æ¸²æŸ“çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

æ ¸å¿ƒåŸåˆ™ï¼šæœ€å°åŒ–æ¸²æŸ“ dom+é¿å…ä¸å¿…è¦çš„æ¸²æŸ“+åˆ†æ‘Šæ•°æ®å¤„ç†æˆæœ¬

### è™šæ‹Ÿåˆ—è¡¨

åŸåˆ™ï¼šåªæ¸²æŸ“å¯è§†éƒ¨åˆ†

```jsx
import { FixedSizeList as List } from "react-window";
import AutoSizer from "react-virtualized-auto-sizer"; // è‡ªé€‚åº”å®¹å™¨å°ºå¯¸
const Row = ({ index, style }) => {
  const item = data[index]; // data æ˜¯å®Œæ•´æ•°æ®æ•°ç»„
  return (
    <div style={style} className="list-item">
      {item.text}
    </div>
  );
};

// é•¿åˆ—è¡¨ç»„ä»¶
const LongList = ({ data }) => {
  return;
  <div>
    <AutoSizer>
      {({ height, width }) => (
        <List
          height={height} // åˆ—è¡¨æ€»é«˜åº¦
          width={width} // åˆ—è¡¨æ€»å®½åº¦
          itemCount={data.length} // æ€»æ•°æ®é‡
          itemSize={50} // æ¯é¡¹é«˜åº¦ï¼ˆå›ºå®šï¼‰
        >
          {Row}
        </List>
      )}
    </AutoSizer>
  </div>;
};
```

### ç¼“å­˜ä¸ä¼˜åŒ–åˆ—è¡¨é¡¹

å³ä½¿åªæ¸²æŸ“éƒ¨åˆ†é¡¹ï¼Œè‹¥ ğŸ¤” é¢‘ç¹é‡æ¸²æŸ“ï¼ˆå¦‚çˆ¶ç»„ä»¶æ›´æ–°ï¼‰ï¼Œä»å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

1. React.memo åŒ…è£¹åˆ—è¡¨é¡¹

```jsx
// åˆ—è¡¨é¡¹ç»„ä»¶ï¼ˆç”¨ React.memo ç¼“å­˜ï¼‰
const ListItem = React.memo(({ item, onItemClick }) => {
  console.log(`æ¸²æŸ“é¡¹ï¼š${item.id}`);
  return <div onClick={() => onItemClick(item.id)}>{item.name}</div>;
});
```

2. ç¼“å­˜å¼•ç”¨ç±»å‹`props`

```jsx
const ParentList = ({ data }) => {
  // ç¼“å­˜ç‚¹å‡»äº‹ä»¶ï¼ˆå¼•ç”¨ä¸å˜ï¼‰
  const handleItemClick = useCallback((id) => {
    console.log("ç‚¹å‡»é¡¹ï¼š", id);
  }, []); // æ— ä¾èµ–ï¼Œæ°¸ä¹…ç¼“å­˜

  return (
    <div>
      {data.map((item) => (
        <ListItem
          key={item.id}
          item={item}
          onItemClick={handleItemClick} // å¼•ç”¨ç¨³å®š
        />
      ))}
    </div>
  );
};
```

3. é¿å…åˆ—è¡¨é¡¹å†…å®šä¹‰å‡½æ•°/å¯¹è±¡

```jsx
// é”™è¯¯ï¼šæ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°å‡½æ•°
<ListItem onItemClick={() => handleClick(item.id)} />
```

### æ•°æ®åˆ†é…ä¸æ‡’åŠ è½½

1. åˆ†é¡µåŠ è½½

```jsx
const newData = await fetch(`/api/data?page=${page}&size=100`);
```

2.æ— é™æ»šåŠ¨

```jsx
const InfiniteList = () => {
  // ...ï¼ˆdataã€pageã€loading çŠ¶æ€åŒä¸Šï¼‰
  const loaderRef = useRef(null);

  // ç›‘å¬æ»šåŠ¨åˆ°åº•éƒ¨
  useEffect(() => {
    const observer = new IntersectionObserver((entries) => {
      if (entries[0].isIntersecting && !loading) {
        loadMore(); // è¿›å…¥å¯è§†åŒºåŸŸï¼ŒåŠ è½½æ›´å¤š
      }
    });
    if (loaderRef.current) observer.observe(loaderRef.current);
    return () => observer.disconnect();
  }, [loading]);

  return (
    <div>
      {data.map((item) => (
        <ListItem key={item.id} item={item} />
      ))}
      <div ref={loaderRef}>åŠ è½½ä¸­...</div> {/* è§¦å‘ç‚¹ */}
    </div>
  );
};
```

## 46.å¦‚ä½•é€šè¿‡ Chrome DevTools åˆ†æ react åº”ç”¨çš„æ€§èƒ½ç“¶é¢ˆ

## 47.Webpack ä¸­ Tree Shaking å¯¹ React ç»„ä»¶çš„ä¼˜åŒ–æ•ˆæœ

## 48.å¦‚ä½•é€šè¿‡`React Profiler`å®šä½ç»„ä»¶æ¸²æŸ“é—®é¢˜

## 49.è§£é‡Š React çš„"æ‰¹é‡æ›´æ–°"(Batching)æœºåˆ¶ä»¥åŠæ‰‹åŠ¨è§¦å‘æ–¹æ³•

**æ‰¹é‡æ›´æ–°ï¼šå°†å¤šä¸ªçŠ¶æ€æ›´æ–°æ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡é‡æ–°æ¸²æŸ“**ï¼Œé¿å…é¢‘ç¹è§¦å‘ç»„ä»¶é‡æ¸²æŸ“å’Œ DOM æ“ä½œï¼Œæå‡åº”ç”¨æ€§èƒ½ã€‚

### ä¸€ã€‚æ‰¹é‡æ›´æ–°çš„æ ¸å¿ƒé€»è¾‘å’Œä½œç”¨

åœ¨ react ä¸­ï¼Œå½“ç»„ä»¶å­˜åœ¨å¤šæ¬¡çŠ¶æ€æ›´æ–°ï¼ˆå¦‚è¿ç»­è°ƒç”¨ setStateï¼‰æ—¶ï¼ŒReact ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯å°†è¿™äº›æ›´æ–°â€œæ‰¹é‡æ”¶é›†â€ï¼Œå¾…åˆé€‚æ—¶æœºï¼ˆé€šå¸¸æ˜¯å½“å‰äº‹ä»¶å¾ªç¯çš„æœ«å°¾ï¼‰åˆå¹¶ä¸€æ¬¡æ›´æ–°ï¼Œåªè§¦å‘ä¸€æ¬¡ç»„ä»¶é‡æ¸²æŸ“ã€‚

### äºŒã€æ‰¹é‡æ›´æ–°çš„è§¦å‘åœºæ™¯

1. React18 ä¹‹å‰çš„æ‰¹é‡æ›´æ–°è§„åˆ™

- è‡ªåŠ¨æ‰¹é‡æ›´æ–°ç”Ÿæ•ˆçš„åœºæ™¯ï¼š
  äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆ`onClick`ã€`onChange`ã€`useEffect`ï¼‰
- è‡ªåŠ¨æ‰¹é‡æ›´æ–°å¤±æ•ˆçš„åœºæ™¯ï¼š
  é React äº‹ä»¶ä¸Šä¸‹æ–‡(`setTimeout`ã€`promise`ã€`fetchå›è°ƒ`)

2. React18 ä¸­çš„æ‰¹é‡æ›´æ–°è§„åˆ™ï¼ˆé‡è¦å˜åŒ–ï¼‰
   React 18 å¼•å…¥äº† **â€œè‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆAutomatic Batchingï¼‰â€**ï¼Œæ‰©å±•äº†æ‰¹é‡æ›´æ–°çš„èŒƒå›´ï¼šæ— è®ºæ›´æ–°å‘ç”Ÿåœ¨ React äº‹ä»¶ã€åŸç”Ÿäº‹ä»¶ã€setTimeoutã€Promise è¿˜æ˜¯ fetch å›è°ƒä¸­ï¼Œé»˜è®¤éƒ½ä¼šè¿›è¡Œæ‰¹é‡æ›´æ–°ï¼Œé™¤éæ‰‹åŠ¨é€€å‡ºã€‚

```jsx
const Counter = () => {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    // setTimeout å›è°ƒä¸­ï¼ŒReact 18 ä¼šè‡ªåŠ¨æ‰¹é‡æ›´æ–°
    setTimeout(() => {
      setCount((c) => c + 1);
      setCount((c) => c + 1);
      // åªä¼šè§¦å‘ 1 æ¬¡é‡æ¸²æŸ“ï¼ˆæ‰¹é‡æ›´æ–°ç”Ÿæ•ˆï¼‰
    }, 0);
  };

  console.log("ç»„ä»¶æ¸²æŸ“äº†");

  return <button onClick={handleClick}>æ›´æ–°</button>;
};
```

### ä¸‰ã€æ‰‹åŠ¨è§¦å‘/é€€å‡ºæ‰¹å¤„ç†æ›´æ–°çš„æ–¹æ³•

1. æ‰‹åŠ¨è§¦å‘æ‰¹é‡æ›´æ–°ï¼ˆReact 17 åŠä¹‹å‰ï¼‰
   åœ¨é React äº‹ä»¶ä¸Šä¸‹æ–‡`setTimeout Promise`,ä½¿ç”¨`unstable_batchedUpdates()`æ–¹æ³•åŒ…è£¹è¦æ‰¹é‡æ›´æ–°çš„çŠ¶æ€æ›´æ–°ã€‚

```jsx
const handleClick = () => {
  setTimeout(() => {
    // æ‰‹åŠ¨è§¦å‘æ‰¹é‡æ›´æ–°
    unstable_batchedUpdates(() => {
      setCount((c) => c + 1);
      setCount((c) => c + 1);
    });
    // React 17 åŠä¹‹å‰ï¼šåªä¼šè§¦å‘ 1 æ¬¡é‡æ¸²æŸ“
  }, 0);
};
```

2. æ‰‹åŠ¨é€€å‡ºæ‰¹é‡æ›´æ–°ï¼ˆReact 18+ï¼‰
   React 18 ä¸­é»˜è®¤æ‰¹é‡æ›´æ–°è¦†ç›–èŒƒå›´æå¹¿ï¼Œè‹¥éœ€ å¼ºåˆ¶æŸä¸€æ¬¡æ›´æ–°ç«‹å³ç”Ÿæ•ˆï¼ˆä¸ç­‰å¾…æ‰¹é‡å¤„ç†ï¼‰ï¼Œå¯ä½¿ç”¨ `flushSync`ï¼ˆä» `react-dom` å¯¼å…¥ï¼‰ã€‚

```jsx
const handleClick = () => {
  // ç¬¬ 1 æ¬¡æ›´æ–°ï¼šä½¿ç”¨ flushSync å¼ºåˆ¶ç«‹å³ç”Ÿæ•ˆ
  flushSync(() => {
    setCount((c) => c + 1);
  });
  // æ­¤æ—¶ä¼šè§¦å‘ 1 æ¬¡é‡æ¸²æŸ“ï¼ˆcount å˜ä¸º 1ï¼‰

  // ç¬¬ 2 æ¬¡æ›´æ–°ï¼šæ­£å¸¸æ‰¹é‡å¤„ç†
  setCount((c) => c + 1);
  // è§¦å‘ç¬¬ 2 æ¬¡é‡æ¸²æŸ“ï¼ˆcount å˜ä¸º 2ï¼‰
};
```

é€‚ç”¨åœºæ™¯ï¼šæå°‘æ•°éœ€è¦â€œæ›´æ–°åç«‹å³åŒæ­¥è·å– DOM çŠ¶æ€â€çš„åœºæ™¯

## 50.å¦‚ä½•é¿å…åœ¨`render`ä¸­ç»‘å®šäº‹ä»¶å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Ÿ

æ ¸å¿ƒï¼š**ä¿æŒäº‹ä»¶å¤„ç†å‡½æ•°çš„å¼•ç”¨ç¨³å®š**

1. å‡½æ•°å¼ç»„ä»¶ã€‚ç¨³å®šå‡½æ•°çš„åº”ç”¨ï¼Œé¿å…é‡å»ºå‡½æ•°

```jsx
const [count, setCount] = useState(0);
const handleClick = useCallback(() => {
  setCount(count + 1); // ä¾èµ– countï¼Œéœ€åŠ å…¥ä¾èµ–æ•°ç»„
}, [count]); // count å˜åŒ–æ—¶ï¼Œå‡½æ•°æ‰é‡æ–°åˆ›å»º
```

2. ç±»ç»„ä»¶

```jsx
// 1. constructor
class ItemList extends React.Component {
  constructor(props) {
    super(props);
    // åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®šï¼Œå¼•ç”¨æ°¸ä¹…ä¸å˜
    this.handleItemClick = this.handleItemClick.bind(this);
  }

  // 2. ç®­å¤´å‡½æ•°
  handleItemClick = () => {
    this.setState((state) => ({ count: state.count + 1 }));
  };
}
```

3. é€šè¿‡`data-*`å±æ€§ä¼ é€’å‚æ•°

```jsx
const Item = ({ item, onItemClick }) => {
  return (
    <li
      onClick={onItemClick}
      data-id={item.id} // å­˜å‚¨å‚æ•°
    >
      {item.name}
    </li>
  );
};

// äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è·å–å‚æ•°
const handleItemClick = useCallback((e) => {
  const id = e.target.dataset.id; // ä»äº‹ä»¶å¯¹è±¡ä¸­å–å‚æ•°
  console.log("ç‚¹å‡»äº†é¡¹ï¼š", id);
}, []);
```

## 51. æœåŠ¡ç«¯æ¸²æŸ“ä¸å®¢æˆ·ç«¯æ¸²æŸ“çš„å¯¹æ¯”ä»¥åŠå®ç°éš¾ç‚¹

| å¯¹æ¯”       | CSR                              | SSR                                                                          |
| ---------- | -------------------------------- | ---------------------------------------------------------------------------- |
| é¦–å±       | æ…¢                               | å¿«                                                                           |
| SEO å‹å¥½æ€§ | å·®                               | å¥½                                                                           |
| äº¤äº’æ€§     | ç­‰å¾… js åŠ è½½å®Œæˆæ‰å¯äº¤äº’ï¼Œä½†è¿è´¯ | éœ€ç­‰å¾…æ¿€æ´»æ‰å…·å¤‡äº¤äº’æ€§ï¼ˆå¯èƒ½ç‚¹å‡»å»¶è¿Ÿå“åº”ï¼‰                                   |
| æœåŠ¡ç«¯å‹åŠ› | å°ï¼Œè¿”å›é™æ€èµ„æº                 | å¤§ï¼ŒåŠ¨æ€ç”Ÿæˆ HTMLã€å¤„ç†æ•°æ®è¯·æ±‚ã€æ‰§è¡Œ JSï¼ŒCPU/å†…å­˜æ¶ˆè€—é«˜ï¼Œéœ€è¦ä¼˜åŒ–ç¼“å­˜å’Œè´Ÿè½½ |
| å¼€å‘å¤æ‚åº¦ | ç®€å•                             | éš¾                                                                           |
| é€‚ç”¨åœºæ™¯   | åå°ã€ç¤¾äº¤åº”ç”¨                   | é¦–å±æ•æ„Ÿï¼ˆç”µå•†é¦–é¡µã€åšå®¢ã€æ–°é—»ï¼‰                                             |

## éš¾ç‚¹

SSR çš„å¤æ‚åº¦ä¸»è¦æºäº`å‰åç«¯ååŒæ¸²æŸ“`çš„ä¸€è‡´æ€§è¦æ±‚ï¼Œå…·ä½“åŒ…æ‹¬

1. å‰åç«¯ä»£ç å…±äº«ä¸ç¯å¢ƒå…¼å®¹ã€‚SSR ç»„ä»¶æ˜¯åœ¨`nodejs`ï¼Œç¼ºä¹`window document`çš„ api
2. æ•°æ®é¢„å–ä¸çŠ¶æ€åŒæ­¥ã€‚S ç«¯å¿…é¡»é¢„å…ˆè·å–ç»„ä»¶æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚ä¸”å®¢æˆ·ç«¯â€˜æ¿€æ´»â€™éœ€è¦åŒæ­¥å¤ç”¨æ•°æ®ã€‚
3. â€œæ¿€æ´»â€ä¸€è‡´æ€§ã€‚å®¢æˆ·ç«¯æ¿€æ´»æ˜¯ï¼ŒJS ç”Ÿæˆçš„è™šæ‹Ÿ DOM å¿…é¡»ä¸æœåŠ¡ç«¯æ¸²æŸ“çš„ HTML å®Œå…¨ä¸€è‡´ã€‚ï¼ˆæ ‡ç­¾ã€å±æ€§ã€å±‚çº§ï¼‰
4. æ€§èƒ½ä¸ç¼“å­˜ä¼˜åŒ–ã€‚åŠ¨æ€æ¸²æŸ“æˆæœ¬é«˜ï¼Œå¹¶å‘å®¹æ˜“è¿‡è½½ã€‚

### å®é™…å¼€å‘ä¸­ï¼Œå¸¸é‡‡ç”¨ â€œæ··åˆæ¸²æŸ“â€ ç­–ç•¥ï¼ˆå¦‚ SSR+CSRã€SSG+ISRï¼‰ï¼Œå¹³è¡¡æ€§èƒ½ä¸å¼€å‘æˆæœ¬ã€‚

## 52.å¦‚ä½•é€šè¿‡ Webpack é…ç½®å®ç°æŒ‰éœ€åŠ è½½ç¬¬ä¸‰æ–¹åº“

- å¯¹äº es æ¨¡å—åº“ï¼šå¯ç”¨ tree shaking
- å¯¹ ui ç»„ä»¶ï¼šç”¨`babel-plugin-import`ç­‰æ’ä»¶è‡ªåŠ¨è½¬æ¢ä¸ºæŒ‰éœ€å¼•å…¥

```js
//.babelrc
{
  plugins: [
    [
      "import", // å¯ç”¨ babel-plugin-import
      {
        libraryName: "antd",
        libraryDirectory: "es", // ä½¿ç”¨antdçš„esç‰ˆæœ¬
        style: "css", // trueè¡¨ç¤ºå¯¼å…¥less
      },
    ],
  ];
}
```

- å¯¹é es æ¨¡å—åº“ï¼šæ‰‹åŠ¨å¯¼å…¥å…·ä½“æ–‡ä»¶è·¯å¾„
- éé¦–å±åº“ï¼šå¦‚`chartåº“`ç”¨åŠ¨æ€`import`æ‹†åˆ† chunk

## 53.è§£é‡Š React åº”ç”¨çš„å›½é™…åŒ–ï¼ˆi18nï¼‰æ–¹æ¡ˆï¼Œä»¥åŠå®ç°æ€è·¯

- ä½¿ç”¨`react-intl`
- å…¨å±€ context ä¼ å…¥å›½é™…åŒ–å˜é‡`locale` `messages[locale]`
- ç»„ä»¶ä½¿ç”¨ï¼Œæ‰€æœ‰æ–‡æœ¬èµ„æºä½¿ç”¨å˜é‡æ›¿ä»£ `const intl = useIntl(); intl.formatMessage({id:'username',defualtMessage:'ç”¨æˆ·å'})`
- æ·»åŠ å¤šå›½è¯­è¨€ json `const message = { 'zh-CN' }`
- åœ¨éç»„ä»¶ä¸­ä½¿ç”¨`createIntl`

## 54.å¦‚ä½•é€šè¿‡ Error Boundary æ•è·å¹¶å¤„ç†å¼‚å¸¸

åœ¨ React `Error Boundary`æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç»„ä»¶ï¼Œç”¨äºæ•è·ç»„ä»¶æ ‘ä¸­æŠ›å‡ºçš„ js é”™è¯¯ï¼Œå¹¶æä¾›å¤‡ç”¨ UI æ›¿ä»£å¥”æºƒç»„ä»¶ã€‚

- ä½œç”¨èŒƒå›´ï¼šå­ç»„ä»¶ï¼ˆæ¸²æŸ“é”™è¯¯ã€ç”Ÿå‘½å‘¨æœŸã€å­ç»„ä»¶æ„é€ ï¼‰
- æ— æ³•æ•è·ï¼š
- - è‡ªèº«ç»„ä»¶é”™è¯¯
- - äº‹ä»¶å¤„ç†å™¨ï¼ˆonClickï¼‰
- - å¼‚æ­¥ä»£ç é”™è¯¯
- - ssr é”™è¯¯

- å®ç°ï¼ˆå®ç° 2 ä¸ªç”Ÿå‘½å‘¨æœŸï¼‰

```jsx
// å¿…é¡»æ˜¯ç±»ç»„ä»¶
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    // åˆå§‹åŒ–çŠ¶æ€ï¼šé»˜è®¤æ— é”™è¯¯
    this.state = { hasError: false, error: null, errorInfo: null };
  }

  // æ•è·å­ç»„ä»¶é”™è¯¯åæ›´æ–°çŠ¶æ€
  static getDerivedStateFromError(error) {
    return { hasError: true }; // è§¦å‘é”™è¯¯ UI æ¸²æŸ“
  }

  // æ•è·é”™è¯¯åæ‰§è¡Œå‰¯ä½œç”¨ï¼ˆå¦‚æ—¥å¿—è®°å½•ï¼‰
  componentDidCatch(error, errorInfo) {
    // è®°å½•é”™è¯¯åˆ°æ—¥å¿—æœåŠ¡ï¼ˆç¤ºä¾‹ï¼‰
    console.error("Error Boundary æ•è·åˆ°é”™è¯¯ï¼š", error, errorInfo);
    // å¯å°†é”™è¯¯å‘é€åˆ°åç«¯ç›‘æ§ï¼ˆå¦‚ Sentryã€é˜¿é‡Œäº‘ç›‘æ§ç­‰ï¼‰
    // logErrorToService(error, errorInfo);
    // ä¿å­˜é”™è¯¯ä¿¡æ¯åˆ°çŠ¶æ€ï¼ˆå¯é€‰ï¼Œç”¨äºå±•ç¤ºè¯¦ç»†é”™è¯¯ï¼‰
    this.setState({ error, errorInfo });
  }

  // é‡ç½®é”™è¯¯çŠ¶æ€ï¼ˆå¯é€‰ï¼šæä¾›é‡è¯•åŠŸèƒ½ï¼‰
  resetError = () => {
    this.setState({ hasError: false, error: null, errorInfo: null });
  };

  render() {
    // è‹¥æœ‰é”™è¯¯ï¼Œæ¸²æŸ“å¤‡ç”¨ UI
    if (this.state.hasError) {
      // ä¼˜å…ˆä½¿ç”¨ props ä¼ å…¥çš„é”™è¯¯ UIï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤ UI
      return (
        this.props.fallback || (
          <div className="error-boundary">
            <h2>å‡ºé”™äº† ğŸ˜¢</h2>
            <p>{this.state.error?.message}</p>
            <button onClick={this.resetError}>é‡è¯•</button>
          </div>
        )
      );
    }

    // æ— é”™è¯¯æ—¶ï¼Œæ¸²æŸ“å­ç»„ä»¶
    return this.props.children;
  }
}

export default ErrorBoundary;
```

- åœºæ™¯
- - é«˜é£é™©æ¨¡å—ï¼ˆç¬¬ä¸‰æ–¹ç»„ä»¶ã€å¤æ‚è¡¨å•ï¼‰
- - å…¨å±€åŒ…è£¹
- - è‡ªå®šä¹‰ fallback

## 55.å¤§å‹é¡¹ç›®å¦‚ä½•ç»„ç»‡ react ç»„ä»¶ç›®å½•ç»“æ„

- ç”¨ features/ æ”¶çº³ä¸šåŠ¡æ¨¡å—ï¼Œå®ç° â€œé«˜å†…èšä½è€¦åˆâ€ï¼›
- ç”¨ shared/ ç®¡ç†è·¨æ¨¡å—èµ„æºï¼Œé¿å…é‡å¤å¼€å‘ï¼›
- ç”¨ app/ æ§åˆ¶å…¨å±€é…ç½®ï¼Œç»Ÿä¸€åº”ç”¨å…¥å£ã€‚

```
src/
â”œâ”€â”€ app/                     # åº”ç”¨æ ¸å¿ƒé…ç½®ï¼ˆå…¨å±€çŠ¶æ€ã€è·¯ç”±ã€å…¥å£ç­‰ï¼‰
â”‚   â”œâ”€â”€ store/               # å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ Redux Storeã€Contextï¼‰
â”‚   â”‚   â”œâ”€â”€ index.js         # çŠ¶æ€å…¥å£ï¼ˆç»„åˆ reducerã€ä¸­é—´ä»¶ï¼‰
â”‚   â”‚   â””â”€â”€ rootReducer.js   # æ ¹ reducer
â”‚   â”œâ”€â”€ routes/              # å…¨å±€è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.js         # è·¯ç”±è¡¨ï¼ˆç»“åˆ React Routerï¼‰
â”‚   â”‚   â””â”€â”€ PrivateRoute.js  # è·¯ç”±å®ˆå«ï¼ˆå¦‚ç™»å½•éªŒè¯ï¼‰
â”‚   â””â”€â”€ App.js               # åº”ç”¨æ ¹ç»„ä»¶ï¼ˆåŒ…è£¹è·¯ç”±ã€å…¨å±€ç»„ä»¶ï¼‰
â”‚
â”œâ”€â”€ features/                # ä¸šåŠ¡åŠŸèƒ½æ¨¡å—ï¼ˆæ ¸å¿ƒç›®å½•ï¼ŒæŒ‰é¢†åŸŸåˆ’åˆ†ï¼‰
â”‚   â”œâ”€â”€ user/                # ç”¨æˆ·æ¨¡å—ï¼ˆç¤ºä¾‹ï¼šç”¨æˆ·ç®¡ç†ã€ç™»å½•æ³¨å†Œï¼‰
â”‚   â”‚   â”œâ”€â”€ components/      # æ¨¡å—ç§æœ‰ç»„ä»¶ï¼ˆä»…ç”¨æˆ·æ¨¡å—ä½¿ç”¨ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ UserForm/    # ç»„ä»¶æ–‡ä»¶å¤¹ï¼ˆæ¯ä¸ªç»„ä»¶å•ç‹¬æ–‡ä»¶å¤¹ï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserForm.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserForm.module.css  # CSS Moduleï¼ˆæˆ– styled-componentsï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.js             # å¯¼å‡ºç»„ä»¶ï¼ˆç®€åŒ–å¯¼å…¥ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ UserList/
â”‚   â”‚   â”œâ”€â”€ pages/           # æ¨¡å—é¡µé¢ï¼ˆè·¯ç”±å¯¹åº”çš„é¡µé¢ç»„ä»¶ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ UserDetailPage.jsx
â”‚   â”‚   â”‚   â””â”€â”€ UserListPage.jsx
â”‚   â”‚   â”œâ”€â”€ api/             # æ¨¡å— API è¯·æ±‚ï¼ˆä»…ç”¨æˆ·ç›¸å…³æ¥å£ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ userApi.js   # å°è£… fetch/axios è¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ hooks/           # æ¨¡å—ç§æœ‰ hooksï¼ˆå¦‚ useUserInfoï¼‰
â”‚   â”‚   â”œâ”€â”€ store/           # æ¨¡å—çŠ¶æ€ï¼ˆå¦‚ Redux slice æˆ– Contextï¼‰
â”‚   â”‚   â”œâ”€â”€ utils/           # æ¨¡å—å·¥å…·å‡½æ•°ï¼ˆä»…ç”¨æˆ·æ¨¡å—ä½¿ç”¨ï¼‰
â”‚   â”‚   â””â”€â”€ index.js         # æ¨¡å—å…¥å£ï¼ˆå¯¼å‡ºå…¬å…± APIã€ç»„ä»¶ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ order/               # è®¢å•æ¨¡å—ï¼ˆåŒ user æ¨¡å—ç»“æ„ï¼‰
â”‚   â””â”€â”€ payment/             # æ”¯ä»˜æ¨¡å—
â”‚
â”œâ”€â”€ shared/                  # è·¨æ¨¡å—å…±äº«èµ„æºï¼ˆå…¨å±€å¤ç”¨ï¼‰
â”‚   â”œâ”€â”€ components/          # å…¨å±€é€šç”¨ç»„ä»¶ï¼ˆä¸ä¸šåŠ¡æ— å…³ï¼Œå¦‚ Buttonã€Tableï¼‰
â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”œâ”€â”€ Table/
â”‚   â”‚   â””â”€â”€ Modal/
â”‚   â”œâ”€â”€ hooks/               # å…¨å±€é€šç”¨ hooksï¼ˆå¦‚ useDebounceã€useLocalStorageï¼‰
â”‚   â”œâ”€â”€ utils/               # å…¨å±€å·¥å…·å‡½æ•°ï¼ˆå¦‚æ—¥æœŸæ ¼å¼åŒ–ã€æ•°æ®æ ¡éªŒï¼‰
â”‚   â”œâ”€â”€ constants/           # å…¨å±€å¸¸é‡ï¼ˆå¦‚ API åœ°å€å‰ç¼€ã€æšä¸¾å€¼ï¼‰
â”‚   â””â”€â”€ styles/              # å…¨å±€æ ·å¼ï¼ˆä¸»é¢˜å˜é‡ã€åŸºç¡€æ ·å¼ã€åŠ¨ç”»ï¼‰
â”‚
â”œâ”€â”€ assets/                  # é™æ€èµ„æºï¼ˆä¸ç»è¿‡ç¼–è¯‘çš„æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ images/              # å›¾ç‰‡ï¼ˆpngã€svg ç­‰ï¼‰
â”‚   â”œâ”€â”€ fonts/               # å­—ä½“æ–‡ä»¶
â”‚   â””â”€â”€ icons/               # å›¾æ ‡ï¼ˆå¯å¤ç”¨çš„ SVG å›¾æ ‡ï¼‰
â”‚
â”œâ”€â”€ services/                # å…¨å±€ API æœåŠ¡ï¼ˆåŸºç¡€è¯·æ±‚é…ç½®ï¼‰
â”‚   â”œâ”€â”€ apiClient.js         # å°è£… axios/fetchï¼ˆè®¾ç½®æ‹¦æˆªå™¨ã€åŸºç¡€ URL ç­‰ï¼‰
â”‚   â””â”€â”€ errorHandler.js      # å…¨å±€é”™è¯¯å¤„ç†ï¼ˆå¦‚ç½‘ç»œé”™è¯¯ã€æƒé™é”™è¯¯ï¼‰
â”‚
â””â”€â”€ tests/                   # æµ‹è¯•ç›¸å…³ï¼ˆä¸ src ç›®å½•ç»“æ„å¯¹åº”ï¼‰
    â”œâ”€â”€ features/            # ä¸šåŠ¡æ¨¡å—æµ‹è¯•
    â””â”€â”€ shared/              # å…±äº«èµ„æºæµ‹è¯•
```

## 56.React Router çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚`BrowserRouter`ã€`Link`ã€`Route`ï¼‰åŠŸèƒ½ä»¥åŠåŠ¨æ€è·¯ç”±çš„å®ç°

### ä¸€ã€`BrowserRouter`

1. åŠŸèƒ½ï¼šä½œä¸ºæ•´ä¸ªè·¯ç”±ç³»ç»Ÿçš„æ ¹ç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†æµè§ˆå™¨çš„å†å²è®°å½•ï¼ˆåŸºäº history Apiï¼‰,æ˜¯ URL å˜åŒ–ä¸è§¦å‘é¡µé¢åˆ·æ–°ã€‚
2. ç”¨æ³•

```jsx
<BrowserRouter>
è·¯ç”±è§„åˆ™ã€å¯¼èˆªç»„ä»¶ç­‰
<BrowserRouter/>
```

### äºŒã€`Link`

1. åŠŸèƒ½ï¼šè·¯ç”±å¯¼èˆªç»„ä»¶ï¼Œä½¿ç”¨ React çš„`a`æ ‡ç­¾åˆ›å»ºä¸€ä¸ªé“¾æ¥ï¼Œä¸ä¼šè§¦å‘é¡µé¢åˆ·æ–°ï¼Œé»˜è®¤ä¼šé™„åŠ `history.push()`æ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥è·¯å¾„è¿›è¡Œè·³è½¬ï¼Œä¹Ÿå¯ä¼ å…¥ç‚¹å‡»äº‹ä»¶ï¼ˆå¦‚è°ƒç”¨ `Router` çš„`hash` æ–¹æ³•)ã€‚
2. ç”¨æ³•ï¼šåœ¨`React-DOM`ä¸­ï¼Œéœ€è¦ä½¿ç”¨ `Router` æä¾›çš„ `<Route>` ç»„ä»¶ã€‚

```jsx
<Link to="/">Home</Link>
```

### ä¸‰ã€`Routes`ï¼ˆè·¯ç”±å®¹å™¨ï¼‰

1. åŠŸèƒ½ï¼šä½œä¸º `Route` ç»„ä»¶çš„å®¹å™¨ï¼Œè´Ÿè´£åŒ¹é…å¹¶æ¸²æŸ“ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ Route ç»„ä»¶
2. ç”¨æ³•

```jsx
function Main() {
  return (
    <Routes>
      <Route path="/" element={<Home />} /> {/* åŒ¹é…æ ¹è·¯å¾„ */}
      <Route path="/about" element={<About />} /> {/* åŒ¹é… /about */}
    </Routes>
  );
}
```

### å››ã€`Route`

1. åŠŸèƒ½ï¼šä½œä¸ºå•ä¸ªè·¯ç”±è§„åˆ™ï¼Œè´Ÿè´£æ¸²æŸ“å­ç»„ä»¶
2. å±æ€§ï¼š

- - `path`:è·¯ç”±è·¯å¾„ï¼Œé»˜è®¤`/`ï¼ˆæ ¹è·¯å¾„ï¼‰
- - `element`:åŒ¹é…æ—¶æ¸²æŸ“çš„ React ç»„ä»¶
- - `index`:å¸ƒå°”å€¼ï¼Œæ ‡è®°ç´¢å¼•è·¯ç”±ï¼ˆå½“å¯Œè·¯ç”±åŒ¹é…ä½†æ— å­è·¯ç”±åŒ¹é…æ—¶æ¸²æŸ“ï¼‰

1. ç”¨æ³•

```jsx
<Route path="/" element={<Home />} />
```

### äº”ã€Naviagte(é‡å®šå‘)

1. åŠŸèƒ½ï¼šç”¨äºè·¯ç”±é‡å®šå‘ï¼ˆä»æ—§è·¯å¾„->æ–°è·¯å¾„ï¼‰
2. å±æ€§
   - toï¼šç›®æ ‡è·¯å¾„
   - replaceï¼šä¸º true åˆ™æ›¿æ¢å†å²è·¯å¾„
3. ç”¨æ³•

```jsx
// è®¿é—® /old æ—¶é‡å®šå‘åˆ° /new
<Route path="/old" element={<Navigate to="/new" replace />} />
```

### åŠ¨æ€è·¯ç”±

åŠ¨æ€è·¯ç”±æŒ‡è·¯å¾„ä¸­åŒ…å«**å¯å˜å‚æ•°**çš„è·¯ç”±ï¼ˆå¦‚ /user/123ã€/post/react-routerï¼‰ï¼Œç”¨äºåŒ¹é…ä¸€ç±»å…·æœ‰ç›¸åŒç»“æ„ä½†å‚æ•°ä¸åŒçš„ URLï¼ˆå¦‚ç”¨æˆ·è¯¦æƒ…é¡µã€å•†å“è¯¦æƒ…é¡µï¼‰ã€‚

```jsx
// 1.å®šä¹‰åŠ¨æ€è·¯ç”±
function Main() {
  return (
    <Routes>
      {/* åŠ¨æ€è·¯ç”±ï¼šåŒ¹é… /user/1ã€/user/123 ç­‰è·¯å¾„ */}
      <Route path="/user/:userId" element={<UserDetail />} />
    </Routes>
  );
}

// 2. åœ¨ç»„ä»¶ä¸­è·å–åŠ¨æ€å‚æ•°
import { useParams } from "react-router-dom";

function UserDetail() {
  // è·å–åŠ¨æ€å‚æ•°ï¼šuserIdï¼ˆä¸ path ä¸­ :userId å¯¹åº”ï¼‰
  const { userId } = useParams();
}

// 3. å¤šå‚æ•°åŠ¨æ€è·¯ç”±
<Route path="/post/:category/:id" element={<PostDetail />} />;
// åœ¨ç»„ä»¶ä¸­è·å–
function PostDetail() {
  const { category, id } = useParams();
  return (
    <div>
      <p>åˆ†ç±»ï¼š{category}</p>
      <p>æ–‡ç«  IDï¼š{id}</p>
    </div>
  );
}

// 4. åŠ¨æ€è·¯ç”±ä¸åµŒå¥—è·¯ç”±ç»“åˆ
<Routes>
  {/* çˆ¶è·¯ç”±ï¼šåŠ¨æ€å‚æ•° userId */}
  <Route path="/user/:userId" element={<UserLayout />}>
    {/* å­è·¯ç”±ï¼šåŒ¹é… /user/:userId/profile */}
    <Route path="profile" element={<UserProfile />} />
    {/* å­è·¯ç”±ï¼šåŒ¹é… /user/:userId/settings */}
    <Route path="settings" element={<UserSettings />} />
  </Route>
</Routes>;
```

- åœºæ™¯
- - ç”¨æˆ·/å•†å“è¯¦æƒ…é¡µ (user/123)
- - åˆ†ç±»é¡µé¢ï¼šé€šè¿‡åˆ†ç±»å‚æ•°è¿‡æ»¤å†…å®¹ ï¼ˆ/article/tech ã€/article/lifeï¼‰
- - åˆ†é¡µè·¯ç”±ï¼ˆlist?page=2ï¼‰

```jsx
function AppRoutes() {
  return (
    <Routes>
      {/* åªéœ€é…ç½®åŸºç¡€è·¯å¾„ /listï¼Œæ— éœ€å…³å¿ƒ ?page=2 ç­‰æŸ¥è¯¢å‚æ•° */}
      <Route path="/list" element={<ListPage />} />
    </Routes>
  );
}

function ListPage() {
  // 1. è·å–æŸ¥è¯¢å‚æ•°ï¼ˆç±»ä¼¼ useStateï¼Œè¿”å› [å½“å‰å‚æ•°å¯¹è±¡, æ›´æ–°å‚æ•°çš„å‡½æ•°]ï¼‰
  const [searchParams, setSearchParams] = useSearchParams();

  // 2. ä»æŸ¥è¯¢å‚æ•°ä¸­è¯»å– page å€¼ï¼ˆé»˜è®¤ç¬¬ 1 é¡µï¼‰
  const currentPage = Number(searchParams.get("page")) || 1;
}
```

## 57.å¦‚ä½•é€šè¿‡`React Testing Library`ç¼–å†™å•å…ƒæµ‹è¯•

React Testing Libraryï¼ˆRTLï¼‰æ˜¯ React å®˜æ–¹æ¨èçš„æµ‹è¯•å·¥å…·ï¼Œæ ¸å¿ƒç†å¿µæ˜¯**æµ‹è¯•ç”¨æˆ·å®é™…çœ‹åˆ°å’Œäº¤äº’çš„å†…å®¹**ï¼Œè€Œéç»„ä»¶å†…éƒ¨å®ç°ï¼ˆå¦‚çŠ¶æ€ã€æ–¹æ³•ï¼‰ã€‚å®ƒé¼“åŠ±æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼Œç¡®ä¿æµ‹è¯•æ›´è´´è¿‘å®é™…ä½¿ç”¨åœºæ™¯ã€‚

```shell
# æ ¸å¿ƒåº“ï¼šæä¾›æµ‹è¯•API
npm install --save-dev @testing-library/react

# æ‰©å±•Jestæ–­è¨€ï¼ˆå¦‚toBeInTheDocumentï¼‰
npm install --save-dev @testing-library/jest-dom

# æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’ï¼ˆæ¯”fireEventæ›´çœŸå®ï¼Œå¦‚è¾“å…¥æ—¶è§¦å‘changeäº‹ä»¶ï¼‰
npm install --save-dev @testing-library/user-event

# ï¼ˆå¯é€‰ï¼‰å¤„ç†å¼‚æ­¥æµ‹è¯•çš„è¾…åŠ©åº“
npm install --save-dev @testing-library/dom
```

1. æµ‹è¯•æ¸²æŸ“ç»“æœ
2. æµ‹è¯•äº¤äº’è¡Œä¸º
3. æµ‹è¯•å¼‚æ­¥è¯·æ±‚
4. æµ‹è¯•è¡¨å•äº¤äº’

## 58.Next.js çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆSSRã€é™æ€ç”Ÿæˆï¼‰ä»¥åŠ CRA çš„å¯¹æ¯”

| ç»´åº¦       | Next.js                                | create-react-app                           |
| ---------- | -------------------------------------- | ------------------------------------------ |
| æ¸²æŸ“æ¨¡å¼   | SSRã€SSGã€ISRã€CSR                     | CSR                                        |
| é¦–å±æ¸²æŸ“   | ä¼˜å¼‚                                   | ä¸€èˆ¬                                       |
| seo å‹å¥½   | æä½³                                   | å·®                                         |
| è·¯ç”±ç®¡ç†   | åŸºäºæ–‡ä»¶è·¯ç”±                           | æ‰‹åŠ¨é›†æˆ`react-router`                     |
| æ•°æ®è·å–   | `getServerSideProps`.`getStaticProps`  | useEffect                                  |
| åç«¯èƒ½åŠ›   | å†…ç½® API è·¯ç”±ã€å¯å¿«é€Ÿå¼€å‘æ¥å£          | æ—                                          |
| æ„å»ºäº§ç‰©   | SSG ç”Ÿæˆé™æ€ HTMLï¼›SSR ç”ŸæˆæœåŠ¡ç«¯ä»£ç   | ä»…ç”Ÿæˆå®¢æˆ·ç«¯ï¼ˆJSã€CSSï¼‰èµ„æº                |
| éƒ¨ç½²å¤æ‚åº¦ | éœ€è¦ node æˆ–è€…é™æ€æ‰˜ç®¡                 | é™æ€æ‰˜ç®¡ï¼ˆNginxã€Netlifyï¼‰                 |
| é€‚ç”¨åœºæ™¯   | å†…å®¹å‹ç½‘ç«™ï¼ˆç”µå•†é¦–é¡µã€åšå®¢ã€æ–°é—»ç±»ï¼‰   | åå°ã€ç¤¾äº¤åº”ç”¨                             |
| çµæ´»æ€§     | æ¡†æ¶çº¦æŸè¾ƒå¼ºï¼ˆéµå¾ªè·¯ç”±ã€æ•°æ®è·å–è§„èŒƒï¼‰ | æ›´çµæ´»ï¼ˆå¯è‡ªç”±æ‹“å±•é…ç½®ï¼Œæ‰‹åŠ¨å¤„ç†æ€§èƒ½ä¼˜åŒ–ï¼‰ |

### æ€»ç»“

- Next.js æ˜¯ â€œbatteries-includedâ€ çš„å…¨åŠŸèƒ½æ¡†æ¶ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äºæ¸²æŸ“æ¨¡å¼å¤šæ ·æ€§ï¼ˆSSG/SSR/ISRï¼‰å’Œå†…ç½®æ€§èƒ½ä¼˜åŒ–ï¼Œé€‚åˆå¯¹é¦–å±é€Ÿåº¦ã€SEO æœ‰é«˜è¦æ±‚çš„å†…å®¹å‹åº”ç”¨ï¼ˆå¦‚ç”µå•†ã€åšå®¢ã€æ–°é—»ï¼‰ã€‚
- CRA æ˜¯è½»é‡è„šæ‰‹æ¶ï¼Œä¸“æ³¨äºå®¢æˆ·ç«¯æ¸²æŸ“çš„å•é¡µåº”ç”¨ï¼Œé€‚åˆäº¤äº’å¯†é›†ã€å¯¹ SEO è¦æ±‚ä½çš„åœºæ™¯ï¼ˆå¦‚åå°ç®¡ç†ç³»ç»Ÿï¼‰ï¼Œä½†éœ€æ‰‹åŠ¨è§£å†³è·¯ç”±ã€æ€§èƒ½ä¼˜åŒ–ç­‰é—®é¢˜ã€‚
- é€‰æ‹©æ—¶éœ€æ ¹æ®åº”ç”¨ç±»å‹ï¼šå†…å®¹é©±åŠ¨ã€SEO æ•æ„Ÿ â†’ ä¼˜å…ˆ Next.jsï¼›äº¤äº’é©±åŠ¨ã€å†…éƒ¨ç³»ç»Ÿ â†’ å¯é€‰æ‹© CRAï¼ˆæˆ–æ›´çµæ´»çš„ Vite ç­‰å·¥å…·ï¼‰ã€‚

## 59.è§£é‡Š Webpack åœ¨ React é¡¹ç›®ä¸­çš„æ ¸å¿ƒä½œç”¨ï¼ˆå¦‚æ¨¡å—æ‰“åŒ…ã€Loader é…ç½®ï¼‰

- loader é…ç½®è§£æ jsxã€css ç­‰
- ä»å…¥å£æ‰“åŒ…å‡º chunkï¼Œæ‰“åŒ…ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨æ¨¡ç‰ˆ html ä¸­å¼•å…¥ js
- æœ€ç»ˆå‘ˆç° spa åº”ç”¨

## 60.å¦‚ä½•é€šè¿‡ Babel é…ç½®æ”¯æŒ JSX ä¸ ES6+è¯­æ³•

```js
{
presets:[
  [
    '@babel/preset0-env',
    {
      "targets":">0.25% not dead",
      "useBuiltIns":'usage', // æ§åˆ¶å¦‚ä½•è‡ªåŠ¨å¯¼å…¥polyfill
      "corejs":3
    }
  ],
  ['@babel/preset-react',{
    runtime:'automatic'
  }]
],
plugins:[
["@babel/plugin-transform-runtime", { //å‡å°‘ä»£ç å®¹æ˜“å’Œé¿å…å…¨å±€æ±¡æŸ“
      "corejs": 3
    }]
]
}
```

## 61.React ä¸ TypeScript é›†æˆç­‰æ ¸å¿ƒé…ç½®åŠç±»å‹å®šä¹‰å®è·µ

## 62.å¦‚ä½•é€šè¿‡`styled-components`å®ç° css-in-jsï¼Ÿ

æ ¸å¿ƒï¼šå®ç°â€œæ ·å¼å³ç»„ä»¶â€çš„å¼€å‘æ–¹å¼

```shell
npm install styled-components --save
```

```js
// 1. åˆ›å»ºä¸€ä¸ªå¸¦æ ·å¼çš„ div ç»„ä»¶
const StyledContainer = styled.div`
  width: 300px;
  padding: 20px;
  background: #f5f5f5;
  border-radius: 8px;
`;
// 3. ä½¿ç”¨ styled ç»„ä»¶
function App() {
  return <StyledContainer></StyledContainer>;
}
```

## 63.è§£é‡Š React çš„ Server Components ç‰¹æ€§ä»¥åŠé€‚ç”¨åœºæ™¯

RSC æ˜¯ React18 æ¨å‡ºæ¥çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå…¶æ ¸å¿ƒç›®æ ‡æ˜¯åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ç»„ä»¶ï¼Œå‡å°‘å®¢æˆ·ç«¯ js ä½“ç§¯ï¼Œæå‡åº”ç”¨æ€§èƒ½ï¼ŒåŒæ—¶ä¿æŒå’Œå®¢æˆ·ç«¯çš„çµæ´»ååŒã€‚

### æ ¸å¿ƒç‰¹æ€§ä¸æ¦‚å¿µ

- 1.æœåŠ¡ç«¯è¿è¡Œï¼Œé›¶å®¢æˆ·ç«¯ JS ä½“ç§¯
  åœ¨æœåŠ¡ç«¯æ‰§è¡Œå¹¶ç”Ÿæˆ UI ç»“æ„ï¼Œä»¥åºåˆ—åŒ–çš„æ–¹å¼å‘é€å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åªéœ€è¦æ¸²æŸ“ç»“æœï¼Œæ— éœ€ä¸‹è½½æ‰§è¡Œè¯¥ç»„ä»¶çš„ JS ä»£ç 
- - ä¸èƒ½åŒ…å«å®¢æˆ·ç«¯çŠ¶æ€çš„ç›¸å…³ APIï¼ˆuseStateã€useEffectã€useReducerï¼‰,ä¹Ÿä¸èƒ½æœ‰æ¸¸è§ˆå™¨ apiï¼ˆwindowã€documentï¼‰
- - æœåŠ¡ç«¯æ–‡ä»¶é»˜è®¤æ— ç‰¹æ®Šæ ‡è¯†ï¼Œå®¢æˆ·ç«¯ç»„ä»¶éœ€è¦é€šè¿‡é¡¶éƒ¨æ·»åŠ `use client`æŒ‡ä»¤ç”³æ˜
- 2.ç›´æ¥è®¿é—®æµè§ˆå™¨èµ„æº(æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€å†…éƒ¨ Api)

```jsx
async function ProductList() {
  const products = await db.query("select * from product");
  return (
    <>
      <ul>
        {products.map((product) => (
          <li key={product.id}>{product.name}</li>
        ))}
      </ul>
    </>
  );
}
```

- 3.ä¸å®¢æˆ·ç«¯æ··åˆä½¿ç”¨
  æœåŠ¡ç«¯å¯ä»¥å¯¼å…¥ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶ï¼Œåä¹‹äº¦ç„¶ã€‚å½¢æˆâ€œæœåŠ¡å™¨ç»„ä»¶ä¸ºéª¨æ¶ã€å®¢æˆ·ç«¯ç»„ä»¶ä¸ºäº¤äº’èŠ‚ç‚¹â€çš„æ··åˆæ¶æ„
- æœåŠ¡å™¨ç»„ä»¶æ¸²æŸ“é™æ€èµ„æºï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€å¸ƒå±€ï¼‰
- å®¢æˆ·ç«¯ç»„ä»¶è´Ÿè´£å¤„ç†äº¤äº’é€»è¾‘ï¼ˆæŒ‰é’®ç‚¹å‡»ã€è¡¨å•è¾“å…¥ï¼‰ `use client`å£°æ˜

```jsx
// æœåŠ¡å™¨ç»„ä»¶ä¸­ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶
import ClientButton from './ClientButton'; // å®¢æˆ·ç«¯ç»„ä»¶ï¼ˆå¸¦'use client'ï¼‰

function ProductPage() {
  // æœåŠ¡å™¨ç«¯è·å–æ•°æ®
  const product = await getProductFromDB();
  return (
    <div>
      <h1>{product.name}</h1> {/* æœåŠ¡å™¨æ¸²æŸ“é™æ€å†…å®¹ */}
      <ClientButton productId={product.id} /> {/* å®¢æˆ·ç«¯å¤„ç†äº¤äº’ */}
    </div>
  );
}
```

- 4.è‡ªåŠ¨ä»£ç åˆ†å‰²å’ŒæŒ‰éœ€åŠ è½½
  React ä¼šæƒ³æœåŠ¡å™¨ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶ä»£ç åˆ†å‰²ï¼Œä»…å‘å®¢æˆ·ç«¯å‘é€å¿…è¦çš„å®¢æˆ·ç«¯ JS ä»£ç ï¼Œå¤§å¹…å‡å°‘åˆå§‹åŠ è½½çš„ JS ä½“ç§¯
- 5.ä¸ SSR çš„åŒºåˆ«
- - SSR ç”Ÿæˆå®Œæ•´ HTML å­—ç¬¦ä¸²ï¼Œå®¢æˆ·ç«¯ä¸‹è½½å`hydrate`ä¸ºå¯äº¤äº’ DOMï¼Œéœ€è¦ä¸‹è½½å¯¹åº”ç»„ä»¶çš„ JS ä»£ç ã€‚
- - RSC ç”Ÿæˆç»„ä»¶æ ‘çš„åºåˆ—åŒ–æ•°æ®ï¼Œå®¢æˆ·ç«¯æŒ‰éœ€æ¸²æŸ“ï¼ŒæœåŠ¡ç«¯ç»„ä»¶çš„ JS ä¸ä¼šå‘é€ç»™å®¢æˆ·ç«¯ã€‚
- é€‚ç”¨åœºæ™¯
- - é™æ€å†…å®¹å±•ç¤ºé¡µ
- - æ•°æ®å¯†é›†å‹é¡µé¢ï¼ˆç”µå•†åˆ—è¡¨ã€æ•°æ®åˆ†ææŠ¥è¡¨ï¼‰
- - seo æ•æ„Ÿé¡µé¢
- - ä½å¸¦å®½/ä½æ€§èƒ½è®¾å¤‡
- - å¤§å‹åº”ç”¨çš„â€œéäº¤äº’éª¨æ¶â€ ï¼ˆåå°ç®¡ç†ç³»ç»Ÿï¼Œå¸ƒå±€ã€å¯¼èˆªæ ç­‰é™æ€éª¨æ¶ç”¨æœåŠ¡å™¨ç»„ä»¶å®ç°ï¼‰
- ä¸é€‚ç”¨åœºæ™¯
- - é«˜äº¤äº’ ï¼ˆè¡¨å•éªŒè¯ã€å®æ—¶ç¼–è¾‘å™¨ã€åŠ¨ç”»ç»„ä»¶ï¼‰
- - éœ€è¦æµè§ˆå™¨ Api çš„ç»„ä»¶

- 5.å…·ä½“ä¾‹å­
  æœåŠ¡ç«¯å‘é€ï¼šRSC æœ€ç»ˆå‘é€ç»™å®¢æˆ·ç«¯çš„æ˜¯`åŸºäº React Server Components Protocolï¼ˆRSC åè®®ï¼‰çš„åºåˆ—åŒ–æ•°æ®ç»“æ„ ç±»ä¼¼JSON`ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°åä¼šé€šè¿‡ React çš„æ ¸å¿ƒè¿è¡Œæ—¶è§£æå¹¶é‡å»ºç»„ä»¶æ ‘ï¼Œæœ€ç»ˆæ¸²æŸ“ DOM

```js
{
  "id": "0",
  "type": "element",
  "tag": "div",
  "props": { "className": "product-page" },
  "children": [
    {
      "type": "element",
      "tag": "h1",
      "children": [{ "type": "text", "value": "å•†å“è¯¦æƒ…" }]
    },
    // æœåŠ¡å™¨ç»„ä»¶ï¼šç›´æ¥åŒ…å«æ•°æ®ï¼ˆæ— éœ€å®¢æˆ·ç«¯JSï¼‰
    {
      "type": "server.component",
      "id": "ProductInfo",
      "props": {
        "name": "Reactå…¥é—¨æŒ‡å—",
        "price": 59.9,
        "stock": 100
      }
    },
    // å®¢æˆ·ç«¯ç»„ä»¶ï¼šä»…åŒ…å«å¼•ç”¨å’Œpropsï¼ŒJSéœ€å®¢æˆ·ç«¯åŠ è½½
    {
      "type": "client.component",
      "module": "./AddToCart.client.js", // å®¢æˆ·ç«¯ç»„ä»¶è·¯å¾„
      "props": { "productId": 123 }
    }
  ]
}
```

å®¢æˆ·ç«¯å¤„ç†ï¼š

1. è§£æåºåˆ—åŒ–æ•°æ®ï¼Œé‡å»ºç»„ä»¶æ ‘
2. åŠ è½½å®¢æˆ·ç«¯ç»„ä»¶çš„ js
3. æ¸²æŸ“å’Œæ°´åˆ

   - æ¸²æŸ“é™æ€å†…å®¹ï¼ŒæœåŠ¡å™¨ç»„ä»¶å¯¹åº”çš„ vdom ç›´æ¥æ¸²æŸ“æˆçœŸå® domï¼ˆæ— ç™½å±ï¼‰
   - æ°´åˆå®¢æˆ·ç«¯ç»„ä»¶ï¼šå½“å®¢æˆ·ç«¯ç»„ä»¶ js åŠ è½½å®Œæˆåï¼ŒReact ä¼šå°†å…¶ä¸å¯¹åº”çš„è™šæ‹Ÿ DOM èŠ‚ç‚¹ç»‘å®šï¼ˆæ°´åˆï¼‰ï¼Œæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ï¼ˆçŠ¶æ€ã€äº‹ä»¶ç›‘å¬ï¼‰ï¼Œä½¿å…¶å…·æœ‰äº¤äº’èƒ½åŠ›

4. åç»­äº¤äº’ï¼šå®¢æˆ·ç«¯ç»„ä»¶äº¤äº’å®Œå…¨åå®¢æˆ·ç«¯å¤„ç†ï¼Œè‹¥æ¶‰åŠæ›´æ–°æ•°æ®ï¼Œå¯é€šè¿‡ç»“æœè·å–ç»„ä»¶çŠ¶æ€ã€‚æˆ–è§¦å‘æœåŠ¡ç«¯ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

ä¾‹å­

```shell
npx create-next-app@latest rsc-demo --experimental-app
cd rsc-demo
```

åˆ›å»ºæœåŠ¡ç«¯ç»„ä»¶

```jsx
// src/app/components/ProductList.jsx
// app/components/ProductList.jsx
// æœåŠ¡å™¨ç»„ä»¶ï¼ˆæ— 'use client'ï¼‰

// æ¨¡æ‹ŸæœåŠ¡å™¨ç«¯æ•°æ®è·å–ï¼ˆå®é™…é¡¹ç›®ä¸­å¯èƒ½æ˜¯æ•°æ®åº“æŸ¥è¯¢ï¼‰
async function fetchProducts(category) {
  // æ¨¡æ‹Ÿå»¶è¿Ÿ
  await new Promise((resolve) => setTimeout(resolve, 500));

  // æ¨¡æ‹Ÿäº§å“æ•°æ®
  const products = [
    { id: 1, name: "ç¬”è®°æœ¬ç”µè„‘", category: "electronics", price: 5999 },
    { id: 2, name: "ç‰›ä»”è£¤", category: "clothing", price: 299 },
    { id: 3, name: "React æŒ‡å—", category: "books", price: 59 },
    { id: 4, name: "æ— çº¿è€³æœº", category: "electronics", price: 899 },
  ];

  // æ ¹æ®ç­›é€‰æ¡ä»¶è¿‡æ»¤ï¼ˆæœåŠ¡å™¨ç«¯ç­›é€‰ï¼Œå‡å°‘å®¢æˆ·ç«¯æ•°æ®ä¼ è¾“ï¼‰
  return category === "all"
    ? products
    : products.filter((p) => p.category === category);
}

// æœåŠ¡å™¨ç»„ä»¶æ¥æ”¶ç­›é€‰æ¡ä»¶ä½œä¸ºå‚æ•°
export default async function ProductList({ category }) {
  // æœåŠ¡å™¨ç«¯ç›´æ¥è·å–æ•°æ®ï¼ˆæ— éœ€å®¢æˆ·ç«¯fetchï¼‰
  const products = await fetchProducts(category);

  return (
    <div>
      <h2>äº§å“åˆ—è¡¨ï¼ˆ{category === "all" ? "å…¨éƒ¨" : category}ï¼‰</h2>
      <ul style={{ listStyle: "none", padding: 0 }}>
        {products.map((product) => (
          <li
            key={product.id}
            style={{
              padding: "10px",
              border: "1px solid #eee",
              margin: "5px 0",
            }}
          >
            <h3>{product.name}</h3>
            <p>åˆ†ç±»ï¼š{product.category}</p>
            <p>ä»·æ ¼ï¼šÂ¥{product.price}</p>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

åˆ›å»ºå®¢æˆ·ç«¯ç»„ä»¶

```jsx
// app/components/Filter.client.jsx
"use client"; // å£°æ˜ä¸ºå®¢æˆ·ç«¯ç»„ä»¶

import { useState } from "react";
import { useSearchParams, useRouter } from "next/navigation"; // ç”¨äºæ“ä½œURL
// æ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨äºé€šçŸ¥æœåŠ¡å™¨ç»„ä»¶ç­›é€‰æ¡ä»¶å˜æ›´
export default function Filter({ onFilterChange }) {
  const searchParams = useSearchParams();
  const router = useRouter();
  // å½“ç­›é€‰æ¡ä»¶å˜åŒ–æ—¶ï¼Œè°ƒç”¨å›è°ƒé€šçŸ¥çˆ¶ç»„ä»¶ï¼ˆæœåŠ¡å™¨ç»„ä»¶ï¼‰
  const [category, setCategory] = useState(
    searchParams.get("category") || "all"
  );

  // å½“ç­›é€‰æ¡ä»¶å˜åŒ–æ—¶ï¼Œç›´æ¥åœ¨å®¢æˆ·ç«¯æ›´æ–°URL
  const handleChange = (e) => {
    const newCategory = e.target.value;
    setCategory(newCategory);

    // å®¢æˆ·ç«¯ç›´æ¥ä¿®æ”¹URLï¼Œè§¦å‘æœåŠ¡å™¨ç»„ä»¶é‡æ–°æ¸²æŸ“
    const params = new URLSearchParams(searchParams);
    params.set("category", newCategory);
    router.push(`?${params.toString()}`); // å¯¼èˆªåˆ°æ–°URL
  };

  return (
    <div style={{ marginBottom: "20px" }}>
      <label>ç­›é€‰åˆ†ç±»ï¼š</label>
      <select
        value={category}
        onChange={handleChange}
        style={{ marginLeft: "8px" }}
      >
        <option value="all">å…¨éƒ¨</option>
        <option value="electronics">ç”µå­äº§å“</option>
        <option value="clothing">æœè£…</option>
        <option value="books">å›¾ä¹¦</option>
      </select>
    </div>
  );
}
```

page.js ä½¿ç”¨

```js
// app/page.js
// æœåŠ¡å™¨ç»„ä»¶ï¼ˆé¡µé¢å…¥å£ï¼‰

import { Suspense } from "react";
import ProductList from "./components/ProductList";
import Filter from "./components/Filter.client";

export default function Page({ searchParams }) {
  // ä»URLæŸ¥è¯¢å‚æ•°ä¸­è·å–å½“å‰ç­›é€‰æ¡ä»¶ï¼ˆæœåŠ¡å™¨ç«¯è·å–ï¼‰
  const currentCategory = searchParams?.category || "all";

  return (
    <main style={{ maxWidth: "800px", margin: "0 auto", padding: "20px" }}>
      <h1>æœåŠ¡å™¨ç»„ä»¶ä¸å®¢æˆ·ç«¯ç»„ä»¶åä½œç¤ºä¾‹</h1>

      {/* å®¢æˆ·ç«¯ç»„ä»¶ï¼šè´Ÿè´£ç­›é€‰äº¤äº’ */}
      <Filter />

      {/* æœåŠ¡å™¨ç»„ä»¶ï¼šè´Ÿè´£æ•°æ®è·å–å’Œåˆ—è¡¨æ¸²æŸ“ï¼Œç”¨Suspenseå¤„ç†å¼‚æ­¥åŠ è½½ */}
      <Suspense fallback={<p>åŠ è½½äº§å“ä¸­...</p>}>
        <ProductList category={currentCategory} />
      </Suspense>
    </main>
  );
}
```

## 64.å¦‚ä½•é€šè¿‡ GraphQL ä¼˜åŒ– React åº”ç”¨çš„æ•°æ®è·å–ï¼Ÿ

GraphQL ä½œä¸ºä¸€ç§å£°æ˜å¼æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œï¼Œç›¸æ¯”ä¼ ç»Ÿçš„ REST APIï¼Œæ›´ç²¾ç¡®åœ°æ»¡è¶³ React ç»„ä»¶çš„æ•°æ®éœ€æ±‚ã€‚ä»æ ¹æœ¬è§£å†³â€œè¿‡åº¦è¯·æ±‚â€â€œè¯·æ±‚å†—ä½™â€â€œå¤šç«¯ç‚¹åè°ƒâ€ç­‰é—®é¢˜ã€‚

### ä¸€ã€ç²¾ç¡®è·å–æ•°æ®ï¼Œé¿å…â€œè¿‡åº¦è¯·æ±‚â€ä¸â€œè¯·æ±‚ä¸è¶³â€

```graphql
# Reactç»„ä»¶éœ€è¦çš„ç”¨æˆ·æ•°æ®ï¼Œä»…idã€nameã€avatar
query UserProfile($userId: ID) {
  user(id: $userId) {
    id
    name
    avatar
  }
}
```

å¯¹åº” React ç»„ä»¶ä½¿ç”¨ Apollo Client çš„`useQuery`çš„é’©å­

```jsx
import { useQuery, gql } from "@apollo/client";

const USER_QUERY = gql`
  query UserProfile($userId: ID!) {
    user(id: $userId) {
      id
      name
      avatar
    }
  }
`;

function UserProfile({ userId }) {
  const { data, loading } = useQuery(USER_QUERY, { variables: { userId } });
  if (loading) {
    return <p>Loading...</p>;
  }
  return (
    <div>
      <h1>{data.user.name}</h1>
      <img src={data.user.avatar} />
    </div>
  );
}
export default UserProfile;
```

### äºŒã€è¯·æ±‚åˆå¹¶ã€ä¼˜åŒ–

GraphQL æ”¯æŒå•è¯è¯·æ±‚è·å–å¤šç±»å‹å…³è”æ•°æ®

```graphql
query DashboardData($userId: ID!) {
  user(id: $userId) {
    name
    avatar
  }
  orders(userId: $userId, limit: 5) {
    id
    total
    date
  }
  notifications(userId: $userId, unread: true) {
    id
    content
  }
}
```

### ä¸‰ã€æ•°æ®ä¸ç»„ä»¶çš„â€œå£°æ˜å¼ç»‘å®šâ€ï¼Œæå‡ç»´æŠ¤æ€§

- ç»„ä»¶åªéœ€è¦å£°æ˜ query å’Œä¾èµ–çš„å˜é‡
- åº“è‡ªåŠ¨å¤„ç†è¯·æ±‚å‘é€ã€åŠ è½½çŠ¶æ€ã€é”™è¯¯å¤„ç†ã€ç¼“å­˜æ›´æ–°

```jsx
function ProductDetail({ productId }) {
  // ä»…å£°æ˜æ‰€éœ€æ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨å†™ fetch/axios
  const { data, error, loading } = useQuery(PRODUCT_QUERY, {
    variables: { productId },
  });

  if (loading) return <Spinner />;
  if (error) return <ErrorMessage message={error.message} />;

  // ç›´æ¥ä½¿ç”¨æ•°æ®æ¸²æŸ“ UI
  return <ProductCard product={data.product} />;
}
```

### å››ã€è‡ªåŠ¨ç¼“å­˜ä¸æ•°æ®å¤ç”¨ï¼Œå‡å°‘é‡å¤è¯·æ±‚

GrapQL å®¢æˆ·ç«¯ï¼ˆApollo Clientï¼‰å†…ç½®è‡ªåŠ¨ç¼“å­˜æœºåˆ¶ï¼š

- é¦–æ¬¡è¯·æ±‚æ•°æ®åï¼Œç»“æœä¼šæŒ‰â€æŸ¥è¯¢å­—æ®µ+å‚æ•°â€œä¿å­˜
- åç»­ç›¸åŒè¯·æ±‚ç›´æ¥ä»ç¼“å­˜è¯»å–ï¼Œæ— éœ€å†æ¬¡è°ƒç”¨æœåŠ¡å™¨
- ç¼“å­˜æ•°æ®æ›´æ–°æ—¶ï¼ˆå¦‚é€šè¿‡ mutation ä¿®æ”¹æ•°æ®ï¼‰ï¼Œæ‰€æœ‰ä¾èµ–è¯¥æ•°æ®çš„ç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°åˆ·æ–°ã€‚

```jsx
// ç»„ä»¶ A è¯·æ±‚ç”¨æˆ·ä¿¡æ¯
const { data: dataA } = useQuery(USER_QUERY, { variables: { userId: 1 } });

// ç»„ä»¶ B åŒä¸€é¡µé¢è¯·æ±‚ç›¸åŒç”¨æˆ·ä¿¡æ¯ â†’ ç›´æ¥å‘½ä¸­ç¼“å­˜ï¼Œæ— ç½‘ç»œè¯·æ±‚
const { data: dataB } = useQuery(USER_QUERY, { variables: { userId: 1 } });
```

### äº”ã€å®ç°æ•°æ®é«˜æ•ˆåŒæ­¥ã€ç®€åŒ–çŠ¶æ€ç®¡ç†

GraphQL çš„`Subscription`æ”¯æŒåŸºäº WebSocket çš„å®æ—¶æ•°æ®æ¨é€ï¼Œå®¢æˆ·ç«¯å¯è®¢é˜…æ•°æ®å˜åŒ–ã€‚æœåŠ¡ç«¯åœ¨æ•°æ®æ›´æ–°æ—¶ä¸»åŠ¨æ¨é€ï¼Œæ— éœ€å®¢æˆ·ç«¯è½®è¯¢ã€‚

```graphql
# è®¢é˜…æ–°é€šçŸ¥
subscription newNotifications($userId: ID!) {
  newNotifications(userId: $uesrId) {
    id
    content
    createdAt
  }
}
```

React ä½¿ç”¨`useSubscription`

```jsx
import { useSubscription, gql } from "@apollo/client";

const NOTIFICATION_SUBSCRIPTION = gql`
  subscription NewNotification($userId: ID!) {
    newNotification(userId: $userId) {
      id
      content
    }
  }
`;

function NotificationBell({ userId }) {
  const { data } = useSubscription(NOTIFICATION_SUBSCRIPTION, {
    variables: { userId },
  });

  // æ•°æ®æ›´æ–°æ—¶è‡ªåŠ¨é‡æ–°æ¸²æŸ“
  return (
    <div>
      {data?.newNotification && (
        <Alert>æ–°é€šçŸ¥ï¼š{data.newNotification.content}</Alert>
      )}
    </div>
  );
}
```

### æ€»ç»“

GraphQL å¯¹ React åº”ç”¨æ•°æ®è·å–çš„ä¼˜åŒ–æ ¸å¿ƒåœ¨äºï¼š

1. ç²¾ç¡®æ€§ï¼šæŒ‰éœ€è¯·æ±‚ï¼Œå‡å°‘ä¼ è¾“é‡
2. é«˜æ•ˆæ€§ï¼šåˆå¹¶è¯·æ±‚ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”
3. å£°æ˜å¼ï¼šæ•°æ®è¯·æ±‚ä¸ç»„ä»¶é€»è¾‘åˆ†ç¦»ã€‚æé«˜å¼€å‘æ•ˆç‡ã€‚
4. æ™ºèƒ½ç¼“å­˜ï¼šè‡ªåŠ¨å¤ç”¨æ•°æ®ï¼Œå‡å°‘é‡å¤è¯·æ±‚
5. å®æ—¶æ€§ï¼šé€šè¿‡ Subscription ç®€åŒ–å®æ—¶æ•°æ®åŒæ­¥

## 65.React Native ä¸ Web ç«¯ React çš„æ ¸å¿ƒå·®å¼‚ä»¥åŠè·¨å¹³å°å¼€å‘å®è·µ

- æ ¸å¿ƒå·®å¼‚ï¼šRN ä¸ Web React çš„æœ¬è´¨åŒºåˆ«åœ¨äºæ¸²æŸ“ç›®æ ‡ï¼ˆåŸç”Ÿç»„ä»¶ vsDOMï¼‰ï¼Œå¯¼è‡´ç»„ä»¶é›†ï¼Œæ ·å¼ç³»ç»Ÿï¼ŒAPI è®¾è®¡ï¼Œæ€§èƒ½ç“¶é¢ˆä¸åŒ
- è·¨å¹³å°å®è·µï¼šé€šè¿‡å…±äº«ä¸šåŠ¡é€»è¾‘ã€æŠ½è±¡å¹³å°å·®å¼‚ã€ä½¿ç”¨è·¨å¹³å°åº“ï¼Œåœ¨ä¿è¯ç”¨æˆ·ä½“éªŒçš„å‰æä¸‹æœ€å¤§åŒ–ä»£ç å¤ç”¨ã€‚å…³é”®æ˜¯â€œé€»è¾‘å…±äº«ã€‚UI é€‚é…â€

## zustand ä¼˜ç‚¹

- api æç®€ï¼Œå­¦ä¹ æˆæœ¬ä½
- ä¸ hook æ·±åº¦èåˆ `useStore((state)=>({count:state.count}))`
- è‡ªåŠ¨ä¼˜åŒ–æ€§èƒ½ï¼Œå‡å°‘ä¸å¿…è¦æ¸²æŸ“ï¼ˆè‡ªåŠ¨è·Ÿè¸ªç»„ä»¶ä¾èµ–çš„çŠ¶æ€å­—æ®µï¼‰
- çµæ´»æ€§é«˜ï¼Œæ”¯æŒå¤šåœºæ™¯æ‰©å±•ï¼ˆå¤š storeã€ä¸­é—´ä»¶ã€å…¼å®¹ä¸å¯å˜æ•°æ®ï¼‰
- è½»é‡æ— ä¾èµ–ï¼Œé¡¹ç›®ä½“ç§¯è‰¯å¥½
- è‰¯å¥½çš„ ts æ”¯æŒ

### React hooks çš„å®è·µ

å¸¸è§é—®é¢˜

### é—­åŒ…é™·é˜±

æœŸæœ›è·å–æœ€æ–°å˜é‡å€¼ï¼Œä½†å®é™…è·å–çš„æ˜¯è¯¥å˜é‡åœ¨å‡½æ•°åˆ›å»ºæ—¶çš„â€œè¿‡æ—¶â€çš„å€¼

```js
for (var i = 0; i < 3; i++) {
  setTimeout(function () {
    console.log(i); // è¾“å‡ºä¸‰ä¸ª 3ï¼Œè€Œä¸æ˜¯ 0, 1, 2
  }, 100);
}

// è§£é‡Šï¼š1 useEffectåœ¨å‡½æ•°æ‰§è¡Œè¢«å®šä¹‰å’Œæ‰§è¡Œï¼Œ2 ç„¶ååˆ›å»ºäº†é—­åŒ…ï¼Œå®ƒâ€œè®°ä½â€æ­¤åˆ»countçš„å€¼0. 3.å³ä½¿countå¢åŠ ï¼Œå›è°ƒå‡½æ•°ä»ç„¶æ˜¯æœ€åˆçš„é‚£ä¸ªå‡½æ•°çœ‹åˆ°çš„countæ°¸è¿œæ˜¯è¢«é—­åŒ…æ•è·çš„é‚£ä¸ªåˆå§‹å€¼â€œ0â€
// è§£å†³ï¼š1.æ­£ç¡®ä¾èµ–ï¼Œé”€æ¯æ—§çš„ï¼Œé‡æ–°åˆ›å»ºæ–°çš„effectï¼ˆå’Œæ–°çš„å®šæ—¶å™¨ï¼‰ï¼›2. å‡½æ•°å€¼æ›´æ–°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šæ¥å—æœ€æ–°çš„stateä½œä¸ºå‚æ•°ã€‚3.ä½¿ç”¨useRefï¼Œ countæ›´æ–°ï¼Œåœ¨é‡æ–°èµ‹å€¼ç»™ countRef
function Counter() {
  const [count, setCount] = useState(0);
  useEffect(() => {
    let t = setInterval(() => {
      console.log(count); // 0
    }, 1000);
    () => {
      clearInterval(t);
    };
  }, []);
  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

### ä¾èµ–é¡¹å¼‚å¸¸

ç°è±¡ï¼šçŠ¶æ€å˜æ›´ï¼Œå‰¯ä½œç”¨ä¸æ‰§è¡Œã€‚
è§£å†³ï¼šæ­£ç¡®è·Ÿè¸ªä¾èµ–é¡¹ï¼Œä¿è¯â€œå®Œæ•´æ€§â€å’Œâ€œæœ€å°èŒƒå›´åŸåˆ™â€

### useRef çš„æ»¥ç”¨ä¸è¯¯ç”¨

ç°è±¡ï¼šè¯•å›¾æ‹¿ ref å­˜å‚¨â€œéœ€è¦å“åº”å¼æ›´æ–°çš„çŠ¶æ€â€ï¼Œå¯¼è‡´ UI ä¸åˆ·æ–°ã€‚
åŸå› ï¼š`useRef.current`ä¸æ˜¯å“åº”å¼çš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯`è·¨æ¸²æŸ“ä¿å­˜å€¼`

### Hooks æœ€ä½³å®è·µ

1. ç»„ä»¶æ‹†åˆ†ï¼šæŒ‰é€»è¾‘ç»´åº¦ï¼Œä¸æ˜¯æŒ‰ ui ç»´åº¦

ç¤ºä¾‹ï¼šå°†â€œç”¨æˆ·æ•°æ®è¯·æ±‚+åŠ è½½+é”™è¯¯å¤„ç†â€å°è£…`useUserData`,ç»„ä»¶è°ƒç”¨`const {data,loading,error} = useUserData`

2. ä¾èµ–é¡¹ç®¡ç†ï¼šä¸¥æ ¼éµå¾ªâ€œå®Œæ•´æ€§â€å’Œâ€œæœ€å°åŒ–â€

- å®Œæ•´æ€§`useEffect useCallback useMemo`(å¯å€ŸåŠ© eslint æ’ä»¶å¼ºåˆ¶æ£€æŸ¥)

3. é¿å…è¿‡åº¦ä¼˜åŒ–`useCallback useMemo`
   åœ¨ä»¥ä¸‹åœºæ™¯ä½¿ç”¨ï¼š

- å‡½æ•°ä¼ ç»™`React.memo React.pureComponent`
- å‡½æ•°ä½œä¸ºå…¶ä»– Hooks çš„ä¾èµ–é¡¹ï¼ˆå¦‚ `useEffect` ä¾èµ–çš„å›è°ƒå‡½æ•°ï¼‰
- useMemo è®¡ç®—è€—æ—¶è¶…è¿‡`1ms`çš„å¤æ‚é€»è¾‘ï¼ˆå¦‚å¤§æ•°æ®æ’åºï¼‰

4. è‡ªå®šä¹‰ Hooksï¼šå°è£…å¤ç”¨é€»è¾‘ï¼Œå‘½åè§„èŒƒç»Ÿä¸€

- å‘½å `useXXX`
- å•ä¸€èŒè´£ï¼Œå¦‚`useRequest`è´Ÿè´£æ•°æ®è¯·æ±‚ï¼Œ`useLocalStoarge`è´Ÿè´£æœ¬åœ°å­˜å‚¨

5. å¼‚æ­¥é€»è¾‘å¤„ç†è§„èŒƒï¼š

```js
useEffect(() => {
  // useEffectçš„å›è°ƒå‡½æ•°ä¸èƒ½æ˜¯async
  async function getData() {
    try {
      let res = await fetch(`/data/${id}`);
    } catch (e) {}
  }
  getData();
}, [id]);

useEffect(()=>{},[data.name])
useEffect(()=>{},[æ™®é€šå€¼]) // æ³¨æ„ä½¿ç”¨æ—¶ Object.is()
useEffect(()=>{},[refValue.current]) // âŒ 1.useRef çš„å˜æ›´ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
```
